/*! For license information please see 470.e5ad6c24adf3d066e06f.js.LICENSE.txt */
"use strict";(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[470],{66175:(t,e,i)=>{i.d(e,{A:()=>o});var s=i(23205);class o extends s.n{constructor(){super(...arguments),this.name="base-controls",this.inputBindings=[]}registerActiveStateChangeBinding(){this.bindings.push(this.controls.onActiveStateChanged((()=>this.onActiveStateChanged())))}updateInputBindings(){this.controls.isActive?this.inputBindings.forEach((t=>t.renew())):this.inputBindings.forEach((t=>t.cancel()))}onActiveStateChanged(){this.controls.stop(),this.updateInputBindings()}dispose(t){super.dispose(t);for(const t of this.inputBindings)t.cancel();this.inputBindings=[]}}},18007:(t,e,i)=>{i.d(e,{A:()=>o});var s=i(41733);class o{constructor(){this.poseControllerObservable=(0,s.p)(null)}get poseController(){return this.poseControllerObservable.value}setController(t){return this.poseControllerObservable.value=t,this}get isActive(){return null!=this.poseController}onActiveStateChanged(t){return this.poseControllerObservable.onChanged(t)}}},64599:(t,e,i)=>{i.d(e,{w:()=>o});var s=i(40270);function o(t){return t.width<=s._8}},24081:(t,e,i)=>{var s;i.d(e,{f:()=>s}),function(t){t[t.Standard=0]="Standard",t[t.Depth=1]="Depth",t[t.Transparent=2]="Transparent",t[t.Wireframe=3]="Wireframe",t[t.UV=4]="UV"}(s||(s={}))},10691:(t,e,i)=>{i.d(e,{B:()=>l});var s=i(68909),o=i(23847),n=i(34944),r=i(12183),a=i(94221),h=i(97624);class l extends a.r{constructor(t,e,i=o.H.ALL){super(),this._opacity=1,this._chunks=[],this.size=new s.Vector3,this.center=new s.Vector3,this.built=!1,this.layers.mask=i.mask,this.name=`RoomMesh:${t}-${e}`,this.meshGroup=t,this.meshSubgroup=e,this.renderOrder=r.X.default,this.castShadow=l.ShouldCastShadow,this.onBeforeRender=(t,e,i,s,o,n)=>{this.updateUniforms(o,n)}}dispose(){this.reset()}reset(){this._chunks.length=0,this.geometry.dispose(),delete this.onBuild,delete this.onOpacityUpdate,this.built=!1}addChunk(t){-1===this._chunks.indexOf(t)&&this._chunks.push(t)}getChunk(t){return this._chunks[t]}build(){if(this.built)throw new Error("build() should only be called once");if(!this._chunks.length)return;const t=(0,n.h0)(this._chunks.map((t=>t.geometry)));t.clearGroups();let e=0;this.material=[],this._chunks.forEach(((i,s)=>{i.geometry&&i.geometry.index&&(t.addGroup(e,i.geometry.index.count,s),e+=i.geometry.index.count,i.geometry.dispose(),i.geometry=t,i.notifyOnMaterialUpdated((t=>{Array.isArray(this.material)&&(this.material[s]=t),this.onMaterialUpdate&&this.onMaterialUpdate()})),i.onOpacityUpdate=t=>{this.opacity=t})})),this.geometry=t,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere(),this.material=this._chunks.map((t=>t.material)),this.size=this.boundingBox.getSize(this.size),this.center=this.boundingBox.getCenter(this.center),this.built=!0,this.onBuild&&this.onBuild()}buildWithSingleChunk(t){if(this.built)return;const{meshGroup:e,meshSubgroup:i,lod:s}=t;this.name=`RoomMesh:${s}-${e}-${i}-${t.chunkIndex}`,this.meshGroup=e,this.meshSubgroup=i,this._chunks.push(t),t.notifyOnMaterialUpdated((t=>{this.material=t,this.onMaterialUpdate&&this.onMaterialUpdate()})),t.onOpacityUpdate=t=>{this.opacity=t},this.size=this.boundingBox.getSize(this.size),this.center=this.boundingBox.getCenter(this.center),this.built=!0,this.onBuild&&this.onBuild()}updateUniforms(t,e){t instanceof s.RawShaderMaterial&&(e?this.chunks[e.materialIndex].onBeforeDraw(t):this.chunks.length&&this.chunks[0].onBeforeDraw(t))}get boundingBox(){return(0,n.UX)(this.geometry)}set opacity(t){t!==this.opacity&&(this._opacity=t,this.raycastEnabled=t>h.u7.FADE_CLICKABLE_THRESHOLD,this.renderOrder=t<h.u7.FADE_OPAQUE?r.X.ghostFloor:r.X.default,this.onOpacityUpdate&&this.onOpacityUpdate(t))}get opacity(){return this._opacity}get chunks(){return this._chunks}getSortKey(){return this.chunks.length?this._chunks[0].getSortKey():0}}l.ShouldCastShadow=!1},20052:(t,e,i)=>{i.d(e,{P:()=>o});var s=i(18268);class o extends s.u{constructor(t,e,i){super(),this.payload={enabled:t,previewCirclePosition:e,size:i}}}o.id="MESH_PREVIEW_POSITION"},69179:(t,e,i)=>{i.d(e,{w:()=>n});var s=i(18268),o=i(24081);class n extends s.u{constructor(t){super(),this.payload={mode:t}}}n.modes=o.f,n.id="SET_CHUNK_RENDER_MODE"},75092:(t,e,i)=>{i.d(e,{X:()=>o});var s=i(18268);class o extends s.u{constructor(t=null){super(),this.payload={cursor:t}}}o.id="SET_MOUSE_CURSOR"},28883:(t,e,i)=>{var s;i.d(e,{b:()=>s}),function(t){t.NONE="none",t.DEFAULT="default",t.MOVE="move",t.MOVE_LF="col-resize",t.MOVE_UD="row-resize",t.XHAIR="crosshair",t.PLUS="cell",t.QUESTION="help",t.NOPE="not-allowed",t.FINGER="pointer",t.TEXT="text",t.TEXT_VERT="vertical-text",t.ZOOM_IN="zoom-in",t.ZOOM_OUT="zoom-in",t.GRAB="grab",t.GRABBING="grabbing",t.ARROW_R="e-resize",t.ARROW_L="w-resize",t.ARROW_U="n-resize",t.ARROW_D="s-resize",t.ARROW_UR="ne-resize",t.ARROW_UL="nw-resize",t.ARROW_DR="se-resize",t.ARROW_DL="sw-resize",t.ARROW_LR="ew-resize",t.ARROW_UD="ns-resize",t.ARROW_URDL="nesw-resize",t.ARROW_ULDR="nwse-resize",t.ROOMBOUNDS_DEFAULT="rbe-default",t.ROOMBOUNDS_MOVING="rbe-moving",t.ROOMBOUNDS_PLACE_NODE="rbe-place-node",t.ROOMBOUNDS_FINISH_ROOM="rbe-finish-room"}(s||(s={}))},79760:(t,e,i)=>{i.d(e,{V$:()=>h,g1:()=>a,ol:()=>r,qD:()=>o,vc:()=>n});var s=i(75673);const o=1e3/60,n=(0,s.pu)(70),r=-n,a=.05,h=.1/60},14746:(t,e,i)=>{i.r(e),i.d(e,{default:()=>S,lookAccelerationKey:()=>x});var s=i(68909),o=i(48071),n=i(79760),r=i(60840),a=i(43998),h=i(18007),l=i(71294);class c extends h.A{constructor(t){super(),this.cameraPoseProxy=t,this.lookVelocity=new s.Vector2,this.lookAccel=new s.Vector2,this.tempAxis=new s.Vector3,this.tempOrientation=new s.Quaternion,this.currentOrientation=new s.Quaternion,this.tempEuler=new s.Euler,this.transition={active:!1,startTime:0,elapsed:0,duration:0,velocity:new s.Vector2,easeOut:!1}}setController(t){return null==t&&this.stop(),super.setController(t)}setLookAcceleration(t,e=!1){this.transition.active||(e&&(t.x&&this.lookVelocity.x&&Math.sign(t.x)!==Math.sign(this.lookVelocity.x)&&(this.lookVelocity.x=0),t.y&&this.lookVelocity.y&&Math.sign(t.y)!==Math.sign(this.lookVelocity.y)&&(this.lookVelocity.y=0)),this.lookAccel.x=void 0!==t.x?t.x:this.lookAccel.x,this.lookAccel.y=void 0!==t.y?t.y:this.lookAccel.y)}startTransition(t,e,i){var s;const o=new l.i;return this.transition.active=!0,this.transition.duration=t,this.transition.elapsed=0,this.transition.startTime=Date.now(),this.transition.deferred=o,this.transition.velocity.copy(e),this.transition.easeOut=i,this.lookAccel.set(0,0),this.lookVelocity.copy(e),null===(s=this.poseController)||void 0===s||s.beginExternalTransition(),o.promise()}stopTransition(){var t;this.transition.active&&(null===(t=this.poseController)||void 0===t||t.endExternalTransition(),this.transition.active=!1),this.transition.deferred&&(this.transition.deferred.resolve(),this.transition.deferred=void 0)}updateTransition(t){const e=t/n.qD;if(this.lookVelocity.copy(this.transition.velocity),this.transition.elapsed+=t,this.transition.elapsed>=this.transition.duration){const e=this.transition.duration-(this.transition.elapsed-t);this.lookVelocity.multiplyScalar(e/t)}else this.lookVelocity.multiplyScalar(e)}updateCameraParameters(){var t;const e=this.cameraPoseProxy.pose;this.tempEuler.setFromQuaternion(e.rotation,"YXZ");const i=this.tempEuler.x,s=(0,a.qE)(this.lookVelocity.y,n.ol-i,n.vc-i);this.tempAxis.copy(o.B1.RIGHT),this.tempOrientation.setFromAxisAngle(this.tempAxis.applyQuaternion(e.rotation),s),this.currentOrientation.copy(e.rotation).premultiply(this.tempOrientation),this.tempOrientation.setFromAxisAngle(o.B1.UP,this.lookVelocity.x),this.currentOrientation.premultiply(this.tempOrientation),e.rotation.equals(this.currentOrientation)||(this.tempOrientation.copy(this.currentOrientation).normalize(),null===(t=this.poseController)||void 0===t||t.updateCameraRotation(this.tempOrientation))}update(t){const e=this.cameraPoseProxy.pose,i=t/n.qD;e.rotation.equals(this.currentOrientation)||this.currentOrientation.copy(e.rotation),this.transition.active?(this.updateTransition(t),this.updateCameraParameters(),this.transition.elapsed>=this.transition.duration&&(this.stop(this.transition.easeOut),this.transition.active=!1)):(this.lookAccel.length()>r.A.epsilon||this.lookVelocity.length()>r.A.epsilon)&&(this.lookVelocity.addScaledVector(this.lookAccel,i),this.updateCameraParameters(),this.lookVelocity.multiplyScalar(Math.pow(1-n.g1,i)))}stop(t=!1){this.stopTransition(),this.lookAccel.set(0,0),t||this.lookVelocity.set(0,0)}startRotateTransition(t,e,i){return this.beforeStartRotationTransition&&this.beforeStartRotationTransition(),this.startTransition(t,e.clone().multiplyScalar(n.qD),i).nativePromise()}startTranslateTransition(t,e,i=!0){throw new Error("Panning isn't supported in Panorama Controls")}startZoomTransition(t,e,i){throw new Error("Zooming isn't supported in Panorama Controls")}}var d=i(80399),u=i(82110),p=i(79105),y=i(44158),m=i(44634),g=i(32981),O=i(33518),A=i(28997),k=i(35223),v=i(45018),R=i(66175);const x="Rotation speed";class S extends R.A{constructor(){super(...arguments),this.name="panorama-controls",this.controlsEngaged=!1,this.lookAccelerationSpeed=n.V$,this.calcRotationAngle=(()=>{const t=new s.Matrix4,e=new s.Vector3,i=new s.Vector3;return(o,n)=>{t.copy(this.cameraData.pose.projection.asThreeMatrix4()),t.invert(),e.set(o.x-n.x,o.y-n.y,-1).applyMatrix4(t),i.set(o.x,o.y,-1).applyMatrix4(t);const r=Math.sqrt(e.x*e.x+e.z*e.z),a=Math.sqrt(i.x*i.x+i.z*i.z),h=Math.atan2(e.y,r),l=Math.atan2(i.y,a)-h;e.y=0,i.y=0,e.normalize(),i.normalize();const c=Math.acos(e.dot(i));let d=0;return isNaN(c)||(d=c,n.x>0&&(d*=-1)),new s.Vector2(-d,-l)}})()}async init(t,e){const i=await e.getModuleBySymbol(k.X7);this.controls=new c(i.cameraPoseProxy),this.cameraData=await e.market.waitForData(v.M);const s=this.cameraData;this.controls.beforeStartRotationTransition=()=>{s.transition&&s.transition.activeInternal&&s.transition.to.rotation&&(s.transition.to.rotation=void 0)},i.addControls(u.N3.Panorama,this.controls),i.addControls(u.N3.Mesh,this.controls),this.market=e.market,this.registerActiveStateChangeBinding(),e.getModuleBySymbol(k.mL).then((t=>{t.registerHandler(g.SK,(t=>{this.shouldBeActive()&&this.controls.stop()})),t.registerHandler(g.jF,(t=>{this.shouldBeActive()&&t.buttons&p.O.PRIMARY&&(this.controlsEngaged=!0,this.onDrag(t.position,t.delta),this.controls.update(n.qD),this.controls.stop())})),t.registerHandler(g._w,(t=>{this.shouldBeActive()&&this.controlsEngaged&&(t.timeSinceLastMove<100&&!(t.buttons&p.O.PRIMARY)&&(this.onDrag(t.position,t.delta),this.controls.update(n.qD),this.controls.setLookAcceleration({x:0,y:0})),this.controlsEngaged=!1)})),t.registerHandler(O.k,(t=>{this.shouldBeActive()&&this.onKey(t.key,t.state)})),this.updateInputBindings()}))}onUpdate(t){this.shouldBeActive()&&this.controls.update(t)}onDrag(t,e){this.controls.setLookAcceleration(this.calcRotationAngle(t,e))}onKey(t,e){var i,s;const o=null!==(s=null===(i=this.market.tryGetData(A.o))||void 0===i?void 0:i.tryGetProperty(x,null))&&void 0!==s?s:null;this.lookAccelerationSpeed=o?o*(Math.PI/180)/60:this.lookAccelerationSpeed;const n=e===m.$.DOWN;switch(t){case y.D.LEFTARROW:case y.D.J:this.controls.setLookAcceleration({x:n?this.lookAccelerationSpeed:0},!0);break;case y.D.RIGHTARROW:case y.D.L:this.controls.setLookAcceleration({x:n?-this.lookAccelerationSpeed:0},!0);break;case y.D.K:this.controls.setLookAcceleration({y:n?-this.lookAccelerationSpeed:0},!0);break;case y.D.I:this.controls.setLookAcceleration({y:n?this.lookAccelerationSpeed:0},!0)}}shouldBeActive(){var t,e;return null!==(e=!(null===(t=this.market.tryGetData(d.O))||void 0===t?void 0:t.isVR()))&&void 0!==e&&e}}},55415:(t,e,i)=>{i.d(e,{l:()=>o});var s=i(18268);class o extends s.u{constructor(t){super(),this.payload={roomAssociation:t}}}o.id="REGISTER_ROOM_ASSOCIATION_SOURCE"},4143:(t,e,i)=>{i.d(e,{_:()=>n,x:()=>o});var s=i(18268);class o extends s.u{constructor(){super()}}o.id="LOCK_VIEWMODE";class n extends s.u{constructor(){super()}}n.id="UNLOCK_VIEWMODE"},89103:(t,e,i)=>{i.d(e,{m:()=>o});var s=i(68909);class o extends s.Mesh{constructor(t,e){super(t,e)}}},61825:(t,e,i)=>{i.d(e,{Mq:()=>h,Zd:()=>a,_o:()=>l,iE:()=>c});var s=i(68909),o=i(95226);const n=()=>Math.random(),r={},a=(t,e=n())=>(r[e]||(r[e]=new s.Vector4(n(),n(),n(),t)),r[e]),h=()=>new s.Color(n(),n(),n()),l=t=>t instanceof Object&&"r"in t&&"g"in t&&"b"in t;function c(t){return`#${(0,o.Ho)(255*t.r,2,"0",16)}${(0,o.Ho)(255*t.g,2,"0",16)}${(0,o.Ho)(255*t.b,2,"0",16)}`}}}]);