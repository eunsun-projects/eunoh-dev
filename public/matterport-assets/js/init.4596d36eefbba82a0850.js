/*! For license information please see init.4596d36eefbba82a0850.js.LICENSE.txt */
(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[385],{7:e=>{var t={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ViewLayerDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ModelViewLayer"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"layer"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LayerDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"position"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"visible"},arguments:[],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"LayerDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ModelLayer"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]}]}}],loc:{start:0,end:191}};t.loc.source={body:"fragment ViewLayerDetails on ModelViewLayer {\n  layer {\n    ...LayerDetails\n  }\n  position\n  visible\n}\n\nfragment LayerDetails on ModelLayer {\n  id\n  created\n  modified\n  type\n  name\n  label\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function a(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var a=n[t]||new Set,o=new Set,r=new Set;for(a.forEach((function(e){r.add(e)}));r.size>0;){var d=r;r=new Set,d.forEach((function(e){o.has(e)||(o.add(e),(n[e]||new Set).forEach((function(e){r.add(e)})))}))}return o.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.ViewLayerDetails=a(t,"ViewLayerDetails"),e.exports.LayerDetails=a(t,"LayerDetails")},92646:(e,t,i)=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetLayers"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"view"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"layers"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ViewLayerDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddLayer"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"position"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"copyDataFrom"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CopyInput"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"generateIds"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"layer"},name:{kind:"Name",value:"addLayer"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}},{kind:"Argument",name:{kind:"Name",value:"position"},value:{kind:"Variable",name:{kind:"Name",value:"position"}}},{kind:"Argument",name:{kind:"Name",value:"copyDataFrom"},value:{kind:"Variable",name:{kind:"Name",value:"copyDataFrom"}}},{kind:"Argument",name:{kind:"Name",value:"generateIds"},value:{kind:"Variable",name:{kind:"Name",value:"generateIds"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LayerDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddCommonLayer"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"position"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"layer"},name:{kind:"Name",value:"addCommonLayer"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}},{kind:"Argument",name:{kind:"Name",value:"position"},value:{kind:"Variable",name:{kind:"Name",value:"position"}}},{kind:"Argument",name:{kind:"Name",value:"viewTypes"},value:{kind:"ListValue",values:[{kind:"StringValue",value:"matterport.model.default",block:!1},{kind:"StringValue",value:"matterport.model.layered",block:!1},{kind:"StringValue",value:"matterport.user.view",block:!1},{kind:"StringValue",value:"matterport.model.defurnished",block:!1}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LayerDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchLayerViews"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"layerId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"views"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ViewLayerPatch"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchLayerViews"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}},{kind:"Argument",name:{kind:"Name",value:"layerId"},value:{kind:"Variable",name:{kind:"Name",value:"layerId"}}},{kind:"Argument",name:{kind:"Name",value:"views"},value:{kind:"Variable",name:{kind:"Name",value:"views"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LayerDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchLayer"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"layerId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"layerLabel"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"visible"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"position"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchLayer"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}},{kind:"Argument",name:{kind:"Name",value:"layerId"},value:{kind:"Variable",name:{kind:"Name",value:"layerId"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"layerLabel"}}},{kind:"Argument",name:{kind:"Name",value:"visible"},value:{kind:"Variable",name:{kind:"Name",value:"visible"}}},{kind:"Argument",name:{kind:"Name",value:"position"},value:{kind:"Variable",name:{kind:"Name",value:"position"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LayerDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ConvertToCommonLayer"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"layerId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"visible"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"position"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"convertToCommonLayer"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}},{kind:"Argument",name:{kind:"Name",value:"layerId"},value:{kind:"Variable",name:{kind:"Name",value:"layerId"}}},{kind:"Argument",name:{kind:"Name",value:"visible"},value:{kind:"Variable",name:{kind:"Name",value:"visible"}}},{kind:"Argument",name:{kind:"Name",value:"position"},value:{kind:"Variable",name:{kind:"Name",value:"position"}}},{kind:"Argument",name:{kind:"Name",value:"viewTypes"},value:{kind:"ListValue",values:[{kind:"StringValue",value:"matterport.model.default",block:!1},{kind:"StringValue",value:"matterport.model.layered",block:!1},{kind:"StringValue",value:"matterport.user.view",block:!1},{kind:"StringValue",value:"matterport.model.defurnished",block:!1}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LayerDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ConvertToDedicatedLayer"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"layerId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"convertToDedicatedLayer"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}},{kind:"Argument",name:{kind:"Name",value:"layerId"},value:{kind:"Variable",name:{kind:"Name",value:"layerId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LayerDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteLayer"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"layerId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteLayer"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}},{kind:"Argument",name:{kind:"Name",value:"layerId"},value:{kind:"Variable",name:{kind:"Name",value:"layerId"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DuplicateLayer"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"visible"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"copyDataFrom"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CopyInput"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"layer"},name:{kind:"Name",value:"addLayer"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}},{kind:"Argument",name:{kind:"Name",value:"visible"},value:{kind:"Variable",name:{kind:"Name",value:"visible"}}},{kind:"Argument",name:{kind:"Name",value:"copyDataFrom"},value:{kind:"Variable",name:{kind:"Name",value:"copyDataFrom"}}},{kind:"Argument",name:{kind:"Name",value:"generateIds"},value:{kind:"BooleanValue",value:!0}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LayerDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ConvertToProxiedLayering"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"convertModelRoomDataToProxiedLayering"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[]}]}}],loc:{start:0,end:2274}};n.loc.source={body:'#import "./layer-fragments.gql"\n\nquery GetLayers($viewId: ID!) {\n  view(id: $viewId) {\n    id\n    layers {\n      ...ViewLayerDetails\n    }\n  }\n}\n\nmutation AddLayer($viewId: ID!, $label: String, $position: Int, $copyDataFrom: [CopyInput!], $generateIds: Boolean) {\n  layer: addLayer(id: $viewId, label: $label, position: $position, copyDataFrom: $copyDataFrom, generateIds: $generateIds) {\n    ...LayerDetails\n  }\n}\n\nmutation AddCommonLayer($viewId: ID!, $label: String, $position: Int) {\n  layer: addCommonLayer(\n    id: $viewId,\n    label: $label,\n    position: $position,\n    viewTypes: [\n      "matterport.model.default",\n      "matterport.model.layered",\n      "matterport.user.view",\n      "matterport.model.defurnished",\n    ],\n  ) {\n    ...LayerDetails\n  }\n}\n\n# Used for patching a layer across views\nmutation PatchLayerViews($viewId: ID!, $layerId: ID!, $views: [ViewLayerPatch!]) {\n  patchLayerViews(id: $viewId, layerId: $layerId, views: $views) {\n    ...LayerDetails\n  }\n}\n\nmutation PatchLayer($viewId: ID!, $layerId: ID!, $layerLabel: String, $visible: Boolean, $position: Int) {\n  patchLayer(id: $viewId, layerId: $layerId, label: $layerLabel, visible: $visible, position: $position) {\n    ...LayerDetails\n  }\n}\n\nmutation ConvertToCommonLayer($viewId: ID!, $layerId: ID!, $visible: Boolean, $position: Int) {\n  convertToCommonLayer(\n    id: $viewId,\n    layerId: $layerId,\n    visible: $visible,\n    position: $position,\n    viewTypes: [\n      "matterport.model.default",\n      "matterport.model.layered",\n      "matterport.user.view",\n      "matterport.model.defurnished",\n    ],\n  ) {\n    ...LayerDetails\n  }\n}\n\nmutation ConvertToDedicatedLayer($viewId: ID!, $layerId: ID!) {\n  convertToDedicatedLayer(\n    id: $viewId,\n    layerId: $layerId,\n  ) {\n    ...LayerDetails\n  }\n}\n\nmutation DeleteLayer($viewId: ID!, $layerId: ID!) {\n  deleteLayer(id:$viewId, layerId: $layerId)\n}\n\nmutation DuplicateLayer($viewId: ID!, $label: String!, $visible: Boolean, $copyDataFrom: [CopyInput!]) {\n  layer: addLayer(\n    id: $viewId\n    label: $label\n    visible: $visible\n    copyDataFrom: $copyDataFrom\n    generateIds: true,\n  ) {\n    ...LayerDetails\n  }\n}\n\n\nmutation ConvertToProxiedLayering($modelId: ID!) {\n  convertModelRoomDataToProxiedLayering(\n    id: $modelId\n  )\n}',name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function a(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){a(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){a(e,t)})),e.definitions&&e.definitions.forEach((function(e){a(e,t)}))}n.definitions=n.definitions.concat(i(7).definitions.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!s[t]&&(s[t]=!0,!0)})));var o={};function r(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function d(e,t){var i={kind:e.kind,definitions:[r(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=o[t]||new Set,s=new Set,a=new Set;for(n.forEach((function(e){a.add(e)}));a.size>0;){var d=a;a=new Set,d.forEach((function(e){s.has(e)||(s.add(e),(o[e]||new Set).forEach((function(e){a.add(e)})))}))}return s.forEach((function(t){var n=r(e,t);n&&i.definitions.push(n)})),i}n.definitions.forEach((function(e){if(e.name){var t=new Set;a(e,t),o[e.name.value]=t}})),e.exports=n,e.exports.GetLayers=d(n,"GetLayers"),e.exports.AddLayer=d(n,"AddLayer"),e.exports.AddCommonLayer=d(n,"AddCommonLayer"),e.exports.PatchLayerViews=d(n,"PatchLayerViews"),e.exports.PatchLayer=d(n,"PatchLayer"),e.exports.ConvertToCommonLayer=d(n,"ConvertToCommonLayer"),e.exports.ConvertToDedicatedLayer=d(n,"ConvertToDedicatedLayer"),e.exports.DeleteLayer=d(n,"DeleteLayer"),e.exports.DuplicateLayer=d(n,"DuplicateLayer"),e.exports.ConvertToProxiedLayering=d(n,"ConvertToProxiedLayering")},11826:(e,t,i)=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetModelOptions"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"ModelPlayerOptions"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchModel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"patch"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ModelPatch"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchModel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"patch"},value:{kind:"Variable",name:{kind:"Name",value:"patch"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:261}};n.loc.source={body:'#import "./model-options-fragments.gql"\n\nquery GetModelOptions($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    ...ModelPlayerOptions\n  }\n}\n\nmutation PatchModel($modelId: ID!, $patch: ModelPatch!) {\n  patchModel(id: $modelId, , patch: $patch) {\n    id\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function a(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){a(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){a(e,t)})),e.definitions&&e.definitions.forEach((function(e){a(e,t)}))}n.definitions=n.definitions.concat(i(82038).definitions.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!s[t]&&(s[t]=!0,!0)})));var o={};function r(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function d(e,t){var i={kind:e.kind,definitions:[r(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=o[t]||new Set,s=new Set,a=new Set;for(n.forEach((function(e){a.add(e)}));a.size>0;){var d=a;a=new Set,d.forEach((function(e){s.has(e)||(s.add(e),(o[e]||new Set).forEach((function(e){a.add(e)})))}))}return s.forEach((function(t){var n=r(e,t);n&&i.definitions.push(n)})),i}n.definitions.forEach((function(e){if(e.name){var t=new Set;a(e,t),o[e.name.value]=t}})),e.exports=n,e.exports.GetModelOptions=d(n,"GetModelOptions"),e.exports.PatchModel=d(n,"PatchModel")},71271:(e,t,i)=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetModelDetails"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ModelDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetModelImage"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"image"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetStartLocations"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"views"},arguments:[{kind:"Argument",name:{kind:"Name",value:"types"},value:{kind:"ListValue",values:[{kind:"StringValue",value:"matterport.model.default",block:!1},{kind:"StringValue",value:"matterport.model.layered",block:!1},{kind:"StringValue",value:"matterport.user.view",block:!1},{kind:"StringValue",value:"matterport.model.defurnished",block:!1}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"model"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"image"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"snapshotLocation"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"anchor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}}]}}]}}]}}]}}],loc:{start:0,end:654}};n.loc.source={body:'#import "./model-fragments.gql"\n#import "./photo-fragments.gql"\n#import "./overlay-fragments.gql"\n\nquery GetModelDetails($modelId: ID!) {\n  model(id: $modelId) {\n    ...ModelDetails\n  }\n}\n\nquery GetModelImage($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    image { ...PhotoDetails }\n  }\n}\n\nquery GetStartLocations($modelId: ID!) {\n  model(id: $modelId) {\n    views(types: ["matterport.model.default", "matterport.model.layered", "matterport.user.view", "matterport.model.defurnished"]) {\n      id\n      model {\n        image {\n          snapshotLocation {\n            anchor {\n              id\n            }\n          }\n        }\n      }\n    }\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function a(e){return e.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!s[t]&&(s[t]=!0,!0)}))}function o(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){o(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){o(e,t)})),e.definitions&&e.definitions.forEach((function(e){o(e,t)}))}n.definitions=n.definitions.concat(a(i(14991).definitions)),n.definitions=n.definitions.concat(a(i(10600).definitions)),n.definitions=n.definitions.concat(a(i(25e3).definitions));var r={};function d(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function l(e,t){var i={kind:e.kind,definitions:[d(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=r[t]||new Set,s=new Set,a=new Set;for(n.forEach((function(e){a.add(e)}));a.size>0;){var o=a;a=new Set,o.forEach((function(e){s.has(e)||(s.add(e),(r[e]||new Set).forEach((function(e){a.add(e)})))}))}return s.forEach((function(t){var n=d(e,t);n&&i.definitions.push(n)})),i}n.definitions.forEach((function(e){if(e.name){var t=new Set;o(e,t),r[e.name.value]=t}})),e.exports=n,e.exports.GetModelDetails=l(n,"GetModelDetails"),e.exports.GetModelImage=l(n,"GetModelImage"),e.exports.GetStartLocations=l(n,"GetStartLocations")},58619:(e,t,i)=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetSnapshots"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"photos"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}},{kind:"Field",alias:{kind:"Name",value:"defurnishedViews"},name:{kind:"Name",value:"views"},arguments:[{kind:"Argument",name:{kind:"Name",value:"types"},value:{kind:"StringValue",value:"matterport.model.defurnished",block:!1}}],directives:[{kind:"Directive",name:{kind:"Name",value:"onError"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"StringValue",value:"not.found",block:!1}},{kind:"Argument",name:{kind:"Name",value:"null"},value:{kind:"BooleanValue",value:!0}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"photos"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchPhoto"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"photoId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchPhoto"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"photoId"},value:{kind:"Variable",name:{kind:"Name",value:"photoId"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeletePhoto"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"photoId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deletePhoto"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"photoId"},value:{kind:"Variable",name:{kind:"Name",value:"photoId"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UploadHighlightReelSnapshot"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contents"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FileUpload"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SnapshotLocationInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"snapshot"},name:{kind:"Name",value:"uploadHighlightReelSnapshot"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"contents"},value:{kind:"Variable",name:{kind:"Name",value:"contents"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}},{kind:"Argument",name:{kind:"Name",value:"snapshotLocation"},value:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UploadModelSnapshot"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contents"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FileUpload"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SnapshotLocationInput"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"photoType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PhotoType"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"snapshot"},name:{kind:"Name",value:"uploadModelSnapshot"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"contents"},value:{kind:"Variable",name:{kind:"Name",value:"contents"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}},{kind:"Argument",name:{kind:"Name",value:"snapshotLocation"},value:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}}},{kind:"Argument",name:{kind:"Name",value:"photoType"},value:{kind:"Variable",name:{kind:"Name",value:"photoType"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}}],loc:{start:0,end:1396}};n.loc.source={body:'#import "./photo-fragments.gql"\n\n# Get photo snapshot details.\n# This query is run as anonymous in Showcase, so it must only contain public fields.\nquery GetSnapshots($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    assets {\n      photos { ...PhotoDetails }\n    }\n    defurnishedViews: views(types: "matterport.model.defurnished") @onError(id: "not.found", null: true) {\n      model {\n        id\n        assets {\n          photos {\n            ...PhotoDetails\n          }\n        }\n      }\n    }\n  }\n}\n\nmutation PatchPhoto($modelId: ID!, $photoId: ID!, $label: String!) {\n  patchPhoto(modelId: $modelId, photoId: $photoId, label: $label) {\n    ...PhotoDetails\n  }\n}\n\nmutation DeletePhoto($modelId: ID!, $photoId: ID!) {\n  deletePhoto(modelId: $modelId, photoId: $photoId)\n}\n\nmutation UploadHighlightReelSnapshot($modelId: ID!, $contents: FileUpload!, $label: String!, $snapshotLocation: SnapshotLocationInput!) {\n  snapshot: uploadHighlightReelSnapshot(id: $modelId, contents: $contents, label: $label, snapshotLocation: $snapshotLocation) {\n    ...PhotoDetails\n  }\n}\n\nmutation UploadModelSnapshot($modelId: ID!, $contents: FileUpload!, $label: String!, $snapshotLocation: SnapshotLocationInput!, $photoType: PhotoType!) {\n  snapshot: uploadModelSnapshot(id: $modelId, contents: $contents, label: $label, snapshotLocation: $snapshotLocation, photoType: $photoType) {\n    ...PhotoDetails\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function a(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){a(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){a(e,t)})),e.definitions&&e.definitions.forEach((function(e){a(e,t)}))}n.definitions=n.definitions.concat(i(10600).definitions.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!s[t]&&(s[t]=!0,!0)})));var o={};function r(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function d(e,t){var i={kind:e.kind,definitions:[r(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=o[t]||new Set,s=new Set,a=new Set;for(n.forEach((function(e){a.add(e)}));a.size>0;){var d=a;a=new Set,d.forEach((function(e){s.has(e)||(s.add(e),(o[e]||new Set).forEach((function(e){a.add(e)})))}))}return s.forEach((function(t){var n=r(e,t);n&&i.definitions.push(n)})),i}n.definitions.forEach((function(e){if(e.name){var t=new Set;a(e,t),o[e.name.value]=t}})),e.exports=n,e.exports.GetSnapshots=d(n,"GetSnapshots"),e.exports.PatchPhoto=d(n,"PatchPhoto"),e.exports.DeletePhoto=d(n,"DeletePhoto"),e.exports.UploadHighlightReelSnapshot=d(n,"UploadHighlightReelSnapshot"),e.exports.UploadModelSnapshot=d(n,"UploadModelSnapshot")},9026:(e,t,i)=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetModelViewPrefetch"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeLayers"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mattertags"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MattertagDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"orderedLists"},arguments:[{kind:"Argument",name:{kind:"Name",value:"ids"},value:{kind:"ListValue",values:[]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"OrderedListDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"labels"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LabelDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"measurementPaths"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MeasurementDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"activeHighlightReel"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"HighlightReelDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"image"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"view"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"layers"},arguments:[],directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeLayers"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ViewLayerDetails"},directives:[]}]}}]}}]}}],loc:{start:0,end:997}};n.loc.source={body:'# Prefetch all data that changes for a view in one go.  Allows us to do an atomic view change and know that the data\n# is good.\n\n#import "./layer-fragments.gql"\n#import "./mattertags.gql"\n#import "./lists.gql"\n#import "./labels.gql"\n#import "./measurements.gql"\n#import "./notes.gql"\n#import "./highlights.gql"\n#import "./photo-fragments.gql"\n\nquery GetModelViewPrefetch($modelId: ID!, $includeDisabled: Boolean!, $includeLayers: Boolean!) {\n  model(id: $modelId) {\n    id\n    mattertags(includeDisabled: $includeDisabled) {\n      ...MattertagDetails\n    }\n    orderedLists(ids: []) {\n      ...OrderedListDetails\n    }\n    labels(includeDisabled: $includeDisabled) {\n      ...LabelDetails\n    }\n    measurementPaths(includeDisabled: $includeDisabled) {\n      ...MeasurementDetails\n    }\n    activeHighlightReel {\n      ...HighlightReelDetails\n    }\n    image {\n      ...PhotoDetails\n    }\n  }\n  view (id: $modelId) {\n    layers @include(if: $includeLayers) {\n      ...ViewLayerDetails\n    }\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function a(e){return e.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!s[t]&&(s[t]=!0,!0)}))}function o(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){o(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){o(e,t)})),e.definitions&&e.definitions.forEach((function(e){o(e,t)}))}n.definitions=n.definitions.concat(a(i(7).definitions)),n.definitions=n.definitions.concat(a(i(27140).definitions)),n.definitions=n.definitions.concat(a(i(92711).definitions)),n.definitions=n.definitions.concat(a(i(96069).definitions)),n.definitions=n.definitions.concat(a(i(64639).definitions)),n.definitions=n.definitions.concat(a(i(44919).definitions)),n.definitions=n.definitions.concat(a(i(93327).definitions)),n.definitions=n.definitions.concat(a(i(10600).definitions));var r={};function d(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}n.definitions.forEach((function(e){if(e.name){var t=new Set;o(e,t),r[e.name.value]=t}})),e.exports=n,e.exports.GetModelViewPrefetch=function(e,t){var i={kind:e.kind,definitions:[d(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=r[t]||new Set,s=new Set,a=new Set;for(n.forEach((function(e){a.add(e)}));a.size>0;){var o=a;a=new Set,o.forEach((function(e){s.has(e)||(s.add(e),(r[e]||new Set).forEach((function(e){a.add(e)})))}))}return s.forEach((function(t){var n=d(e,t);n&&i.definitions.push(n)})),i}(n,"GetModelViewPrefetch")},89383:(e,t,i)=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetSweeps"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"OverlayLayerExists"},directives:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"OverlayViewIds"},directives:[]},{kind:"Field",name:{kind:"Name",value:"locations"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AnchorLocationDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetShowcaseSweeps"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"OverlayLayerExists"},directives:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"OverlayViewIds"},directives:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"ModelShowcaseSweeps"},directives:[]}]}}]}}],loc:{start:0,end:395}};n.loc.source={body:'#import "./overlay-fragments.gql"\n#import "./sweeps-fragments.gql"\n\nquery GetSweeps($modelId: ID!) {\n  model(id: $modelId) {\n    id,\n    ...OverlayLayerExists\n    ...OverlayViewIds\n    locations {\n      ...AnchorLocationDetails\n    }\n  }\n}\n\nquery GetShowcaseSweeps($modelId: ID!) {\n  model(id: $modelId) {\n    id,\n    ...OverlayLayerExists\n    ...OverlayViewIds\n    ...ModelShowcaseSweeps\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function a(e){return e.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!s[t]&&(s[t]=!0,!0)}))}function o(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){o(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){o(e,t)})),e.definitions&&e.definitions.forEach((function(e){o(e,t)}))}n.definitions=n.definitions.concat(a(i(25e3).definitions)),n.definitions=n.definitions.concat(a(i(77583).definitions));var r={};function d(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function l(e,t){var i={kind:e.kind,definitions:[d(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=r[t]||new Set,s=new Set,a=new Set;for(n.forEach((function(e){a.add(e)}));a.size>0;){var o=a;a=new Set,o.forEach((function(e){s.has(e)||(s.add(e),(r[e]||new Set).forEach((function(e){a.add(e)})))}))}return s.forEach((function(t){var n=d(e,t);n&&i.definitions.push(n)})),i}n.definitions.forEach((function(e){if(e.name){var t=new Set;o(e,t),r[e.name.value]=t}})),e.exports=n,e.exports.GetSweeps=l(n,"GetSweeps"),e.exports.GetShowcaseSweeps=l(n,"GetShowcaseSweeps")},46240:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetCurrentUserModelAccess"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"organization"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"demo"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"users"},arguments:[{kind:"Argument",name:{kind:"Name",value:"ids"},value:{kind:"ListValue",values:[{kind:"Variable",name:{kind:"Name",value:"userId"}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"results"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"modelAccess"},arguments:[],directives:[]}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetUsers"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"search"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"ids"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"emails"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"users"},arguments:[{kind:"Argument",name:{kind:"Name",value:"search"},value:{kind:"Variable",name:{kind:"Name",value:"search"}}},{kind:"Argument",name:{kind:"Name",value:"ids"},value:{kind:"Variable",name:{kind:"Name",value:"ids"}}},{kind:"Argument",name:{kind:"Name",value:"emails"},value:{kind:"Variable",name:{kind:"Name",value:"emails"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"results"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"email"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"firstName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lastName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelAccess"},arguments:[],directives:[]}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddOrUpdateModelShareAccess"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"email"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"roleId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"message"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addOrUpdateModelShareAccess"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"email"},value:{kind:"Variable",name:{kind:"Name",value:"email"}}},{kind:"Argument",name:{kind:"Name",value:"roleId"},value:{kind:"Variable",name:{kind:"Name",value:"roleId"}}},{kind:"Argument",name:{kind:"Name",value:"invitationMessage"},value:{kind:"Variable",name:{kind:"Name",value:"message"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"email"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"firstName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lastName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"modelShareAccessLevel"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetAssignableRoles"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"assignableRoles"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:1128}};t.loc.source={body:"# get access for the current user\nquery GetCurrentUserModelAccess($modelId: ID!, $userId: ID!) {\n  model(id: $modelId) {\n    id\n    organization\n    demo\n    created\n    users(ids: [$userId]) {\n      results {\n        modelAccess\n      }\n    }\n  }\n}\n\n# get users with access to the specified model\nquery GetUsers($modelId: ID!, $search: String, $ids: [ID!], $emails: [String!]) {\n  model(id: $modelId) {\n    users(search: $search, ids: $ids, emails: $emails) {\n      results {\n        id\n        email\n        firstName\n        lastName\n        modelAccess\n      }\n    }\n  }\n}\n\n# Add model share access by email\nmutation AddOrUpdateModelShareAccess($modelId:ID!, $email:String!, $roleId:ID!, $message:String) {\n  addOrUpdateModelShareAccess(\n    modelId:$modelId\n    email:$email\n    roleId:$roleId\n    invitationMessage:$message\n  ) {\n    user {\n      id\n      email\n      firstName\n      lastName\n    }\n    modelShareAccessLevel {\n      id\n      name\n    }\n  }\n}\n\n# Get roles that can be assigned to a model\nquery GetAssignableRoles($modelId:ID!) {\n  model(id:$modelId) {\n    assignableRoles {\n      id\n      name\n    }\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function a(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var a=n[t]||new Set,o=new Set,r=new Set;for(a.forEach((function(e){r.add(e)}));r.size>0;){var d=r;r=new Set,d.forEach((function(e){o.has(e)||(o.add(e),(n[e]||new Set).forEach((function(e){r.add(e)})))}))}return o.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetCurrentUserModelAccess=a(t,"GetCurrentUserModelAccess"),e.exports.GetUsers=a(t,"GetUsers"),e.exports.AddOrUpdateModelShareAccess=a(t,"AddOrUpdateModelShareAccess"),e.exports.GetAssignableRoles=a(t,"GetAssignableRoles")},40356:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>de});var n,s=i(74848),a=i(8660);!function(e){e.DEFAULT="https://support.matterport.com/",e.MODEL_ARCHIVED="https://support.matterport.com/s/article/What-is-an-Active-or-Archived-Space",e.MODEL_COMPLIANCE="https://support.matterport.com/s/article/Matterport-IP-restrictions",e.MODEL_FAILED="https://support.matterport.com/s/article/Why-did-my-model-fail-in-processing",e.MODEL_NOT_AVAILABLE="https://support.matterport.com/s/article/Oops-Model-Not-Available",e.MODEL_PENDING="https://support.matterport.com/s/article/How-to-Upload-Your-Model?parentCategoryLabel=#pending",e.MODEL_PROCESSING="https://support.matterport.com/s/article/How-long-does-a-model-take-to-process",e.MODEL_DELETED="https://support.matterport.com/s/article/Restoring-a-Deleted-Space",e.SYSTEM_REQUIREMENTS="https://support.matterport.com/s/article/Workshop-System-Requirements"}(n||(n={}));const o=i.p+"images/matterport-logo.svg";var r=i(32903),d=i(99366),l=i(96540);const c={errorCode:r.b.GENERIC,t:e=>e},h=(0,l.createContext)(c);var u=i(32485),m=i.n(u);const p="GojYAp7M1DFFOeeNCkOX",v="xqrMhOouOAwfGeEHn3lJ",g="EIslsqhaJC0nIAaEoG_1",y="zDv1eTmFWr2ikMCkcV_x";function f({alt:e,className:t,name:n,theme:a="light",size:o="160",geometry:r="standard"}){const{isLoading:d,svgUrl:c}=(({name:e,theme:t,geometry:n})=>{const[s,a]=(0,l.useState)(!1),[o,r]=(0,l.useState)(void 0);return(0,l.useEffect)((()=>{(async()=>{a(!0),await i.e(942).then(i.bind(i,45239)).then((e=>{r((()=>e.getImageUrl))})).finally((()=>{a(!1)}))})()}),[]),{isLoading:s,svgUrl:null==o?void 0:o(e,t,n)}})({name:n,theme:a,geometry:r}),h=null!=e?e:null==n?void 0:n.replace("-"," ");return(0,s.jsx)("span",Object.assign({className:m()(p,{[g]:"160"===o,[y]:"200"===o},t)},{children:!d&&c&&(0,s.jsx)("img",{alt:h,className:v,"data-testid":`brandicon_${n}_${r}_${a}`,height:o,src:c,width:o})}))}const w="z_1kq1bF5WbWgWASVVpq",b="PuUwlrXdskjGjzpyKFJE",k="KT8UwRiR6ZckAJOCqdMA",T="Mt_yo3TCEThwCo1Z4F9A",S="UQQr3Jr0ogb26yLyiavl";function I({brandIcon:e,children:t,title:i}){return(0,s.jsxs)("div",Object.assign({"data-testid":"error_message",className:m()(w,{[S]:!!e})},{children:[e&&(0,s.jsx)(f,{name:e,theme:"dark",className:T}),(0,s.jsxs)("div",Object.assign({className:b},{children:[(0,s.jsx)("header",{children:(0,s.jsx)("h1",Object.assign({"data-testid":"error_title",className:k},{children:i}))}),t]}))]}))}const E=()=>{const{t:e}=(0,l.useContext)(h);return(0,s.jsx)(I,Object.assign({title:e(d.A.OOPS.MODEL_ARCHIVED_TITLE),brandIcon:"twinmaker"},{children:(0,s.jsx)("p",{"data-testid":"error_helptext",dangerouslySetInnerHTML:{__html:e(d.A.OOPS.MODEL_ARCHIVED_HELPTEXT,{url:n.MODEL_ARCHIVED})}})}))},N=()=>{const{t:e}=(0,l.useContext)(h);return(0,s.jsx)(I,Object.assign({title:e(d.A.OOPS.MODEL_COMPLIANCE_TITLE),brandIcon:"compliance-training"},{children:(0,s.jsx)("p",{"data-testid":"error_helptext",dangerouslySetInnerHTML:{__html:e(d.A.OOPS.MODEL_COMPLIANCE_HELPTEXT,{url:n.MODEL_COMPLIANCE})}})}))},D=()=>{const{t:e}=(0,l.useContext)(h);return(0,s.jsx)(I,Object.assign({title:e(d.A.OOPS.MODEL_DELETED_TITLE)},{children:(0,s.jsxs)("p",Object.assign({"data-testid":"error_helptext"},{children:[(0,s.jsx)("a",Object.assign({href:n.MODEL_DELETED,target:"_blank"},{children:e(d.A.LEARN_MORE)})),"."]}))}))},C=()=>{const{t:e}=(0,l.useContext)(h);return(0,s.jsx)(I,Object.assign({title:e(d.A.OOPS.MODEL_FAILED_TITLE)},{children:(0,s.jsx)("p",{"data-testid":"error_helptext",dangerouslySetInnerHTML:{__html:e(d.A.OOPS.MODEL_FAILED_HELPTEXT,{url:n.MODEL_FAILED})}})}))},M=()=>{const{t:e}=(0,l.useContext)(h);return(0,s.jsx)(I,Object.assign({title:e(d.A.OOPS.MODEL_PENDING_TITLE),brandIcon:"delay"},{children:(0,s.jsx)("p",{"data-testid":"error_helptext",dangerouslySetInnerHTML:{__html:e(d.A.OOPS.MODEL_PENDING_HELPTEXT,{url:n.MODEL_PENDING})}})}))},O=()=>{const{t:e}=(0,l.useContext)(h);return(0,s.jsx)(I,Object.assign({title:e(d.A.OOPS.MODEL_PROCESSING_TITLE),brandIcon:"process-data"},{children:(0,s.jsx)("p",{"data-testid":"error_helptext",dangerouslySetInnerHTML:{__html:e(d.A.OOPS.MODEL_PROCESSING_HELPTEXT,{url:n.MODEL_PROCESSING})}})}))},_=()=>{const{t:e}=(0,l.useContext)(h);return(0,s.jsx)(I,Object.assign({title:e(d.A.OOPS.WEBGL_CONTEXT_LOST_TITLE)},{children:(0,s.jsx)("p",{"data-testid":"error_helptext",dangerouslySetInnerHTML:{__html:e(d.A.OOPS.WEBGL_CONTEXT_LOST_HELPTEXT,{url:n.DEFAULT})}})}))};var A=i(8430);const P=i.p+"images/chrome.png",L=i.p+"images/edge.png",x=i.p+"images/firefox.png",R=i.p+"images/safari.png",V="wDEZ5gbuUMn_3wViwWbl",U="hWgwze04gjLRHKZKqyia",B=()=>(0,s.jsxs)("ul",Object.assign({className:V,"data-testid":"browser_list"},{children:[(0,s.jsx)("li",{children:(0,s.jsx)("a",Object.assign({href:"https://www.google.com/chrome/browser/",target:"_blank"},{children:(0,s.jsx)("div",Object.assign({className:"tile"},{children:(0,s.jsx)("img",{src:P,alt:"Chrome",width:"35",height:"35",className:U})}))}))}),(0,s.jsx)("li",{children:(0,s.jsx)("a",Object.assign({href:"https://www.mozilla.org/en-US/firefox/new/",target:"_blank"},{children:(0,s.jsx)("div",Object.assign({className:"tile"},{children:(0,s.jsx)("img",{src:x,alt:"Firefox",width:"35",height:"35",className:U})}))}))}),(0,s.jsx)("li",{children:(0,s.jsx)("a",Object.assign({href:"https://www.microsoft.com/en-us/edge",target:"_blank"},{children:(0,s.jsx)("div",Object.assign({className:"tile"},{children:(0,s.jsx)("img",{src:L,alt:"Edge",width:"35",height:"35",className:U})}))}))}),(0,A.cX)()&&(0,s.jsx)("li",{children:(0,s.jsx)("a",Object.assign({href:"https://support.apple.com/en-us/HT204416",target:"_blank"},{children:(0,s.jsx)("div",Object.assign({className:"tile"},{children:(0,s.jsx)("img",{src:R,alt:"Safari",width:"35",height:"35",className:U})}))}))})]})),G=()=>{const{t:e}=(0,l.useContext)(h),t=!(0,A.Fr)(),i=e(d.A.OOPS.WEBGL_GENERIC_HELPTEXT,{url:n.DEFAULT});return(0,s.jsxs)(I,Object.assign({title:e(d.A.OOPS.WEBGL_GENERIC_TITLE)},{children:[(0,s.jsx)("p",{"data-testid":"error_helptext",dangerouslySetInnerHTML:{__html:i}}),t&&(0,s.jsx)(B,{})]}))},F=()=>{const{t:e}=(0,l.useContext)(h);return(0,s.jsxs)(I,Object.assign({title:e(d.A.OOPS.WEBGL_UNSUPPORTED_TITLE)},{children:[(0,s.jsx)("p",{"data-testid":"error_helptext",dangerouslySetInnerHTML:{__html:e(d.A.OOPS.WEBGL_UNSUPPORTED_HELPTEXT,{url:n.SYSTEM_REQUIREMENTS})}}),(0,s.jsx)(B,{})]}))},j=()=>{const{t:e}=(0,l.useContext)(h);return(0,s.jsx)(I,Object.assign({title:e(d.A.OOPS.GENERIC_TITLE)},{children:(0,s.jsx)("p",{"data-testid":"error_helptext",dangerouslySetInnerHTML:{__html:e(d.A.OOPS.GENERIC_HELPTEXT,{url:n.MODEL_NOT_AVAILABLE})}})}))},H=({errorCode:e})=>e===r.b.MODEL_ARCHIVED?(0,s.jsx)(E,{}):e===r.b.MODEL_COMPLIANCE?(0,s.jsx)(N,{}):e===r.b.MODEL_DELETED?(0,s.jsx)(D,{}):e===r.b.MODEL_FAILED?(0,s.jsx)(C,{}):e===r.b.MODEL_PENDING?(0,s.jsx)(M,{}):e===r.b.MODEL_PROCESSING?(0,s.jsx)(O,{}):e===r.b.WEBGL_CONTEXT_LOST?(0,s.jsx)(_,{}):e===r.b.WEBGL_GENERIC?(0,s.jsx)(G,{}):e===r.b.WEBGL_UNSUPPORTED?(0,s.jsx)(F,{}):(0,s.jsx)(j,{});var $=i(24746);const z=$.J1`
  query GetCurrentUser {
    currentSession {
      currentUser {
        id
        email
        firstName
        lastName
      }
    }
  }
`,W=async({apiHost:e})=>{var t;const i=`${e}/api/mp/accounts/graph`,n=await(0,$.Em)(i,z),s=null===(t=null==n?void 0:n.currentSession)||void 0===t?void 0:t.currentUser;if(null==s?void 0:s.id)return{id:s.id,email:s.email||"",firstName:s.firstName||"",lastName:s.lastName||""}},K="rTNtNODkK_JN9uZ5lxXg",X="mhVRM5W86Gm0anAOYzYV",q="LhALJviYhIox8w_LlQfH",Y=({firstName:e,lastName:t,email:i})=>{const n=`${(null==e?void 0:e[0])||""}${(null==t?void 0:t[0])||""}`;return(0,s.jsxs)("div",Object.assign({"data-testid":"user_pill",className:X},{children:[(0,s.jsx)("span",Object.assign({"data-testid":"user_avatar",className:q},{children:n})),(0,s.jsx)("span",{children:i})]}))},Q=()=>{const{t:e}=(0,l.useContext)(h),{user:t}=(()=>{const{apiHost:e}=(0,l.useContext)(h),{isLoading:t,error:i,data:n}=(0,a.Ay)(["CurrentUser"],(()=>W({apiHost:e})));return{isAuthenticated:!!n&&!i,isLoading:t,user:n}})();return t?(0,s.jsxs)("div",Object.assign({"data-testid":"user_info",className:K},{children:[e(d.A.OOPS.SIGNED_IN_AS),(0,s.jsx)(Y,{firstName:t.firstName,lastName:t.lastName,email:t.email})]})):null},Z="MI7fRUdVHfgOIznz_vs6",J="VepOVjbGgw_GLl1ZWLfX",ee="FnfzcTpPDGLYM7peXfIr",te="w0mlRAiUdda7u4WwMajt",ie=({errorCode:e})=>(0,s.jsxs)("section",Object.assign({"data-testid":"error_page",className:Z},{children:[(0,s.jsx)("div",Object.assign({className:J},{children:(0,s.jsx)(H,{errorCode:e})})),(0,s.jsxs)("footer",Object.assign({className:ee},{children:[(0,s.jsx)("a",Object.assign({href:"https://matterport.com",target:"_blank"},{children:(0,s.jsx)("img",{src:o,alt:"Matterport logo",width:"178",height:"30",className:te})})),(0,s.jsx)(Q,{})]}))]}));function ne({apiHost:e,errorCode:t=r.b.GENERIC,t:i=e=>e}){const n={apiHost:e,errorCode:t,t:i};return(0,s.jsx)(a.BE,{children:(0,s.jsx)(h.Provider,Object.assign({value:n},{children:(0,s.jsx)(ie,{errorCode:t})}))})}var se=i(23205),ae=i(35223),oe=i(5338);const re="iZecXwsWx095KJNQcmm8";class de extends se.n{constructor(){super(...arguments),this.name="error-gui",this.errorCode=null}async init({container:e,apiHost:t},i){this.apiHost=t,this.container=e,this.localeModule=await i.getModuleBySymbol(ae.gS),this.reactContainer=document.createElement("div"),this.reactContainer.id="error-container",this.reactContainer.dataset.testid="error-gui",this.reactContainer.classList.add(re),this.reactRoot=(0,oe.createRoot)(this.reactContainer)}get currentErrorCode(){return this.errorCode}showError(e){this.errorCode=e;const t=this.localeModule.t.bind(this.localeModule);this.container.appendChild(this.reactContainer),this.reactRoot.render((0,l.createElement)(ne,{errorCode:e,t,apiHost:this.apiHost}))}hideError(){this.errorCode=null,this.container.removeChild(this.reactContainer),this.reactRoot.unmount()}}},79373:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Ke});var n=i(23205),s=i(35223),a=i(73494);var o=i(27483),r=i(80399);class d{constructor(){this.handlers=[{msgType:o.b,func:(e,t,i)=>{const n=i.tryGetData(r.O);n&&e.track("interaction_mode_changed",{interaction_mode_prev:t.fromMode,interaction_mode:t.mode,interaction_source:n.source})}}]}}var l=i(25591),c=i(5272);class h{constructor(){this.handlers=[{msgType:c.v,func:(e,t,i)=>{const{blockType:n}=t.block;if(n===l.n.TEXT)return;let s=t.block.text;n===l.n.LINK&&(s=t.block.value||""),n===l.n.USER&&(s=t.block.id||""),e.track("annotation_block_clicked",{block_type:n,block_value:s,annotation_type:t.annotationType,annotation_id:t.id})}}]}}var u,m=i(39425),p=i(49545),v=i(3032),g=i(8371);function y(e,t){if(t===g.EO.MANUAL)return 3;switch(e){case g.c$.ALIGNED:return 1;case g.c$.UNALIGNED:return 2}return 0}!function(e){e.USER="self-guided",e.TOUR="tour"}(u||(u={}));class f{constructor(){this.startLoadTime=Date.now(),this.endLoadTime=Date.now(),this.panosViewed=0,this.handlers=[{msgType:m.A,func:(e,t,i)=>{this.onMoveToSweepBegin(t.timestamp)}},{msgType:p.A,func:(e,t,i)=>{const n=i.tryGetData(r.O),s=i.tryGetData(v.R);this.endLoadTime=Date.now();const a=this.endLoadTime-this.startLoadTime;e.track("pano_viewed",{pano_id:t.toSweep,pano_view_count:++this.panosViewed,alignment_type:y(t.alignmentType,t.placementType),navigation_source:s&&s.tourPlaying?u.TOUR:u.USER,interaction_source:n?n.source:r.O.defaultSource,interaction_mode:n?n.mode:r.O.defaultMode,load_time:a/1e3})}}]}onMoveToSweepBegin(e){this.startLoadTime=e}}var w=i(48094),b=i(28997),k=i(99817),T=i(51238);class S{constructor(e){this.engine=e,this.handlers=[],this.send=(e,t,i)=>{const n=i.tryGetData(r.O),s={view_mode:t.toMode};n&&(s.interaction_source=n.source,s.interaction_mode=n.mode),e.track("mode_changed",s)},this.handlers.push({msgType:w.A,func:(e,t,i)=>{this.peekabooActive||this.send(e,t,i)}},{msgType:T.A,func:(e,t,i)=>{this.peekabooActive&&this.send(e,t,i)}})}get peekabooActive(){var e;return null===(e=this.engine.market.tryGetData(b.o))||void 0===e?void 0:e.tryGetProperty(k.gT,!1)}}var I=i(69426),E=i(13438),N=i(14754);class D extends N.QB{constructor(e,t,i){super(),this.sweep=e,this.from=t,this.to=i}}var C=i(34040);const M=(e,t)=>{const i=t.tryGetData(C.q);if(!e||!i)return-1;return i.getFloor(e).index};class O{constructor(){this.handlers=[{msgType:E.P,func:(e,t,i)=>{const n=i.tryGetData(r.O);e.track("floor_changed",{floor_id:t.floorName,interaction_source:n?n.source:r.O.defaultSource,interaction_mode:n?n.mode:r.O.defaultMode})}},{msgType:D,func:(e,t,i)=>{const n=i.tryGetData(r.O);e.track("sweep_floor_fixup",{sweep_index:t.sweep.index,sweep_alignment:t.sweep.alignmentType,sweep_placement:t.sweep.placementType,sweep_floor_from:M(t.from,i),sweep_floor_to:M(t.to,i),interaction_source:n?n.source:r.O.defaultSource,interaction_mode:n?n.mode:r.O.defaultMode})}}]}}var _=i(68118),A=i(49191);class P{constructor(){this.firstZoom=!0,this.fromZoom=1,this.toZoom=1,this.handlers=[{msgType:_.A,func:(e,t,i)=>{this.analytics||(this.analytics=e);const n=i.tryGetData(A.A);n&&n.currentSweep!==this.currentPano&&(this.firstZoom=!0,this.currentPano=n.currentSweep,this.fromZoom=1),this.toZoom=t.zoomLevel,clearTimeout(this.sendTimeout),this.sendTimeout=window.setTimeout(this.trackZoomEvent.bind(this),150)}}]}trackZoomEvent(){const e=this.firstZoom?"initial":"followup";this.analytics.track("zoom_"+e,{from:this.fromZoom,to:this.toZoom,pano:this.currentPano}),this.firstZoom=!1,this.fromZoom=this.toZoom}}var L=i(33020),x=i(35596),R=i(61589);class V extends R.B{constructor(){super(...arguments),this.name="timing",this.modelLoadingStartTime=0,this.waitingStartTime=0,this.appPlayingTime=0,this.appStartedTime=0}get totalTimeToAppStarting(){let e=this.appStartedTime-performance.timing.navigationStart;return this.modelLoadingStartTime&&this.waitingStartTime&&(e-=this.modelLoadingStartTime-this.waitingStartTime),e}get totalTimeToAppPlaying(){let e=this.appPlayingTime-performance.timing.navigationStart;return this.modelLoadingStartTime&&this.waitingStartTime&&(e-=this.modelLoadingStartTime-this.waitingStartTime),e}}var U=i(35652),B=i(8430),G=i(95149),F=i(41309),j=i(27147);const H=new U.Ay("showcase-session"),$=new V;class z{constructor(e,t){this.analytics=e,this.engine=t,this.handlers=[{msgType:L.uv,func:async(e,t,i)=>{var n,a;switch(t.phase){case x.Jj.WAITING:$.waitingStartTime=Date.now(),$.commit(),e.track("impression",{url_params:B.yJ(),visible:!0});break;case x.Jj.LOADING:$.modelLoadingStartTime=Date.now(),$.commit();break;case x.Jj.STARTING:{$.appStartedTime=Date.now(),$.commit(),H.info("First render, model loaded "+$.totalTimeToAppStarting/1e3);const t=this.engine.market.tryGetData(F.EY);this.renderer=await this.engine.getModuleBySymbol(s.M7);const i=this.renderer.getCapabilities(),n={has_hlr:!t||t.options.highlight_reel,duration:Date.now()-$.modelLoadingStartTime,duration_from_navigation_start:Date.now()-performance.timing.navigationStart,gl_v2:i.gl_v2,gl_max_textures:i.gl_max_textures,gl_max_texture_size:i.gl_max_texture_size,gl_max_cubemap_size:i.gl_max_cubemap_size,gl_instancing:i.gl_instancing,gl_oes_texture_float:i.gl_oes_texture_float,gl_oes_texture_half_float:i.gl_oes_texture_half_float,gl_depth_texture:i.gl_depth_texture,gl_draw_buffers:i.gl_draw_buffers,gl_oes_fbo_render_mip_map:i.gl_oes_fbo_render_mip_map,gl_shader_texture_lod:i.gl_shader_texture_lod,gl_oes_vertex_array_obj:i.gl_oes_vertex_array_obj,gl_ovr_multi_view:i.gl_ovr_multi_view,gl_color_buffer_float:i.gl_color_buffer_float,gl_astc_supported:i.gl_astc_supported,gl_etc1_supported:i.gl_etc1_supported,gl_etc2_supported:i.gl_etc2_supported,gl_dxt_supported:i.gl_dxt_supported,gl_bptc_supported:i.gl_bptc_supported,gl_pvrtc_supported:i.gl_pvrtc_supported};e.track("model_loaded",n);break}case x.Jj.PLAYING:$.appPlayingTime=Date.now(),$.commit(),H.info("Playing, session started "+$.totalTimeToAppPlaying/1e3),e.track("session_started"),window.addEventListener("unload",this.sessionEnded),e.track("load_times",{time_to_app_start:$.totalTimeToAppStarting,time_to_app_playing:$.totalTimeToAppPlaying});break;case x.Jj.ERROR:{const t=await i.waitForData(x.zH),{error:s}=t,o=s&&s.name?s.name:s&&s.constructor?s.constructor.name:null,r=s?s.message:null,d=s&&s.stack?s.stack.split("\n"):[],l=d.length>=2?d[1].match(/\s+at\s+([^\s]+)/):null,c=(0,j.E2)(s),h=!!(0,G.P3)("oops",""),u=null!==(a=null===(n=this.renderer)||void 0===n?void 0:n.estimatedGPUMemoryAllocated())&&void 0!==a?a:-1,m={error_dialog:"oops",error_type:o||"",exception:{message:`${o}: ${r}`,function:l?l[1]:null,stack:d.slice(1,5).join("\n")},duration:$.modelLoadingStartTime>0?Date.now()-$.modelLoadingStartTime:void 0,duration_from_navigation_start:Date.now()-performance.timing.navigationStart,gpu_memory:u<0?void 0:u,mock_error:h};c&&(m.error_code=c),e.track("error_displayed",m);break}}}}],this.sessionEnded=()=>{this.analytics.trackAsync("session_ended",{duration:Date.now()-$.appPlayingTime})}}dispose(){window.removeEventListener("unload",this.sessionEnded)}}var W=i(3954),K=i(95226),X=i(84619),q=i(82110),Y=i(48064),Q=i(28743);const Z=new U.Ay("/index.js");class J{constructor(e){this.engine=e,this.trackTime=0,this.trackTimeThreshold=1/0,this.currentPhase=null,this.currentAppPhase=null,this.pixelRatio=window.devicePixelRatio||1,this.recordedPhases={},this.deltas=new X.C(1e3),this.memoryReadings=new X.C(1e3),this.handlers=[{msgType:W.A,func:(e,t,i)=>{this.currentAppPhase!==x.Jj.STARTING&&this.currentAppPhase!==x.Jj.PLAYING||this.startRecording(e,q.N3[t.toMode],1e4)}},{msgType:L.uv,func:async(e,t,i)=>{const n=i.tryGetData(Y.X);t.phase===x.Jj.LOADING?this.startRecording(e,"Loading",6e4):t.phase===x.Jj.STARTING?(this.renderer=await this.engine.getModuleBySymbol(s.M7),this.startRecording(e,"Starting",6e4)):t.phase===x.Jj.PLAYING&&n&&n.currentMode&&this.startRecording(e,q.N3[n.currentMode],1e4),this.currentAppPhase=t.phase}},{msgType:Q.lo,func:(e,t,i)=>{this.pixelRatio=t.pixelRatio}}],this.resetRecording=()=>{this.currentPhase=null,this.deltas.clear(),this.memoryReadings.clear(),this.trackTime=0}}onUpdate(e,t){var i,n;if(!this.currentPhase)return;this.deltas.push(t);const s=null!==(n=null===(i=this.renderer)||void 0===i?void 0:i.estimatedGPUMemoryAllocated())&&void 0!==n?n:-1;s>-1&&this.memoryReadings.push(s),this.trackTime+=t,this.trackTime>=this.trackTimeThreshold&&(this.sendRecord(e),this.resetRecording())}startRecording(e,t,i){t!==this.currentPhase&&(this.currentPhase&&(this.sendRecord(e),this.resetRecording()),this.recordedPhases[t]||(this.currentPhase=t,this.trackTimeThreshold=i,this.recordedPhases[this.currentPhase]=!0))}sendRecord(e){if(0===this.deltas.count)return;const t=this.deltas.getList(),i=this.memoryReadings.getList();try{const n=this.calcPerformance(t,i);e.track("performance",n)}catch(e){Z.warn("Could not send performance metrics",e)}}calcPerformance(e,t){let i=0,n=0,s=0,a=0,o=0,r=0;for(const t of e)i+=t,t<0||(t<=16.7?n+=t:t<=33.3?s+=t:t<=100?a+=t:t<=1e3?o+=t:r+=t);if(i<=0)throw Error("No positive timings, cannot calculate performance data");const d=i/e.length;n/=i,s/=i,a/=i,o/=i,r/=i;let l=e.slice();const c=(0,K.Ym)(l,50),h=(0,K.Ym)(l,95,!1),u=l[l.length-1];let m,p,v,g,y;return t.length&&(l=t.slice(),g=(0,K.Ym)(l,50,!0),y=(0,K.Ym)(l,95,!1),v=Math.round((0,K.G8)(t)),m=l[0],p=l[l.length-1]),{phase:this.currentPhase,frame_delta:d,frame_delta_avg:d,frame_delta_median:c,frame_delta_95th:h,frame_delta_max:u,duration:i,time_60_fps:n,time_60_30_fps:s,time_30_10_fps:a,time_10_1_fps:o,time_1_0_fps:r,gpu_memory_min:m,gpu_memory_max:p,gpu_memory_avg:v,gpu_memory_median:g,gpu_memory_95th:y,pixel_ratio:this.pixelRatio}}}var ee=i(58398),te=i(92590);const ie=(e,t)=>{const i=t.tryGetData(te.X);if(!i)return-1;return(e?i.floors.getFloor(e):i.getHighestVisibleFloor()).index};class ne{constructor(){this.handlers=[{msgType:ee.hR,func:(e,t,i)=>{const n={measure_sid:t.data.sid,start_position:t.data.startPosition,end_position:t.data.endPosition,length:t.data.totalLength,segments:t.data.segments,temporary:t.data.temporary,viewmode:t.data.viewmode,floor:ie(t.data.floorId,i),feature_type:t.data.featureType,constraint_style:t.data.constraint,continuous:t.data.continuous};e.track("measure_segment_add",n)}},{msgType:ee.QZ,func:(e,t,i)=>{const n={measure_sid:t.data.sid,length:t.data.totalLength,segments:t.data.segments,temporary:t.data.temporary,viewmode:t.data.viewmode,floor:ie(t.data.floorId,i),feature_type:t.data.featureType,measure_type:t.data.type,constraint_style:t.data.constraint,continuous:t.data.continuous};e.track("measure_add",n)}},{msgType:ee.kC,func:(e,t)=>{const i={measure_sid:t.sid,measure_text:t.text};e.track("measure_add_title",i)}},{msgType:ee.wx,func:(e,t)=>{const i={measure_sid:t.sid,measure_old_text:t.oldText,measure_new_text:t.newText};e.track("measure_update_title",i)}},{msgType:ee.To,func:(e,t,i)=>{const n={measure_sid:t.data.sid,length:t.data.totalLength,segments:t.data.segments,temporary:t.data.temporary,viewmode:t.data.viewmode,floor:ie(t.data.floorId,i),measure_count:t.data.count,continuous:t.data.continuous};e.track("measure_remove",n)}},{msgType:ee.bV,func:(e,t,i)=>{const n={measure_sid:t.data.sid,length:t.data.totalLength,segments:t.data.segments,temporary:t.data.temporary,viewmode:t.data.viewmode,floor:ie(t.data.floorId,i),feature_type:t.data.featureType,constraint_style:t.data.constraint,continuous:t.data.continuous};e.track("measure_update",n)}},{msgType:ee.z,func:(e,t)=>{const i=t.opened?"measure_mode_enter":"measure_mode_exit",n={viewmode:t.viewmode,measure_count:t.count};e.track(i,n)}},{msgType:ee.sN,func:(e,t)=>{e.track("measure_cancelled",{})}}]}}var se=i(92238);class ae{constructor(){this.handlers=[{msgType:se.h,func:(e,t)=>{const i={duration_dollhouse:t.durationDollhouse,duration_floorplan:t.durationFloorplan,duration_inside:t.durationInside,duration_overlay:t.durationOverlay,duration:t.durationDollhouse+t.durationFloorplan+t.durationInside,main_mode:t.mainMode,bytes_downloaded:t.totalBytesDownloaded,tiles_downloaded:t.tilesDownloaded};e.track("activity_ping",i)}}]}}var oe,re=i(42311),de=i(32981),le=i(33518),ce=i(75650),he=i(85239),ue=i(81866),me=i(53009),pe=i(35062);!function(e){e.UNINITIALIZED="uninitialized",e.INACTIVE="inactive",e.ACTIVE="active"}(oe||(oe={}));class ve{constructor(){this.name="activity-analytics",this._state=oe.UNINITIALIZED,this.activeModeMap=new Map,this.totalTilesDownloaded=0,this.onTileDownloaded=()=>{this.totalTilesDownloaded++}}async init(e,t,i){this.engine=e,this.requestQueue=i,[this.input,this.viewmodeData,this.applicationData,this.modelData]=await Promise.all([await e.getModuleBySymbol(s.mL),await e.market.waitForData(Y.X),await e.market.waitForData(x.zH),await e.market.waitForData(pe.q)]);const n=[],a=[re.rX,de.jF,le.k,ce.CD,he.l],o=()=>this.active=!0;this.applicationData.phase===x.Jj.PLAYING?this._state=oe.INACTIVE:n.push(e.subscribe(L.uv,(()=>{this.applicationData.phase===x.Jj.PLAYING&&(this._state=oe.INACTIVE)})));let r=this.modelData.getModel();n.push(this.modelData.onPropertyChanged("activeModelId",(()=>{const e=this.modelData.getModel(),t=r.overlayActive,i=e.overlayActive;r=e,i?this.activeModeMap.has("overlay")?this.updateActivityTimeForMode("overlay",!0):this.activeModeMap.set("overlay",{previousTime:Date.now(),totalTimeinMS:0}):t&&this.updateActivityTimeForMode("overlay")}))),n.push(...(()=>{const e=[];return a.forEach((t=>{e.push(this.input.registerUnfilteredHandler(t,o))})),e})()),n.push(e.subscribe(w.A,(e=>{const t=e.fromMode,i=e.toMode;t&&t!==q.N3.Transition&&this.applicationData.phase===x.Jj.PLAYING&&this.handleViewmodeChange(t,i)}))),n.push(this.engine.subscribe(me.f,this.onTileDownloaded)),t(n)}get active(){return this._state===oe.ACTIVE}set active(e){this._state!==oe.UNINITIALIZED&&(e&&this._state===oe.INACTIVE&&this.startActivityTimeout(),this._state=e?oe.ACTIVE:oe.INACTIVE)}handleViewmodeChange(e,t){this.activeModeMap.has(t)?this.updateActivityTimeForMode(t,!0):this.activeModeMap.set(t,{previousTime:Date.now(),totalTimeinMS:0}),this.updateActivityTimeForMode(e)}updateActivityTimeForMode(e,t){const i=this.activeModeMap.get(e);if(void 0===i)return;const{previousTime:n,totalTimeinMS:s}=i;t?this.activeModeMap.set(e,{previousTime:Date.now(),totalTimeinMS:s}):this.activeModeMap.set(e,{previousTime:Date.now(),totalTimeinMS:s+(Date.now()-n)})}startActivityTimeout(){this.activeModeMap.set(q.N3.Dollhouse,{previousTime:Date.now(),totalTimeinMS:0}),this.activeModeMap.set(q.N3.Floorplan,{previousTime:Date.now(),totalTimeinMS:0}),this.activeModeMap.set(q.N3.Panorama,{previousTime:Date.now(),totalTimeinMS:0}),this.activeModeMap.set("overlay",{previousTime:Date.now(),totalTimeinMS:0}),window.setTimeout(this.notifyActivityAnalytic.bind(this),ve.ACTIVITY_INTERVAL)}notifyActivityAnalytic(){if(this.modelData.getModel().overlayActive&&this.updateActivityTimeForMode("overlay"),this.viewmodeData.currentMode&&this.viewmodeData.currentMode!==q.N3.Transition&&this.updateActivityTimeForMode(this.viewmodeData.currentMode),this.active){let e=0,t=q.N3.Panorama;this.activeModeMap.forEach(((i,n)=>{i.totalTimeinMS>e&&"overlay"!==n&&(t=n,e=i.totalTimeinMS)})),this.active=!1;const[i,n,s,a]=[this.activeModeMap.get(q.N3.Dollhouse),this.activeModeMap.get(q.N3.Floorplan),this.activeModeMap.get(q.N3.Panorama),this.activeModeMap.get("overlay")].map((e=>e?e.totalTimeinMS:0));this.engine.broadcast(new se.h(i,n,s,a,ue.De[t],this.requestQueue.totalBytesDownloaded,this.totalTilesDownloaded))}}}ve.ACTIVITY_INTERVAL=15e3;var ge,ye=i(31012);!function(e){e.USER="self-guided",e.TOUR="tour"}(ge||(ge={}));class fe{constructor(){this.handlers=[{msgType:ye.h,func:(e,t,i)=>{const n=i.tryGetData(r.O),s=i.tryGetData(v.R),a={room_id:t.roomId,room_index:t.meshSubgroup,room_type:t.roomType,viewmode:t.viewmode?ue.De[t.viewmode]:t.viewmode,room_visit_count:t.visitCount,room_count:t.roomCount,navigation_source:s&&s.tourPlaying?ge.TOUR:ge.USER,interaction_source:n?n.source:r.O.defaultSource,interaction_mode:n?n.mode:r.O.defaultMode};e.track("room_visited",a)}}]}}class we{constructor(){this.handlers=[]}}var be=i(22169);const ke=e=>e.sort(((e,t)=>e.localeCompare(t)));class Te{constructor(){this.handlers=[{msgType:be.N,func:(e,t)=>{const{happiness:i,quality:n,navigation:s,feedback:a}=t.rating,o={};i&&(o.happiness=+i),(s&&s.length>0||n&&n.length>0)&&(o.issue_types=function(e=[],t=[]){const i=[];return ke(t).forEach((e=>i.push(`navigation-${e.trim()}`))),ke(e).forEach((e=>i.push(`quality-${e.trim()}`))),i.join(",")}(n||[],s||[])),a&&a.length>0&&(o.feedback=a),Object.keys(o).length>0&&e.track("model_rated",o)}}]}}var Se=i(52775),Ie=i(49747);const Ee=[1e3,3e3,5e3,15e3];class Ne{constructor(){this.currSpinnerSessionId=null,this.currSpinnerSessionStartTime=null,this.currIntervalIdx=0,this.pingTimeout=null,this.handlers=[{msgType:Se.XR,func:(e,t)=>{t.isOpen?this.startPinging(e):this.stopPinging(e)}}]}startPinging(e){null==this.currSpinnerSessionId&&(this.currSpinnerSessionId=(0,Ie.e)(),this.currSpinnerSessionStartTime=Date.now(),this.currIntervalIdx=0,this.pingTimeout=window.setTimeout((()=>this.pingAnalytics(e)),Ee[this.currIntervalIdx]))}stopPinging(e){if(this.currSpinnerSessionId&&this.currSpinnerSessionStartTime){const t=Date.now()-this.currSpinnerSessionStartTime;e.track("pano_tile_loading",{session_id:this.currSpinnerSessionId,duration:t,final_duration:t}),this.pingTimeout&&(window.clearTimeout(this.pingTimeout),this.pingTimeout=null),this.currSpinnerSessionId=null}}pingAnalytics(e){this.currSpinnerSessionId&&this.currSpinnerSessionStartTime&&(e.track("pano_tile_loading",{session_id:this.currSpinnerSessionId,duration:Date.now()-this.currSpinnerSessionStartTime,final_duration:null}),this.currIntervalIdx=Math.min(this.currIntervalIdx+1,Ee.length-1),this.pingTimeout=window.setTimeout((()=>this.pingAnalytics(e)),Ee[this.currIntervalIdx]))}}var De=i(32994),Ce=i.n(De);const Me=1/30*1e3;var Oe;!function(e){e.DAM_MESH="dam_mesh",e.TILED_MESH="tiled_mesh",e.PANO_TILE="pano_tile",e.DAM_TEXTURE="dam_texture",e.TILED_TEXTURE="tiled_texture",e.STATIC="static",e.GRAPH="graph"}(Oe||(Oe={}));class _e{constructor(){this.lastFlushTimestamp=null,this.lastSendTimestamp=null,this.isRecording=!1,this.isSending=!1,this.stats={[Oe.DAM_MESH]:{sum:0,count:0},[Oe.TILED_MESH]:{sum:0,count:0},[Oe.PANO_TILE]:{sum:0,count:0},[Oe.DAM_TEXTURE]:{sum:0,count:0},[Oe.TILED_TEXTURE]:{sum:0,count:0},[Oe.STATIC]:{sum:0,count:0},[Oe.GRAPH]:{sum:0,count:0}},this.totalStatsCount=0,this.handlers=[{msgType:L.uv,func:(e,t)=>{t.phase===x.Jj.STARTING?this.isRecording=!0:t.phase===x.Jj.PLAYING&&(this.isSending=!0)}}]}get dataBuffer(){return null==this._dataBuffer?(this._dataBuffer=new(Ce())(300),this._dataBuffer):this._dataBuffer}onUpdate(e,t){this.isRecording&&(this.flushTimingDataThrottled(),this.updateStats(t),this.isSending&&this.sendAnalyticsThrottled(e))}flushTimingDataThrottled(){if(null==this.lastFlushTimestamp||performance.now()-this.lastFlushTimestamp>5e3){const e=performance.getEntriesByType("resource");for(const t of e)t.transferSize>0&&this.dataBuffer.enq(t);performance.clearResourceTimings(),this.lastFlushTimestamp=performance.now()}}sendAnalyticsThrottled(e){if((null==this.lastSendTimestamp||performance.now()-this.lastSendTimestamp>5e3)&&this.totalStatsCount>10){const t={};for(const e in this.stats){const i=e,n=this.stats[i];n.count>0&&(t[i]=0|Math.round(n.sum/n.count),n.sum=0,n.count=0)}e.track("resource_timing",t),this.totalStatsCount=0,this.lastSendTimestamp=performance.now()}}updateStats(e){if(e<Me){let e=0;for(;e<30&&!this.dataBuffer.isEmpty();){const t=this.dataBuffer.deq(),i=Ae(t);i&&(this.stats[i].sum+=t.duration,this.stats[i].count+=1,this.totalStatsCount+=1),e+=1}}}}const Ae=e=>{const t=new URL(e.name),i=t.hostname,n=t.pathname.split("/"),s=n[n.length-1];return i.includes("static")?Oe.STATIC:"graph"===s?Oe.GRAPH:n.includes("mesh_tiles")&&s.includes(".glb")?Oe.TILED_MESH:n.includes("mesh_tiles")&&(s.includes(".ktx2")||s.includes(".jpg"))?Oe.TILED_TEXTURE:s.includes(".dam")?Oe.DAM_MESH:n.includes("tiles")?Oe.PANO_TILE:n[n.length-2].includes("_texture_")?Oe.DAM_TEXTURE:null};var Pe=i(76879);const Le=new U.Ay("log-analytics");class xe{init(e,t){return Le.debug("logging analytics to console",{options:e,context:t}),Promise.resolve()}identify(e){Le.debug("identify as",e)}track(e,t,i){Le.debug({eventName:e,data:t,intercom:i})}trackAsync(e,t,i){Le.debug({eventName:e,data:t,intercom:i})}setOptions(e){Le.debug("set options",e)}}const Re=new U.Ay("segment");class Ve{constructor(e){this.token=e,this.options={}}init(e,t){return this.setOptions(e),this.context=t,this.token?(window.analytics&&window.analytics.initialize&&(window.analytics=null),window.analytics||function(){var e=window.analytics=window.analytics||[];if(!e.initialize)if(e.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{e.invoked=!0,e.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"],e.factory=function(t){return function(){var i=Array.prototype.slice.call(arguments);return i.unshift(t),e.push(i),e}};for(var t=0;t<e.methods.length;t++){var i=e.methods[t];e[i]=e.factory(i)}e.load=function(t,i){var n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(n,s),e._loadOptions=i},e.SNIPPET_VERSION="4.15.2"}}(),window.analytics.load(this.token),new Promise(((e,t)=>{window.analytics.ready(e)}))):Promise.resolve()}identify(e){window.analytics.identify(e.id,{first_name:e.firstName,last_name:e.lastName,email:e.email,org_id:e.orgId})}track(e,t,i){U.Ay.level>=3&&Re.debug(e,t?JSON.stringify(t).replace('\\"','"'):t),t=Object.assign(t||{},this.options);const n=this.context.integrations?Object.assign({},this.context.integrations):{};n.Intercom=!!i;try{window.analytics.track(e,t,Object.assign(Object.assign({},this.context),{integrations:n}))}catch(t){Re.error(`Failed to send data to segment for ${e}`)}}trackAsync(e,t,i){if(t=t||{},navigator.sendBeacon)try{navigator.sendBeacon("https://api.segment.io/v1/t",JSON.stringify({event:e,anonymousId:window.analytics.user().anonymousId(),properties:Object.assign({data:t},this.options),integrations:{Intercom:!!i},writeKey:this.token,sentAt:Date.now(),type:"track",context:this.context}))}catch(e){Re.error("Failed to send async segment request")}}setOptions(e){Object.assign(this.options,e)}}var Ue=i(88488),Be=i(42046);const Ge=new U.Ay("util-browser");var Fe=i(55079);const je=new U.Ay("mp-analytics"),He="ajs_anonymous_id",$e="sc_anonymous_id";class ze{constructor(e,t,i){this.token=e,this.url=t,this.queue=i,this.options={},this.segmentStylePayload=(e,t,i)=>({timestamp:(0,Ue.$)(new Date),integrations:{Intercom:!!i},context:this.segmentStyleContext(this.context),properties:t,event:e,messageId:(0,Ie.e)(),anonymousId:this.anonymousId,type:"track",userId:this.user?this.user.id:null,sentAt:(0,Ue.$)(new Date)}),this.segmentStyleContext=e=>{const t={page:{path:window.location.pathname,referrer:(0,Fe.G2)(),search:window.location.search,title:window.document.title,url:window.location.href},userAgent:navigator.userAgent,library:{name:"showcase",version:"1"},campaign:{}};return Object.assign(Object.assign({},e),t)};const n=function(e,t){if(!("localStorage"in window))return t;let i;try{i=window.localStorage.getItem(e)}catch(e){return Ge.debug(e),t}return null===i?t:"boolean"==typeof t?"true"===i:"number"==typeof t?parseFloat(i):i}($e);if(n)this.anonymousId=n;else{const e=(0,Be.G)(He);this.anonymousId=e&&"string"==typeof e?e.replace(/%22/g,""):(0,Ie.e)(),function(e,t){try{window.localStorage.setItem(e,t)}catch(e){Ge.error(e)}}($e,this.anonymousId)}this.headers={"X-API-Key":this.token,"Content-Type":"application/json",Accept:"application/json"}}init(e,t){return this.setOptions(e),this.context=t,je.debug("init",{options:this.options,context:this.segmentStyleContext(this.context)}),Promise.resolve()}identify(e){je.debug("identify as",e),this.user=e}track(e,t,i){U.Ay.level>=3&&je.debug(e,t?JSON.stringify(t).replace('\\"','"'):t),t=Object.assign(t||{},this.options);const n=this.segmentStylePayload(e,t,i);this.queue.post(`${this.url}?ev=${e}`,{body:n,headers:this.headers})}trackAsync(e,t,i){if(t=Object.assign(t||{},this.options),navigator.sendBeacon)try{const n=this.segmentStylePayload(e,t,i);navigator.sendBeacon(`${this.url}?api_key=${this.token}`,JSON.stringify(n))}catch(e){je.error("Failed to sendBeacon analytics request")}}setOptions(e){Object.assign(this.options,e)}}const We={logging:async()=>new xe,segment:async(e,t)=>{const i=await t.getAppKey(e,"segment_key");return new Ve(null!=i?i:void 0)},mp:async(e,t,i)=>{const n=await t.getAppKey(e,"analytics_mp_key"),s=await t.getAppKey(e,"analytics_mp_url");return n&&s?new ze(n,s,i):null}};class Ke extends n.n{constructor(){super(...arguments),this.name="showcase-analytics",this.loaded=!1,this.handlers=[],this.track=(e,t)=>{this.analytics.track(e,t)}}async init(e,t){this.analyticsQueue=e.analyticsQueue,this.analytics=await t.getModuleBySymbol(s.aF),this.apiClient=(await t.getModuleBySymbol(s.qL)).getApi(),this.addMessageHandlers(this.analytics,t),this.context=(0,a.BX)(e.apiQueue,"",e.appName),this.options=Object.assign({mds_enabled:!0},(0,a.$E)(e.overrideParams)),t.getModuleBySymbol(s.gS).then((e=>{this.context.locale=e.languageCode})),this.activityTracking=new ve,this.activityTracking.init(t,this.registerBindings.bind(this),e.apiQueue);const i=await this.createEndpoints(e);this.analytics.load(i,this.options,this.context).then((()=>{this.loaded=!0,this.apiClient.user.then((e=>{this.analytics.setUser(e)}))}))}addMessageHandlers(e,t){this.addMessageHandler(new z(e,t),t),this.addMessageHandler(new S(t),t),this.addMessageHandler(new f,t),this.addMessageHandler(new d,t),this.addMessageHandler(new O,t),this.addMessageHandler(new I.A,t),this.addMessageHandler(new P,t),this.addMessageHandler(new ne,t),this.addMessageHandler(new J(t),t),this.addMessageHandler(new ae,t),this.addMessageHandler(new fe,t),this.addMessageHandler(new we,t),this.addMessageHandler(new Te,t),this.addMessageHandler(new h,t),this.addMessageHandler(new Ne,t),this.addMessageHandler(new _e,t),this.addMessageHandler(new Pe.Z,t)}addMessageHandler(e,t){this.handlers.push(e),e.handlers.forEach(((e,i)=>{this.bindings.push(t.subscribe(e.msgType,(i=>{e.func(this.analytics,i,t.market)})))}))}registerBindings(e){this.bindings.push(...e)}async createEndpoint(e,t){var i;return null===(i=We[e])||void 0===i?void 0:i.call(We,t,this.apiClient,this.analyticsQueue)}async createEndpoints(e){const t=(0,a.oA)(e.appName),i=void 0!==e.provider?e.provider:await this.apiClient.getAppKey(t,"analytics_provider"),n=[];if(!i)return n;const s=i.split(",");for(const e of s){const i=await this.createEndpoint(e,t);null!==i?n.push(i):this.log.warn(`Failed to set up ${e}, token/url required but not found in config`)}return n.length<1&&n.push(await this.createEndpoint("logging",t)),n}onUpdate(e){if(this.loaded)for(const t of this.handlers)t.onUpdate&&t.onUpdate(this.analytics,e)}dispose(e){super.dispose(e);for(const e of this.handlers)e.dispose&&e.dispose();this.handlers=[]}getSessionId(){return this.options.session_id||""}trackGuiEvent(e,t={}){const{tool:i,interactionSource:n,panoId:s,data:a}=t,o={gui_action:e};i&&Object.assign(o,{tool:i}),n&&Object.assign(o,{interaction_source:n}),s&&Object.assign(o,{pano_id:s}),a&&Object.assign(o,{data:a}),this.track("showcase_gui",o)}trackToolGuiEvent(e,t,i={}){this.trackGuiEvent(t,Object.assign({tool:e},i))}}},34663:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>E});var n=i(35223),s=i(96540),a=i(5338),o=i(23205),r=i(93679),d=i(66163),l=i(44773),c=i(17139),h=i(74848),u=i(32485),m=i.n(u),p=i(99366),v=i(63083);class g extends s.Component{render(){const{attributionLinkText:e,attributionLinkUrl:t}=this.props,{locale:i}=this.context;return(0,h.jsxs)("div",Object.assign({className:"powered-by"},{children:[(0,h.jsx)("p",Object.assign({className:"powered-by-label"},{children:i.t(p.A.POWERED_BY)})),(0,h.jsx)("img",{className:"powered-by-logo",alt:"Matterport",src:v,width:"150",height:"32"}),t&&(0,h.jsx)("a",Object.assign({href:t,className:"powered-by-link"},{children:e||t}))]}))}}g.contextType=c.B;var y=i(35652);const f=i.p+"images/showcase-password-background.jpg";var w=i(84229);class b extends w.t{constructor(e="Invalid password"){super(e),this.name="InvalidPassword"}}class k extends w.t{constructor(e="Too many attempts, please try again in a few minutes"){super(e),this.name="TooManyAttempts"}}const T=new y.Ay("showcase-password");class S extends s.Component{constructor(e){super(e),this.isUnmounting=!1,this.onInputChange=e=>{const{name:t,value:i}=e.target;"password"===t&&this.setState({password:i,hasError:!1})},this.onSubmit=async e=>{e.preventDefault(),this.setState({formEnabled:!1}),await this.authenticate(),this.isUnmounting||this.setState({formEnabled:!0})},this.state={formEnabled:!0,hasError:!1,tooManyAttempts:!1,password:""}}componentWillUnmount(){this.isUnmounting=!0}async authenticate(){const{authenticate:e}=this.props,{password:t}=this.state;T.debug("Validating password input...");const i=await e(t).catch((e=>(e instanceof k&&this.setState({hasError:!0,tooManyAttempts:!0}),!1)));this.isUnmounting||this.setState({hasError:!i})}stopPropagation(e){e.stopPropagation()}renderLockout(){const{locale:e}=this.context;return(0,h.jsxs)("div",Object.assign({className:"sc-password-modal sc-password-lockout"},{children:[(0,h.jsx)("header",Object.assign({className:"modal-header"},{children:(0,h.jsx)("h1",Object.assign({className:"modal-title"},{children:e.t(p.A.SC_LOCKOUT_TITLE)}))})),(0,h.jsx)("p",Object.assign({className:"modal-body"},{children:e.t(p.A.SC_LOCKOUT_MESSAGE)}))]}))}renderLoginForm(){const{hasError:e,password:t,formEnabled:i}=this.state,{locale:n}=this.context;return(0,h.jsxs)("div",Object.assign({className:"sc-password-modal sc-password-login"},{children:[(0,h.jsx)("header",Object.assign({className:"modal-header"},{children:(0,h.jsx)("h1",Object.assign({className:"modal-title"},{children:n.t(p.A.SC_PASSWORD_TITLE)}))})),(0,h.jsxs)("div",Object.assign({className:"modal-body"},{children:[(0,h.jsxs)("form",Object.assign({onSubmit:this.onSubmit,className:"sc-password-form"},{children:[(0,h.jsx)("input",{type:"password",name:"password",placeholder:n.t(p.A.SC_PASSWORD_PLACEHOLDER),onInput:this.onInputChange,onKeyDown:this.stopPropagation,onKeyPress:this.stopPropagation,onKeyUp:this.stopPropagation,disabled:!i,value:t,className:m()("sc-password-input",{error:e}),autoComplete:"on"}),(0,h.jsx)("button",Object.assign({type:"submit",disabled:!i,className:"sc-password-submit"},{children:n.t(p.A.SC_PASSWORD_SUBMIT)}))]})),e&&(0,h.jsxs)("p",Object.assign({className:"help-text error"},{children:[(0,h.jsx)("span",{className:"icon icon-error"}),n.t(p.A.SC_PASSWORD_INVALID)]})),!e&&(0,h.jsx)("p",{className:"help-text"})]}))]}))}render(){const{hasError:e,tooManyAttempts:t}=this.state,i=e&&t?this.renderLockout():this.renderLoginForm();return(0,h.jsxs)("div",Object.assign({className:"sc-password-ui",style:{backgroundImage:`url(${f})`}},{children:[(0,h.jsx)("div",Object.assign({className:"sc-password-content"},{children:i})),(0,h.jsx)("footer",Object.assign({className:"sc-password-footer"},{children:(0,h.jsx)(g,{})}))]}))}}S.contextType=c.B;var I=i(37117);class E extends o.n{constructor(){super(...arguments),this.name="showcase-password",this.authenticated=!1}async init(e,t){this.config=e,this.engine=t;const i=e.baseUrl||window.location.origin;this.auth=new r.l(i)}showPasswordScreen(){this.loadUi()}hidePasswordScreen(){this.unloadUi()}async loadUi(){const{container:e}=this.config,t=await this.engine.getModuleBySymbol(n.gS),i=Object.assign(Object.assign({},l.T),{locale:t});this.reactContainer=document.createElement("div"),this.reactContainer.id="showcase-password-container",e.appendChild(this.reactContainer),this.reactRoot=(0,a.createRoot)(this.reactContainer),this.reactRoot.render((0,s.createElement)(c.B.Provider,{value:i},[(0,s.createElement)(S,{key:"showcase-password",authenticate:e=>this.authenticate(e)})]))}async unloadUi(){var e;return!!this.reactRoot&&(this.reactRoot.unmount(),null===(e=this.reactContainer)||void 0===e||e.remove(),delete this.reactContainer,!0)}async authenticate(e){const{modelId:t}=this.config;if(!await this.auth.authenticate(t,e)){switch(this.engine.broadcast(new I.G(this.auth.errorType)),this.auth.errorType){case d.L.INVALID_CREDENTIALS:throw new b;case d.L.TOO_MANY_ATTEMPTS:throw new k}return!1}return this.log.debug("Password authentication was successful"),this.engine.broadcast(new I.l),!0}}},39713:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>d});var n=i(32903),s=i(23205),a=i(35223),o=i(28743),r=i(71958);class d extends s.n{constructor(){super(...arguments),this.name="showcase-webgl-context-loss",this.contextLostEvent=null,this.framesWithLostContext=0}async init(e,t){this.config=e,this.engine=t,this.bindings.push(t.subscribe(o.ul,(e=>{this.contextLostEvent=e.event})),t.subscribe(o.aF,(()=>{this.contextLostEvent=null,this.framesWithLostContext=0,t.getModuleBySymbol(r.bW).then((e=>{e.currentErrorCode===n.b.WEBGL_CONTEXT_LOST&&e.hideError()}))})))}onUpdate(e){const{contextLostEvent:t}=this;if(t){++this.framesWithLostContext===this.config.notificationDelayFrames&&(this.engine.getModuleBySymbol(r.bW).then((e=>{e.currentErrorCode||e.showError(n.b.WEBGL_CONTEXT_LOST)})),this.engine.getModuleBySymbol(a.aF).then((e=>{!function(e,t){e.track("error_displayed",{error_dialog:"oops",error_type:"WebGLContextLost",exception:{message:`WebGL context lost: ${t.statusMessage||"no status given"}`},mock_error:!1})}(e,t)})))}}}},92114:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>d});var n=i(61077),s=i(6126),a=i(23205),o=i(33020),r=i(35596);class d extends a.n{constructor(){super(...arguments),this.name="app-phase"}async init(e,t){var i;this.broadcast=t.broadcast.bind(t),this.tasks=e.tasks,this.appState=new r.zH(r.Jj.UNINITIALIZED),this.appState.phase=r.Jj.UNINITIALIZED,this.appState.phaseTimes[r.Jj.UNINITIALIZED]=Date.now(),this.appState.application=null!==(i=e.initialApp)&&void 0!==i?i:r.lg.SHOWCASE,this.appState.onChanged((()=>{this.appState.error&&this.updateCurrentPhase(r.Jj.ERROR)})),t.market.register(this,r.zH,this.appState),this.watchTasks(this.appState.phase),this.watchErrors(),this.updateAppHeaders(),this.bindings.push(this.appState.onPropertyChanged("application",(()=>this.updateAppHeaders())))}async watchTasks(e){if(e>=r.Jj.PLAYING)return;const t=e+1;try{await Promise.all(this.tasks[t])}catch(e){this.error(e)}t===r.Jj.PLAYING&&this.broadcast(new o.Fj(this.appState.application)),this.appState.phase!==r.Jj.ERROR&&e!==r.Jj.ERROR&&(this.updateCurrentPhase(t),this.watchTasks(t))}async watchErrors(){try{await Promise.all(this.tasks[r.Jj.ERROR])}catch(e){this.error(e)}}updateCurrentPhase(e){this.log.devInfo(`Entering "${r.Jj[e]}" for "${this.appState.application}"`),this.appState.phase=e,this.appState.phaseTimes[e]=Date.now(),this.log.debug(this.appState.toString()),this.appState.commit(),this.broadcast(new o.uv(e,this.appState.application))}error(e){this.appState.error=e,this.appState.commit()}updateActiveApp(e){this.appState.application=e,this.appState.commit(),this.broadcast(new o.E5(e))}getData(){return this.appState}updateAppHeaders(){this.log.debug(`updating application headers ${this.appState.application}`),(0,n.x)(this.appState.getName()),(0,s._)(this.appState.getVersion())}}},49758:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CommunicationMethod:()=>a,Sdk:()=>Ke,default:()=>We});var n,s,a,o,r,d,l=i(14495),c=i(46534),h=i(34622),u=i(33898),m=i(4232),p=i(35223),v=i(23205),g=i(54998),y=i(41733),f=i(96452),w=i(96970);!function(e){e.EMBED="sdk.embed",e.BUNDLE="sdk.bundle",e.PLUGIN="sdk.plugin",e.NPM_SDK="npm.embed",e.NPM_WEB_COMPONENT="npm.webcomponent",e.NPM_R3F="npm.r3f"}(n||(n={})),function(e){e.CONNECTION="sdk.connection",e.DISCONNECT="sdk.disconnect",e.MESSAGED="sdk.messaged",e.SUBSCRIBED="sdk.subscribed",e.UNSUBSCRIBED="sdk.unsubscribed",e.OBSERVABLE_SUB="sdk.obs.subscribe",e.OBSERVABLE_UNSUB="sdk.obs.unsubscribe",e.COLLECTION_SUB="sdk.coll.subscribe",e.COLLECTION_UNSUB="sdk.coll.unsubscribe"}(s||(s={}));class b{constructor(e){this.analytics=e,this.trackedEvents=new c.k}track(e,t,i){this.trackedEvents.has(e,t)||(this.trackedEvents.add(e,t),this.analytics.track(e,Object.assign({},i)))}alwaysTrack(e,t,i){this.trackedEvents.add(e,t),this.analytics.track(e,Object.assign({},i))}setOptions(e){this.analytics.setOptions(e)}}class k{constructor(e){this.analytics=e,this.messageType="client call"}onMessage(e,t){const{namespace:i,name:n}=e,s={applicationKey:t.applicationKey,namespace:i,name:n,method:t.communicationMethod,provider:t.context.provider,sdkType:t.context.sdkType};this.analytics.track("sdk_call",i+n,s)}}class T{constructor(){this.usedIds=new Set,this.usedIds.add(0)}generate(){let e;do{e=Math.floor(1e6*Math.random())}while(this.usedIds.has(e));return this.usedIds.add(e),e}isInUse(e){return this.usedIds.has(e)}}class S{constructor(e){this.messageReceiver=e}notify(e,t){this.messageReceiver.onMessageReceived(e,t)}}class I{constructor(e,t){this.sourceId=e,this.listenerBridge=t,this.observers=new c.k}init(){const e=new class{constructor(e){this.messenger=e}onMessageReceived(e,t){this.messenger.onMessageReceived(e,t)}}(this),t=new S(e);this.listenerBridge.listen(t)}dispose(){this.listenerBridge.stopListening()}addObserver(e){this.observers.add(e.messageType,e)}removeObserver(e){this.observers.remove(e.messageType,e)}send(e,t,i,n){i.send(Object.assign(Object.assign({},e),{fromId:this.sourceId,toId:t,timestamp:Date.now()}),n)}onMessageReceived(e,t){const i=e.type,n=this.observers.getValuesAtKey(i);if(n)for(const i of n){const n=e.payload||e;i.notify(n,t,e.timestamp)}}}class E{constructor(e){this.targetWindow=e,this.messageObserver=null,this.onMessage=e=>{if(this.messageObserver){const t=e.data;this.messageObserver.notify(Object.assign({},t),{id:t.fromId,origin:e.origin,source:e.source},e.data.timestamp)}}}listen(e){this.messageObserver||(this.messageObserver=e,this.targetWindow.addEventListener("message",this.onMessage))}stopListening(){this.targetWindow.removeEventListener("message",this.onMessage),this.messageObserver=null}}class N{constructor(e,t="*"){this.targetWindow=e,this.targetOrigin=t}send(e,t){this.targetWindow.postMessage(e,this.targetOrigin)}}class D{listen(){}stopListening(){}send(){throw Error("The sdk has been disconnected and can't make any new calls")}}class C{constructor(e,t,i){this.sourceId=e,this.targetId=t,this.messageBridge=i,this.observers=new c.k}static toFilteredMessenger(e,t,i){const n=new M(e.sourceId,e.targetId,e,t);for(const t of i)for(const i of e.observers.getValuesAtKey(t))n.addObserver(i);return n}init(){const e=new class{constructor(e){this.messenger=e}onMessageReceived(e,t){this.messenger.onMessageReceived(e,t)}}(this),t=new S(e);this.messageBridge.listen(t)}dispose(){this.messageBridge.stopListening(),this.messageBridge=new D}addObserver(e){this.observers.add(e.messageType,e)}removeObserver(e){this.observers.remove(e.messageType,e)}send(e){const t=this.sourceId,i=this.targetId;this.messageBridge.send(Object.assign(Object.assign({},e),{fromId:t,toId:i,timestamp:Date.now()}))}onMessageReceived(e,t){if(!this.filterMessageId(e))return;const i=e.type,n=this.observers.getValuesAtKey(i);if(n)for(const i of n){const n=e.payload||e;i.notify(n,t,e.timestamp)}}filterMessageId(e){const t=e.toId,i=e.fromId;return t instanceof Array?t.indexOf(this.sourceId)>-1:(void 0===t||t===this.sourceId)&&i===this.targetId}}class M extends C{constructor(e,t,i,n){super(e,t,new D),this.messenger=i,this.sendFilter=n,this.errorBridge=new D}send(e){this.sendFilter.includes(e.type)?this.messenger.send(e):this.errorBridge.send()}}class O{constructor(e,t,i="*"){this.sourceWindow=e,this.listener=new E(e),this.sender=new N(t,i)}listen(e){this.listener.listen(e)}stopListening(){this.listener.stopListening()}send(e){this.sender.send(e,this.sourceWindow)}}class _{constructor(e,t,i,n,s="*"){this.sourceId=e,this.sourceWindow=t,this.targetId=i,this.targetWindow=n,this.targetOrigin=s}createMessenger(){const e=new O(this.sourceWindow,this.targetWindow,this.targetOrigin);return new C(this.sourceId,this.targetId,e)}}!function(e){e.POSTMESSAGE="postmessage",e.DIRECT="direct",e.WEBSOCKET="websocket"}(a||(a={})),function(e){e.CONNECT="postmessage.connect"}(o||(o={})),function(e){e.HANDSHAKE="postmessage.handshake",e.ACCEPT="postmessage.accept",e.REJECT="postmessage.reject"}(r||(r={}));class A{constructor(e){this.receiver=e,this.messageType=o.CONNECT}notify(e,t){this.receiver.onConnectionReceived(e,t)}}class P{constructor(e,t,i,n,s){this.type=r.ACCEPT,this.payload={scriptUrl:e,interface:t,sourceId:i,targetId:n,targetOrigin:s},this.interface=t}}class L{constructor(){this.type=r.HANDSHAKE,this.payload={}}}class x{constructor(e){this.type=r.REJECT,this.payload={reason:e.message,errorType:e.type},this.reason=e.message}}class R{constructor(e,t,i,n,s){this.hostWindow=e,this.hostId=t,this.applicationKey=i,this.idGenerator=n,this.connectionReceiver=s,this.inFlightClients=new Set,this.connectionHandler=new I(t,new E(window)),this.connectionHandler.addObserver(new A({onConnectionReceived:(e,t)=>this.onConnectionReceived(e,t)}))}init(){this.connectionHandler.init()}dispose(){this.connectionHandler.dispose()}onConnectionReceived(e,t){var i,n;if(this.inFlightClients.has(t.id))return;e=e||{},this.inFlightClients.add(t.id);const s=e&&e.bootstrapVersion?this.idGenerator.generate():t.id,o=this.hostId,r=t.source,d=this.hostWindow,l=new _(o,d,s,r).createMessenger();this.connectionReceiver.onConnectionReceived(t.origin,e.options,{applicationKey:e.applicationKey||this.applicationKey,id:s,messenger:l,communicationMethod:a.POSTMESSAGE,context:{provider:(null===(i=e.options)||void 0===i?void 0:i.provider)||"",sdkType:(null===(n=e.options)||void 0===n?void 0:n.sdkType)||"",bootstrap:{version:e.bootstrapVersion,providedAppKey:!!e.applicationKey}}},{accept(e,t){l.send(new P(e,t,s,o,window.location.origin))},handshake(){l.send(new L)},reject(e){l.send(new x(e)),l.dispose()}})}}class V{constructor(e){this.origin=e,this.observers=new Set}addObserver(e){this.observers.add(e)}removeObserver(e){this.observers.delete(e)}post(e,t){for(const i of this.observers)i.notify(e,t)}}class U{constructor(e){this.targetNode=e,this.messageObserver=null,this.onMessage=(e,t)=>{this.messageObserver&&this.messageObserver.notify({payload:Object.assign({},e.payload),type:e.type},{id:e.fromId,source:t},e.timestamp)}}listen(e){this.messageObserver||(this.messageObserver=e,this.targetNode.addObserver({notify:(e,t)=>{this.onMessage(e,t)}}))}stopListening(){this.messageObserver=null}}class B{constructor(e,t){this.source=e,this.target=t,this.messageObserver=null}listen(e){this.messageObserver||(this.messageObserver=e,this.source.addObserver(e))}stopListening(){this.messageObserver&&this.source.removeObserver(this.messageObserver)}send(e){const t=this.target;t&&t.post(Object.assign({},e),this.source)}}class G{constructor(e,t,i,n){this.sourceId=e,this.sourceNode=t,this.targetId=i,this.targetNode=n}createMessenger(){const e=new B(this.sourceNode,this.targetNode);return new C(this.sourceId,this.targetId,e)}}class F{constructor(e,t={}){this.type=o.CONNECT,this.payload={bootstrapVersion:e,options:{auth:t.auth,provider:t.provider,sdkType:t.sdkType},applicationKey:t.applicationKey}}}class j{constructor(e){this.receiver=e,this.messageType=r.ACCEPT}notify(e,t,i){const{sourceId:n,scriptUrl:s,targetId:a,targetOrigin:o}=e,r=e.interface;this.receiver.accept(n,s,r,a,o)}}!function(e){e.CANCELLED="ConnectionCancelled",e.REFUSED="ConnectionRefused",e.INVALID_PROVIDER="InvalidProvider",e.KEY_MISMATCH="KeyReferrerMismatch"}(d||(d={}));class H extends Error{constructor(){super(),this.type=d.REFUSED,this.name="ConnectionRefusedError"}}class $ extends Error{constructor(e){super(e),this.type=d.INVALID_PROVIDER,this.name="InvalidProviderError"}}class z extends Error{constructor(e){super(e),this.type=d.KEY_MISMATCH,this.name="KeyReferrerMismatchError"}}const W={[d.REFUSED]:H,[d.KEY_MISMATCH]:z,[d.INVALID_PROVIDER]:$};class K{constructor(e){this.receiver=e,this.messageType=r.REJECT}notify(e,t,i){const n=W[e.errorType];if(n){const t=new n(e.reason);this.receiver.reject(t)}}}var X;!function(e){e.CONNECT_PLUGIN="connect.plugin"}(X||(X={}));class q{constructor(e,t,i,n){this.type=X.CONNECT_PLUGIN,this.payload={bootstrapVersion:e,applicationKey:i,pluginId:n,options:{auth:t.auth,provider:t.provider,sdkType:t.sdkType}}}}class Y{constructor(e){this.receiver=e,this.messageType=X.CONNECT_PLUGIN}notify(e,t){this.receiver.onConnectionReceived(e,t)}}function Q(e){return(0,m.G)(e)&&void 0!==e.pluginId}class Z{constructor(e,t,i){this.idGenerator=t,this.connectionReceiver=i,this.host={id:e,node:new V(window.location.origin)},this.connectionHandler=new I(e,new U(this.host.node)),this.connectionHandler.addObserver(new Y({onConnectionReceived:(e,t)=>this.onConnectionReceived(e,t)}))}init(){this.connectionHandler.init()}dispose(){this.connectionHandler.dispose()}onConnectionReceived(e,t){te(e,this.host,{info:t,applicationKey:e.applicationKey},this.connectionReceiver,{pluginId:e.pluginId})}connect(e){const t={id:this.idGenerator.generate(),node:new V(origin)};return ee(this.host,t,(t=>t.send(new q("plugin",{sdkType:n.PLUGIN},e.applicationKey,e.pluginId))))}}class J{constructor(e,t,i,n){this.applicationKey=t,this.idGenerator=i,this.connectionReceiver=n,this.host={id:e,node:new V(window.location.origin)},this.connectionHandler=new I(e,new U(this.host.node)),this.connectionHandler.addObserver(new A({onConnectionReceived:(e,t)=>this.onConnectionReceived(e,t)}))}init(){this.connectionHandler.init()}dispose(){this.connectionHandler.dispose()}onConnectionReceived(e,t){te(e,this.host,{info:t,applicationKey:this.applicationKey},this.connectionReceiver)}connect(e,t={}){const i={id:this.idGenerator.generate(),node:new V(e)};return ee(this.host,i,(e=>e.send(new F("direct",t))))}}function ee(e,t,i){const{id:n,node:s}=e,{id:a,node:o}=t,r=new G(a,o,n,s);return new Promise(((e,t)=>{const d=new G(a,o,n,s).createMessenger();d.init();const l=new class{accept(t,i,n,s){e({targetOrigin:origin,sourceId:t,targetId:s,scriptUrl:i,serializedInterface:n,messengerFactory:r}),d.dispose()}reject(e){t(e),d.dispose()}};d.addObserver(new j(l)),d.addObserver(new K(l)),i(d)}))}function te(e,t,i,n,s){var o,r;const{id:d,node:l}=t,{id:c,source:h,source:{origin:u}}=i.info,m=new G(d,l,c,h).createMessenger();n.onConnectionReceived(u,e.options,{id:c,applicationKey:i.applicationKey,messenger:m,communicationMethod:a.DIRECT,context:{provider:(null===(o=e.options)||void 0===o?void 0:o.provider)||"",sdkType:(null===(r=e.options)||void 0===r?void 0:r.sdkType)||"",pluginId:Q(s)?s.pluginId:void 0,bootstrap:{version:Q(s)?"plugin":"direct",providedAppKey:!!e.applicationKey}}},{accept(e,t){m.send(new P(e,t,c,d,u))},handshake(){m.send(new L)},reject(e){m.send(new x(e)),m.dispose()}})}var ie,ne,se,ae,oe,re,de,le,ce,he,ue,me,pe,ve,ge,ye,fe,we,be,ke,Te=i(35652);!function(e){e.EVENT="postmessage.event",e.RESPONSE="postmessage.response",e.OBSERVATION="postmessage.observation",e.COLLECTION_UPDATE="collection.updated",e.PRIVATE_MESSAGE="private.message"}(ie||(ie={})),function(e){e.ITEM_ADDED="collection.item.added",e.ITEM_REMOVED="collection.item.removed",e.ITEM_UPDATED="collection.item.updated",e.COLL_UPDATED="collection.coll.updated"}(ne||(ne={}));!function(e){e.DISCONNECT="sdk.client.disconnect",e.ACTION="postmessage.action",e.EVENT_SUB="postmessage.subscribe",e.EVENT_UNSUB="postmessage.unsubscribe",e.OBSERVABLE_SUB="postmessage.observe",e.OBSERVABLE_UNSUB="postmessage.unobserve",e.COLLECTION_SUB="collection.sub",e.COLLECTION_UNSUB="collection.unsub",e.PRIVATE_MESSAGE="private.message"}(se||(se={}));!function(e){let t,i,n,s;!function(e){e.PHASE_CHANGE="application.phasechange"}(t=e.Event||(e.Event={})),function(e){e.UNINITIALIZED="appphase.uninitialized",e.WAITING="appphase.waiting",e.LOADING="appphase.loading",e.STARTING="appphase.starting",e.PLAYING="appphase.playing",e.ERROR="appphase.error"}(i=e.Phase||(e.Phase={})),function(e){e.UNKNOWN="application.unknown",e.WEBVR="application.webvr",e.SHOWCASE="application.showcase",e.WORKSHOP="application.workshop"}(n=e.Application||(e.Application={})),function(e){e.RoomBounds="feature.roombounds"}(s=e.Feature||(e.Feature={}))}(ae||(ae={})),function(e){let t,i,n;!function(e){e.IMAGE="image",e.PDF="pdf",e.VIDEO="video",e.RICH="rich",e.ZIP="zip",e.TEXT="text",e.AUDIO="audio",e.MODEL="model",e.APPLICATION="application"}(t=e.MediaType||(e.MediaType={})),function(e){e.EXTERNAL="external",e.UPLOAD="upload",e.SANDBOX="sandbox"}(i=e.AttachmentCategory||(e.AttachmentCategory={})),function(e){e.COMMENT="comment",e.MATTERTAG="mattertag"}(n=e.ParentType||(e.ParentType={}))}(oe||(oe={})),function(e){let t,i;!function(e){e.MOVE="camera.move"}(t=e.Event||(e.Event={})),function(e){e.FORWARD="FORWARD",e.LEFT="LEFT",e.RIGHT="RIGHT",e.BACK="BACK",e.UP="UP",e.DOWN="DOWN"}(i=e.Direction||(e.Direction={}))}(re||(re={})),function(e){let t;!function(e){e.CHANGE_START="floors.changestart",e.CHANGE_END="floors.changeend"}(t=e.Event||(e.Event={}))}(de||(de={})),function(e){let t;!function(e){e.SUCCESS="astar.status.success",e.NO_PATH="astar.status.no_path",e.TIMEOUT="astar.status.timeout",e.NO_START_VERTEX="astar.status.no_start",e.NO_END_VERTEX="astar.status.no_end"}(t=e.AStarStatus||(e.AStarStatus={}))}(le||(le={})),function(e){let t;!function(e){e.POSITION_UPDATED="label.positionupdated"}(t=e.Event||(e.Event={}))}(ce||(ce={})),function(e){let t,i,n;!function(e){e.WINDOW="link.creationpolicy.window",e.REFERRER="link.creationpolicy.referrer",e.MATTERPORT="link.creationpolicy.matterport"}(t=e.CreationPolicy||(e.CreationPolicy={})),function(e){e.DEFAULT="link.openpolicy.default",e.NEW_WINDOW="link.openpolicy.newwindow",e.SAME_FRAME="link.openpolicy.sameframe",e.CURRENT_WINDOW="link.openpolicy.current"}(i=e.OpenPolicy||(e.OpenPolicy={})),function(e){e.DEFAULT="link.destination.default",e.MATTERPORT="link.destination.matterport"}(n=e.DestinationPolicy||(e.DestinationPolicy={}))}(he||(he={})),function(e){let t,i,n,s,a;!function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(t=e.Transition||(e.Transition={})),function(e){e.NAVIGATION="tag.link.nav",e.MODEL="tag.link.model",e.EXT_LINK="tag.link.ext"}(i=e.LinkType||(e.LinkType={})),function(e){e.NONE="tag.chunk.none",e.TEXT="tag.chunk.text",e.LINK="tag.chunk.link"}(n=e.DescriptionChunkType||(e.DescriptionChunkType={})),function(e){e.HOVER="tag.hover",e.CLICK="tag.click",e.LINK_OPEN="tag.linkopen"}(s=e.Event||(e.Event={})),function(e){e.NONE="mattertag.media.none",e.PHOTO="mattertag.media.photo",e.VIDEO="mattertag.media.video",e.RICH="mattertag.media.rich"}(a=e.MediaType||(e.MediaType={}))}(ue||(ue={})),function(e){let t,i,n;!function(e){e.INSIDE="mode.inside",e.OUTSIDE="mode.outside",e.DOLLHOUSE="mode.dollhouse",e.FLOORPLAN="mode.floorplan",e.TRANSITIONING="mode.transitioning"}(t=e.Mode||(e.Mode={})),function(e){e.CHANGE_START="viewmode.changestart",e.CHANGE_END="viewmode.changeend"}(i=e.Event||(e.Event={})),function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(n=e.TransitionType||(e.TransitionType={}))}(me||(me={})),function(e){let t;!function(e){e.MODEL_LOADED="model.loaded"}(t=e.Event||(e.Event={}))}(pe||(pe={})),function(e){let t;!function(e){e.NONE="intersectedobject.none",e.MODEL="intersectedobject.model",e.TAG="intersectedobject.tag",e.SWEEP="intersectedobject.sweep",e.UNKNOWN="intersectedobject.unknown"}(t=e.Colliders||(e.Colliders={}))}(ve||(ve={})),ge||(ge={}),function(e){let t,i;!function(e){e.CAMERA="sensor.sensortype.camera"}(t=e.SensorType||(e.SensorType={})),function(e){e.SPHERE="sensor.sourcetype.sphere",e.BOX="sensor.sourcetype.box",e.CYLINDER="sensor.sourcetype.cylinder"}(i=e.SourceType||(e.SourceType={}))}(ye||(ye={})),function(e){let t,i,n,s;!function(e){e.ENTER="sweep.enter",e.EXIT="sweep.exit"}(t=e.Event||(e.Event={})),function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(i=e.Transition||(e.Transition={})),function(e){e.ALIGNED="aligned",e.UNALIGNED="unaligned"}(n=e.Alignment||(e.Alignment={})),function(e){e.UNPLACED="unplaced",e.AUTO="auto",e.MANUAL="manual"}(s=e.Placement||(e.Placement={}))}(fe||(fe={})),function(e){let t;!function(e){e.UNKNOWN="tag.attachment.unknown",e.APPLICATION="tag.attachment.application",e.AUDIO="tag.attachment.audio",e.IMAGE="tag.attachment.image",e.MODEL="tag.attachment.model",e.PDF="tag.attachment.pdf",e.RICH="tag.attachment.rich",e.TEXT="tag.attachment.text",e.VIDEO="tag.attachment.video",e.ZIP="tag.attachment.zip",e.SANDBOX="tag.attachment.sandbox"}(t=e.AttachmentType||(e.AttachmentType={}))}(we||(we={})),function(e){let t,i;!function(e){e.STARTED="tour.started",e.STOPPED="tour.stopped",e.ENDED="tour.ended",e.STEPPED="tour.stepped"}(t=e.Event||(e.Event={})),function(e){e.INACTIVE="tour.inactive",e.ACTIVE="tour.active",e.STOP_SCHEDULED="tour.stopscheduled"}(i=e.PlayState||(e.PlayState={}))}(be||(be={})),function(e){let t,i,n;!function(e){e.OBJ_LOADER="mp.objLoader",e.FBX_LOADER="mp.fbxLoader",e.DAE_LOADER="mp.daeLoader",e.GLTF_LOADER="mp.gltfLoader",e.SCROLLING_TUBE="mp.scrollingTube",e.TRANSFORM_CONTROLS="mp.transformControls",e.LIGHTS_COMPONENT="mp.lights",e.POINT_LIGHT="mp.pointLight",e.DIRECTIONAL_LIGHT="mp.directionalLight",e.AMBIENT_LIGHT="mp.ambientLight",e.CAMERA="mp.camera",e.INPUT="mp.input",e.XR="mp.xr"}(t=e.Component||(e.Component={})),function(e){e.CLICK="INTERACTION.CLICK",e.HOVER="INTERACTION.HOVER",e.DRAG="INTERACTION.DRAG",e.DRAG_BEGIN="INTERACTION.DRAG_BEGIN",e.DRAG_END="INTERACTION.DRAG_END",e.POINTER_MOVE="INTERACTION.POINTER_MOVE",e.POINTER_BUTTON="INTERACTION.POINTER_BUTTON",e.SCROLL="INTERACTION.SCROLL",e.KEY="INTERACTION.KEY",e.LONG_PRESS_START="INTERACTION.LONG_PRESS_START",e.LONG_PRESS_END="INTERACTION.LONG_PRESS_END",e.MULTI_SWIPE="INTERACTION.MULTI_SWIPE",e.MULTI_SWIPE_END="INTERACTION.MULTI_SWIPE_END",e.PINCH="INTERACTION.PINCH",e.PINCH_END="INTERACTION.PINCH_END",e.ROTATE="INTERACTION.ROTATE",e.ROTATE_END="INTERACTION.ROTATE_END"}(i=e.InteractionType||(e.InteractionType={})),function(e){e.INPUT="input",e.OUTPUT="output",e.EVENT="event",e.EMIT="emit"}(n=e.PathType||(e.PathType={}))}(ke||(ke={}));i(44158),i(44634),i(79105);Math.PI;me.Mode.DOLLHOUSE,new Float32Array(16);var Se=i(59957);Se.E.Success,le.AStarStatus.SUCCESS,Se.E.NoPath,le.AStarStatus.NO_PATH,Se.E.Timeout,le.AStarStatus.TIMEOUT;Symbol.iterator;var Ie;!function(e){e.SETUP="sandbox.setup",e.TO_SANDBOX="sandbox.to.sandbox",e.TO_CLIENT="sandbox.to.client"}(Ie||(Ie={}));var Ee;!function(e){e.map=new Map}(Ee||(Ee={}));Symbol.iterator;var Ne;!function(e){e.ADD="view.add.layer",e.REMOVE="view.remove.layer"}(Ne||(Ne={}));new WeakMap,new WeakMap,new WeakMap;new WeakMap,new WeakMap,new WeakMap;const De=new Te.Ay("SDK client");"undefined"!=typeof __SDK_CLIENT_VERSION__&&De.info("Showcase SDK client version:",__SDK_CLIENT_VERSION__);class Ce{constructor(e,t,i,n){this.type=ie.RESPONSE,this.payload={uid:e,message:t,success:i,error:n},this.uid=e,this.message=t,this.success=i,this.error=n}}class Me{constructor(e,t){this.type=ie.EVENT,this.payload={eventType:e,eventData:t},this.eventType=e,this.eventData=t}}class Oe{constructor(e,t){this.type=ie.OBSERVATION,this.payload={observableKey:e,observableData:t}}}class _e{constructor(e,t,i,n){this.type=ie.COLLECTION_UPDATE,this.payload={operation:e,collectionKey:t,collectionIndex:i,item:n}}}class Ae{constructor(e,t,i){this.type=ie.COLLECTION_UPDATE,this.payload={operation:e,collectionKey:t,collectionIndex:i}}}class Pe{constructor(e,t,i,n){this.type=ie.COLLECTION_UPDATE,this.payload={operation:e,collectionKey:t,collectionIndex:i,item:n}}}class Le{constructor(e,t){this.type=ie.COLLECTION_UPDATE,this.payload={operation:e,collectionKey:t}}}class xe{constructor(e,t){this.type=ie.PRIVATE_MESSAGE,this.payload={messageType:e,messagePayload:t}}}class Re{constructor(e,t){this.receiver=e,this.clientInfo=t,this.messageType=se.ACTION}notify(e){this.receiver.onActionReceived(e,this.clientInfo)}}class Ve{constructor(e,t){this.observer=e,this.clientInfo=t,this.messageType=se.EVENT_SUB}notify(e){this.observer.onEventSubReceived(e,this.clientInfo)}}class Ue{constructor(e,t){this.observer=e,this.clientInfo=t,this.messageType=se.EVENT_UNSUB}notify(e){this.observer.onEventUnsubReceived(e,this.clientInfo)}}class Be{constructor(e,t){this.observer=e,this.clientInfo=t,this.messageType=se.OBSERVABLE_SUB}notify(e){this.observer.onObservableSubReceived(e,this.clientInfo)}}class Ge{constructor(e,t){this.observer=e,this.clientInfo=t,this.messageType=se.OBSERVABLE_UNSUB}notify(e){this.observer.onObservableUnsubReceived(e,this.clientInfo)}}class Fe{constructor(e,t){this.observer=e,this.clientInfo=t,this.messageType=se.COLLECTION_SUB}notify(e){this.observer.onCollectionSubReceived(e,this.clientInfo)}}class je{constructor(e,t){this.observer=e,this.clientInfo=t,this.messageType=se.COLLECTION_UNSUB}notify(e){this.observer.onCollectionUnsubReceived(e,this.clientInfo)}}class He{constructor(e,t){this.observer=e,this.clientInfo=t,this.messageType=se.PRIVATE_MESSAGE}notify(e){this.observer.onPrivateMessageReceived(e,this.clientInfo)}}class $e{constructor(){this.dirty=!1}dispose(){}}const ze=new f.Vy("sdk");class We extends v.n{constructor(){super(...arguments),this.name="sdk",this.hostId=Math.floor(1e6*Math.random()),this.connectionHandlers=[],this.clientInterface={functions:{},commands:{},enums:{},observables:{},collections:{}},this.perOriginInterfaces=new Map,this.perSdkTypeInterfaces=new Map,this.pendingClients=new g.E,this.clientConnections=new Map,this.eventToClientSubMap=new c.k,this.clientToEventSubMap=new c.k,this.observableToClientSubMap=new c.k,this.clientToObservableSubMap=new Map,this.collectionToClientSubMap=new c.k,this.clientToCollectionSubMap=new Map,this.privateMessageHandlers=new c.k,this.valueToClientInterface={},this.commandCreators={},this.commands={},this.asyncCommands={},this.observables={},this.collections={},this.commandExecutionOrder=0,this.firstTimeCollectionSubs=new c.k,this.sdkTypeByBuild=n.EMBED}async init(e,t){this.config=e,this.validationUrl=e.validationUrl,this.facade=new We.MessengerHostFacade(this),this.clientIdGenerator=new T,this.postmessageConnectHandler=new R(window,this.hostId,e.applicationKey,this.clientIdGenerator,this.facade),this.directConnectHandler=new J(this.hostId,e.applicationKey,this.clientIdGenerator,this.facade),this.pluginConnectHandler=new Z(this.hostId,this.clientIdGenerator,this.facade),this.connectionHandlers.push(this.postmessageConnectHandler,this.directConnectHandler,this.pluginConnectHandler),this.sdkTypeByBuild=n.BUNDLE,this.analytics=new b(await t.getModuleBySymbol(p.aF)),this.clientFilter=e.clientFilter||(()=>!0),this.issueCommand=t.commandBinder.issueCommand.bind(t.commandBinder),this.getSdkConfig=e.getSdkConfig,this.requestQueue=e.queue,this.data=new w.d,t.market.register(this,w.d,this.data),this.addPrivateMessageHandler(new k(this.analytics)),this.enableHandshaking()}dispose(){for(const e of this.connectionHandlers)e.dispose();this.clearInterface()}connect(e,t){try{new URL(e)}catch(e){return Promise.reject(e)}return this.directConnectHandler.connect(e,t)}connectPlugin(e,t){return this.pluginConnectHandler.connect({applicationKey:e,pluginId:t})}getClientAuth(e){const t=this.pendingClients.get(e);return t?Promise.resolve(t):new Promise((t=>{const i=this.pendingClients.onElementChanged({onAdded(n,s){s===e&&(t(n),i.cancel())}})}))}enableHandshaking(){for(const e of this.connectionHandlers)e.init()}async setupInterface(){return this.interfaceLoading||(this.interfaceLoading=this.config.setupExternalSdk(this)),this.interfaceLoading}clearInterface(){this.clientInterface.functions={},this.clientInterface.commands={},this.clientInterface.enums={},this.clientInterface.observables={},this.clientInterface.collections={},this.commandCreators={}}onUpdate(){for(const[e,t]of this.clientToObservableSubMap)for(const[i,[n,s]]of t)n.dirty&&(this.notifyObservableUpdate(i,s.getData(),e),n.dirty=!1);for(const[e,t]of this.clientToCollectionSubMap)for(const[i,[,n]]of t)n.dirty&&this.notifyCollectionUpdates(i,n.readDiff(),e)}addCommandCreator(e,t){const i=this.getInterfaceIndex(e);if(this.clientInterface.functions.hasOwnProperty(i)&&ze.debug(`Overwriting ${i} function in sdk interface`),e.sdkTypes)for(const t of e.sdkTypes){const n=this.perSdkTypeInterfaces.get(t)||{functions:{},commands:{},enums:{},observables:{},collections:{}};n.functions[i]=Object.assign({},e),this.perSdkTypeInterfaces.set(t,n)}if(e.origins)for(const t of e.origins){const n=this.perOriginInterfaces.get(t)||{functions:{},commands:{},enums:{},observables:{},collections:{}};n.functions[i]=Object.assign({},e),this.perOriginInterfaces.set(t,n)}this.clientInterface.functions[i]=e,this.commandCreators[i]=t}addEnumToInterface(e){const t=this.getInterfaceIndex(e);if(this.clientInterface.enums.hasOwnProperty(t)&&ze.debug(`Overwriting ${t} enum in sdk interface`),e.sdkTypes)for(const i of e.sdkTypes){const n=this.perSdkTypeInterfaces.get(i)||{functions:{},commands:{},enums:{},observables:{},collections:{}};n.enums[t]=Object.assign({},e),this.perSdkTypeInterfaces.set(i,n)}if(e.origins)for(const i of e.origins){const n=this.perOriginInterfaces.get(i)||{functions:{},commands:{},enums:{},observables:{},collections:{}};n.enums[t]=Object.assign({},e),this.perOriginInterfaces.set(i,n)}if(this.clientInterface.enums[t]=Object.assign(Object.assign({},e),{values:Object.assign({},e.values)}),"Event"===e.name){const t=Object.keys(e.values);for(const i in t){this.valueToClientInterface;const n=e.values[t[i]];this.valueToClientInterface.hasOwnProperty(n)?ze.warn(`Duplicate event detected for ${JSON.stringify(e)}`):this.valueToClientInterface[n]=e}}}async addCommandToInterface(e,t){const i=this.getInterfaceIndex(e);if(this.addCommand(i,t),e.sdkTypes)for(const t of e.sdkTypes){const n=this.perSdkTypeInterfaces.get(t)||{functions:{},commands:{},enums:{},observables:{},collections:{}};n.commands[i]=Object.assign({},e),this.perSdkTypeInterfaces.set(t,n)}if(e.origins)for(const t of e.origins){const n=this.perOriginInterfaces.get(t)||{functions:{},commands:{},enums:{},observables:{},collections:{}};n.commands[i]=Object.assign({},e),this.perOriginInterfaces.set(t,n)}this.clientInterface.commands[i]=e}async addAsyncCommandToInterface(e,t){const i=this.getInterfaceIndex(e);if(this.addCommand(i,t,!0),e.sdkTypes)for(const t of e.sdkTypes){const n=this.perSdkTypeInterfaces.get(t)||{functions:{},commands:{},enums:{},observables:{},collections:{}};n.commands[i]=Object.assign({},e),this.perSdkTypeInterfaces.set(t,n)}if(e.origins)for(const t of e.origins){const n=this.perOriginInterfaces.get(t)||{functions:{},commands:{},enums:{},observables:{},collections:{}};n.commands[i]=Object.assign({},e),this.perOriginInterfaces.set(t,n)}this.clientInterface.commands[i]=Object.assign({},e)}async addCommand(e,t,i=!1){this.clientInterface.commands.hasOwnProperty(e);const n=this;return i?(this.asyncCommands[e]=t,{dispose(){delete n.asyncCommands[e]}}):(this.commands[e]=await t,{dispose(){delete n.commands[e]}})}addObservableToInterface(e,t){const i=this.getInterfaceIndex(e);if(this.addObservable(i,t),e.sdkTypes)for(const t of e.sdkTypes){const n=this.perSdkTypeInterfaces.get(t)||{functions:{},commands:{},enums:{},observables:{},collections:{}};n.observables[i]=Object.assign({},e),this.perSdkTypeInterfaces.set(t,n)}if(e.origins)for(const t of e.origins){const n=this.perOriginInterfaces.get(t)||{functions:{},commands:{},enums:{},observables:{},collections:{}};n.observables[i]=Object.assign({},e),this.perOriginInterfaces.set(t,n)}this.clientInterface.observables[i]=Object.assign({},e)}addObservable(e,t){this.clientInterface.observables.hasOwnProperty(e),this.observables[e]=t;const i=this;return{dispose(){i.removeObservable(e)}}}removeObservable(e){var t;delete this.observables[e];for(const i of this.observableToClientSubMap.getValuesAtKey(e))null===(t=this.clientToObservableSubMap.get(i.id))||void 0===t||t.delete(e);this.observableToClientSubMap.removeKey(e)}addCollectionToInterface(e,t){const i=this.getInterfaceIndex(e);if(this.addCollection(i,t),e.sdkTypes)for(const t of e.sdkTypes){const n=this.perSdkTypeInterfaces.get(t)||{functions:{},commands:{},enums:{},observables:{},collections:{}};n.collections[i]=Object.assign({},e),this.perSdkTypeInterfaces.set(t,n)}if(e.origins)for(const t of e.origins){const n=this.perOriginInterfaces.get(t)||{functions:{},commands:{},enums:{},observables:{},collections:{}};n.collections[i]=Object.assign({},e),this.perOriginInterfaces.set(t,n)}this.clientInterface.collections[i]=Object.assign({},e)}addCollection(e,t){this.clientInterface.collections.hasOwnProperty(e),this.collections[e]=t;const i=this;return{dispose(){i.removeCollection(e)}}}removeCollection(e){var t;delete this.collections[e];for(const i of this.collectionToClientSubMap.getValuesAtKey(e))null===(t=this.clientToCollectionSubMap.get(i.id))||void 0===t||t.delete(e);this.collectionToClientSubMap.removeKey(e)}addPrivateMessageHandler(e){const{privateMessageHandlers:t}=this;return t.add(e.messageType,e),{dispose(){t.remove(e.messageType,e)}}}getInterfaceIndex(e){let t=`${e.name}`;return e.namespace&&(t=`${e.namespace}.${t}`),t}sendPrivateMessage(e,t,i){for(const[,n]of this.clientConnections)void 0!==i&&n.executing.id!==i||n.messaging.messenger.send(new xe(e,t))}broadcast(e,t,i){for(const[,n]of this.clientConnections)if(t){const s=t(i);n.messaging.messenger.send(new Me(e,s||[]))}else n.messaging.messenger.send(new Me(e,[]))}notifyObservableUpdate(e,t,i){for(const n of this.observableToClientSubMap.getValuesAtKey(e))n.id===i&&n.messenger.send(new Oe(e,t))}notifyCollectionUpdates(e,t,i){const{added:n,removed:s,updated:a}=t,o=n.size>0,r=s.size>0,d=a.size>0,l=this.clientConnections.get(i);if(l){const t=l.messaging,i=t.id;if(o)for(const[i,s]of n)t.messenger.send(new _e(ne.ITEM_ADDED,e,i,s));if(r)for(const[i]of s)t.messenger.send(new Ae(ne.ITEM_REMOVED,e,i));if(d)for(const[i,n]of a)t.messenger.send(new Pe(ne.ITEM_UPDATED,e,i,n));(o||r||d||this.firstTimeCollectionSubs.has(i,e))&&(t.messenger.send(new Le(ne.COLL_UPDATED,e)),this.firstTimeCollectionSubs.remove(i,e))}}verifyConnection(e,t){const i={cache:!1,headers:{"X-Matterport-Application-Key":t,"X-Matterport-Referrer":e},priority:l.QK.HIGH};return this.requestQueue.get(this.validationUrl,i)}async onConnectionReceived(e,t={},i,s){if(!this.clientFilter(e))return s.reject(new H);t&&(0,h.U)(n,t.sdkType)?i.context.sdkType=t.sdkType:i.context.sdkType=this.sdkTypeByBuild;const a=new Xe(t.auth,t.provider);if(!Q(i.context))try{await this.verifyConnection(e,i.applicationKey),this.pendingClients.set(i.applicationKey,a)}catch(t){return a.reject(),s.reject(new z(`${i.applicationKey}@${e} - Key/referrer mismatch`))}const o=()=>{const t=new URL(e).hostname,n=this.perOriginInterfaces.get(t.toLowerCase()),s=this.perSdkTypeInterfaces.get(i.communicationMethod),a={enums:{},functions:{},observables:{},collections:{}},o=function(e,t,i,n){const s=e[t].sdkTypes,a=e[t].origins;if(!s&&!a)return!0;const o=s&&a&&(null==i?void 0:i[t])&&(null==n?void 0:n[t]),r=s&&!a&&(null==i?void 0:i[t]),d=!s&&a&&(null==n?void 0:n[t]);return o||r||d};for(const e in this.clientInterface.enums)o(this.clientInterface.enums,e,null==s?void 0:s.enums,null==n?void 0:n.enums)&&(a.enums[e]=this.clientInterface.enums[e]);for(const e in this.clientInterface.observables)o(this.clientInterface.observables,e,null==s?void 0:s.observables,null==n?void 0:n.observables)&&(a.observables[e]=this.clientInterface.observables[e]);for(const e in this.clientInterface.collections)o(this.clientInterface.collections,e,null==s?void 0:s.collections,null==n?void 0:n.collections)&&(a.collections[e]=this.clientInterface.collections[e]);for(const e in this.clientInterface.functions)o(this.clientInterface.functions,e,null==s?void 0:s.functions,null==n?void 0:n.functions)&&(a.functions[e]=this.clientInterface.functions[e]);for(const e in this.clientInterface.commands)o(this.clientInterface.commands,e,null==s?void 0:s.commands,null==n?void 0:n.commands)&&(a.functions[e]=this.clientInterface.commands[e]);return a};s.handshake();try{if(!Q(i.context)){if(!await this.config.validateProvider(t.provider))throw a.reject(),new $}a.accept(),await this.setupInterface();const n=o();this.onConnectionAccepted(e,i,t),s.accept((await this.getSdkConfig).client,n),this.data.atomic((()=>{this.data.applicationKeys.push({key:i.applicationKey,provider:i.context.provider}),this.data.commit()}))}catch(e){s.reject(e)}}onConnectionAccepted(e,t,i){const n=t.id,s=t.messenger,a={messaging:Object.assign(Object.assign({},t),{origin:e}),executing:{get id(){return t.context.pluginId||String(n)},applicationKey:t.applicationKey}};this.clientConnections.set(n,a);const o=this.facade;s.addObserver(new Re(o,a.messaging)),s.addObserver(new Ve(o,a.messaging)),s.addObserver(new Ue(o,a.messaging)),s.addObserver(new Be(o,a.messaging)),s.addObserver(new Ge(o,a.messaging)),s.addObserver(new Fe(o,a.messaging)),s.addObserver(new je(o,a.messaging)),s.addObserver(new He(o,a.messaging)),s.init(),this.trackSdkConnect(a.messaging,i)}onDisconnectReceived(e,t){const i=t.messaging,n=this.clientToEventSubMap.getValuesAtKey(i.id),s=this.clientToObservableSubMap.get(i.id)||[],a=this.clientToCollectionSubMap.get(i.id)||[];for(const e of n)this.eventToClientSubMap.remove(e,i);for(const[e]of s)this.observableToClientSubMap.remove(e,i);for(const[e]of a)this.collectionToClientSubMap.remove(e,i);this.clientToEventSubMap.removeKey(i.id),this.clientToObservableSubMap.delete(i.id),this.clientToCollectionSubMap.delete(i.id);const o=this.data.applicationKeys.indexOf({key:i.applicationKey,provider:i.context.provider});o>-1&&this.data.applicationKeys.splice(o,1)}onActionReceived(e,t){if(this.tryActionThroughCommand(e,t))return;const i=this.commandCreators[e.targetFunction];if(i){this.trackSdkCall(e,t.messaging.id);try{this.issueCommand(i(e.params,t.executing)).then((i=>t.messaging.messenger.send(new Ce(e.uid,i,!0,"")))).catch((i=>t.messaging.messenger.send(new Ce(e.uid,{},!1,i.message||i))))}catch(i){ze.debug(i),t.messaging.messenger.send(new Ce(e.uid,{},!1,i.message))}}else t.messaging.messenger.send(new Ce(e.uid,{},!1,`${e.targetFunction} is not a valid command`))}tryActionThroughCommand(e,t){if(this.tryActionThroughAsyncCommand(e,t))return!0;const i=this.commands[e.targetFunction];if(!i)return!!this.clientInterface.commands.hasOwnProperty(e.targetFunction)&&(t.messaging.messenger.send(new Ce(e.uid,{},!1,`${e.targetFunction} is not ready to be called`)),!0);this.trackSdkCall(e,t.messaging.id);try{i.exec(e.params,Object.assign(Object.assign({},e.context),{client:t.executing,key:e.targetFunction,executionId:this.commandExecutionOrder++})).then((i=>{t.messaging.messenger.send(new Ce(e.uid,i,!0,""))})).catch((i=>{t.messaging.messenger.send(new Ce(e.uid,{},!1,i.message||i))}))}catch(i){ze.debug(i),t.messaging.messenger.send(new Ce(e.uid,{},!1,i.message))}return!0}tryActionThroughAsyncCommand(e,t){const i=this.asyncCommands[e.targetFunction];return!!i&&(i.then((i=>{this.trackSdkCall(e,t.messaging.id);try{i.exec(e.params,Object.assign(Object.assign({},e.context),{client:t.executing,key:e.targetFunction,executionId:this.commandExecutionOrder++})).then((i=>{t.messaging.messenger.send(new Ce(e.uid,i,!0,""))})).catch((i=>{t.messaging.messenger.send(new Ce(e.uid,{},!1,i.message||i))}))}catch(i){ze.debug(i),t.messaging.messenger.send(new Ce(e.uid,{},!1,i.message))}})),!0)}onEventSubReceived(e,t){const i=t.messaging;this.eventToClientSubMap.add(e.subscription,i),this.trackSdkEvent(s.SUBSCRIBED,e,i)}onEventUnsubReceived(e,t){const i=t.messaging;this.eventToClientSubMap.remove(e.subscription,i),this.trackSdkEvent(s.UNSUBSCRIBED,e,i)}async onObservableSubReceived(e,t){const i=t.messaging,n=e.observableKey,a=this.observables[n];if(a){const t=await a;if(!this.observables[n])return;if(!this.observableToClientSubMap.has(n,i)){const a=new $e,o=t.subscribe(a);this.observableToClientSubMap.add(n,i);const r=this.clientToObservableSubMap.get(i.id)||new Map;r.set(n,[a,t,o]),this.clientToObservableSubMap.set(i.id,r),this.trackClientObservableSub(s.OBSERVABLE_SUB,e,i)}}else ze.error(n,"is not a valid, registered observable")}onObservableUnsubReceived(e,t){const i=t.messaging,n=e.observableKey;this.observableToClientSubMap.remove(n,i);const a=this.clientToObservableSubMap.get(i.id);if(a){const t=a.get(n);if(t){const[,,o]=t;o.cancel(),a.delete(n),this.trackClientObservableSub(s.OBSERVABLE_UNSUB,e,i)}}}async onCollectionSubReceived(e,t){const i=t.messaging,n=e.collectionKey,a=this.collections[n];if(a){const t=await a;if(!this.collections[n])return;if(!this.collectionToClientSubMap.has(n,i)){const a=t.subscribe(i),o=[t,a];this.collectionToClientSubMap.add(n,i);const r=this.clientToCollectionSubMap.get(i.id)||new Map;r.set(n,o),this.clientToCollectionSubMap.set(i.id,r),this.firstTimeCollectionSubs.add(i.id,n),this.trackClientCollectionSub(s.COLLECTION_SUB,e,i)}}else ze.error(n,"is not a valid, registered collection")}onCollectionUnsubReceived(e,t){const i=t.messaging,n=e.collectionKey;this.collectionToClientSubMap.remove(n,i);const a=this.clientToCollectionSubMap.get(i.id);if(a){const t=a.get(n);if(t){const[,o]=t;o.cancel(),a.delete(n),this.trackClientCollectionSub(s.COLLECTION_UNSUB,e,i)}}}onPrivateMessageReceived(e,t){const{messageType:i,messagePayload:n}=e;for(const e of this.privateMessageHandlers.getValuesAtKey(i))(e.clientId||e.clientId===t.executing.id)&&e.onMessage(n,t.messaging)}trackSdkConnect(e,t){if(!this.analytics)return;const i="string"==typeof(null==t?void 0:t.auth),n={origin:e.origin,applicationKey:e.applicationKey,provider:e.context.provider,method:e.communicationMethod,sdkType:e.context.sdkType,pluginId:e.context.pluginId,authTokenProvided:i,bootstrapVersion:e.context.bootstrap.version,bootstrapProvidedAppKey:e.context.bootstrap.providedAppKey};this.analytics.setOptions({authTokenProvided:i}),this.analytics.alwaysTrack("sdk_connect","connect",n)}trackSdkEvent(e,t,i){if(!this.analytics)return;const n=e===s.SUBSCRIBED?"on":"off",a=this.valueToClientInterface[t.subscription];if(!a)return;const o=Object.keys(a.values),r=o.find(((e,i)=>{const n=o[i];return a.values[n]===t.subscription}));if(!r)return;const d={origin:i.origin,applicationKey:i.applicationKey,provider:i.context.provider,sdkType:i.context.sdkType,name:n,namespace:a.namespace,eventType:r,count:this.eventToClientSubMap.valuesPerKey(t.subscription),method:i.communicationMethod,pluginId:i.context.pluginId};this.analytics.track("sdk_event",t.subscription,d)}trackSdkCall(e,t){const i=this.clientConnections.get(t);if(!i)return;const n=this.clientInterface.functions[e.targetFunction]||this.clientInterface.commands[e.targetFunction],s=i.messaging,a=Object.assign(Object.assign({origin:s.origin,applicationKey:s.applicationKey,provider:s.context.provider,sdkType:s.context.sdkType},n),{method:s.communicationMethod,pluginId:s.context.pluginId});if(this.analytics.track("sdk_call",e.targetFunction,a),n&&"Settings"===n.namespace&&"update"===n.name){const{key:t,value:i}=e.params;(0,u.K)(t)&&this.analytics.track("sdk_settings",t,{origin:s.origin,applicationKey:s.applicationKey,provider:s.context.provider,sdkType:s.context.sdkType,pluginId:s.context.pluginId,settingKey:t,settingValue:(0,m.G)(i)?{}.toString():(0,u.K)(i)?i:JSON.stringify(i)})}}trackClientObservableSub(e,t,i){const n=e===s.OBSERVABLE_SUB,a=this.clientInterface.observables[t.observableKey],o=Object.assign(Object.assign({origin:i.origin,applicationKey:i.applicationKey,provider:i.context.provider,sdkType:i.context.sdkType},a),{is_collection:!1,action:n?"subscribe":"cancel",method:i.communicationMethod,pluginId:i.context.pluginId});this.analytics.track("sdk_subscribe",t.observableKey,o)}trackClientCollectionSub(e,t,i){const n=e===s.COLLECTION_SUB,a=this.clientInterface.collections[t.collectionKey],o=Object.assign(Object.assign({origin:i.origin,applicationKey:i.applicationKey,provider:i.context.provider,sdkType:i.context.sdkType},a),{is_collection:!0,action:n?"subscribe":"cancel",method:i.communicationMethod,pluginId:i.context.pluginId});this.analytics.track("sdk_subscribe",t.collectionKey,o)}}var Ke;We.MessengerHostFacade=class{constructor(e){this.messageHandler=e}onConnectionReceived(e,t,i,n){this.messageHandler.onConnectionReceived(e,t,i,n)}onDisconnectReceived(e,t){const i=this.messageHandler.clientConnections.get(t.id);i&&this.messageHandler.onDisconnectReceived(e,i)}onActionReceived(e,t){const i=this.messageHandler.clientConnections.get(t.id);i&&this.messageHandler.onActionReceived(e,i)}onEventSubReceived(e,t){const i=this.messageHandler.clientConnections.get(t.id);i&&this.messageHandler.onEventSubReceived(e,i)}onEventUnsubReceived(e,t){const i=this.messageHandler.clientConnections.get(t.id);i&&this.messageHandler.onEventUnsubReceived(e,i)}onObservableSubReceived(e,t){const i=this.messageHandler.clientConnections.get(t.id);i&&this.messageHandler.onObservableSubReceived(e,i)}onObservableUnsubReceived(e,t){const i=this.messageHandler.clientConnections.get(t.id);i&&this.messageHandler.onObservableUnsubReceived(e,i)}onCollectionSubReceived(e,t){const i=this.messageHandler.clientConnections.get(t.id);i&&this.messageHandler.onCollectionSubReceived(e,i)}onCollectionUnsubReceived(e,t){const i=this.messageHandler.clientConnections.get(t.id);i&&this.messageHandler.onCollectionUnsubReceived(e,i)}onPrivateMessageReceived(e,t){const i=this.messageHandler.clientConnections.get(t.id);i&&this.messageHandler.onPrivateMessageReceived(e,i)}},function(e){e.name="sdk"}(Ke||(Ke={}));class Xe{constructor(e,t){this.token=e,this.provider=t,this.isAccepted=new y.L(null)}get accepted(){if(null!==this.isAccepted.value){if(this.isAccepted.value)return Promise.resolve();if(!this.isAccepted.value)return Promise.reject()}return new Promise(((e,t)=>{if(null===this.isAccepted.value){const i=this.isAccepted.onChanged((n=>{n?e():t(),i.cancel()}))}}))}accept(){this.isAccepted.value=!0}reject(){this.isAccepted.value=!1}}},47110:(e,t,i)=>{"use strict";i.d(t,{w:()=>n});class n{constructor(e,t,i,n){this.target=e,this.type=t,this.listener=i,this.options=n,this.renew()}renew(){this.target.addEventListener(this.type,this.listener,this.options)}cancel(){this.target.removeEventListener(this.type,this.listener)}}},79627:(e,t,i)=>{"use strict";var n;i.d(t,{A:()=>s}),function(e){e[e.GL_TEXTURE_CUBE_MAP_POSITIVE_X=0]="GL_TEXTURE_CUBE_MAP_POSITIVE_X",e[e.GL_TEXTURE_CUBE_MAP_NEGATIVE_X=1]="GL_TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.GL_TEXTURE_CUBE_MAP_POSITIVE_Y=2]="GL_TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y=3]="GL_TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.GL_TEXTURE_CUBE_MAP_POSITIVE_Z=4]="GL_TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z=5]="GL_TEXTURE_CUBE_MAP_NEGATIVE_Z"}(n||(n={}));const s=n},42468:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Analytics:()=>a,default:()=>r,useAnalytics:()=>o.s});var n=i(23205),s=i(95226);class a extends n.n{constructor(){super(...arguments),this.name="analytics",this.endpoints=[],this.loaded=!1,this.bufferedData=[],this.options={}}async load(e,t,i){this.loaded=!1,Object.assign(this.options,t);for(const t of e)await t.init(this.options,i),this.endpoints.push(t),this.loaded=!0;return this.loaded&&this.flushBufferedData(),this.loaded}setOptions(e){Object.assign(this.options,e),this.endpoints.forEach((t=>{t.setOptions(e)}))}setUser(e){if(e&&e.loggedIn)for(const t of this.endpoints)t.identify(e)}track(e,t,i){return this.loaded?(0,s.cb)(0).then((()=>{this.endpoints.forEach((n=>{n.track(e,t,i)}))})):(this.bufferedData.push({event:e,data:t}),Promise.resolve())}trackAsync(e,t,i){this.loaded?this.endpoints.forEach((n=>{n.trackAsync(e,t,i)})):this.bufferedData.push({event:e,data:t})}trackFeatures(...e){this.options.ab_tests||(this.options.ab_tests=[]);const t=this.options.ab_tests;t.push(...e);const i=new Map(t.map((e=>e.split(":")))),n={ab_tests:Array.from(i,(([e,t])=>`${e}:${t}`))};this.endpoints.forEach((e=>{e.setOptions(n)}))}flushBufferedData(){for(const e of this.bufferedData)this.endpoints.forEach((t=>{t.track(e.event,e.data,e.intercom)}));this.bufferedData.length=0}}var o=i(44246);const r=a},58530:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>L});var n=i(35652),s=i(14495),a=i(80597),o=i(38710);class r{constructor(e){this.blurEnabled=!1,e&&Object.assign(this,e)}}var d,l=i(85869),c=i(95149);!function(e){e.USER="user",e.ADMIN="admin"}(d||(d={}));class h{constructor(e){this.loggedIn=!1,this.flags=new Set,this.memberships=[],e&&Object.assign(this,e)}getFlags(e=""){if(this.memberships){const e=(0,c.P3)("organization","");for(const t of this.memberships)if(""===e||t.organizationId===e)for(const e of t.flags)this.flags.add(e)}const t=new Set;return this.flags.forEach((i=>{if(0===i.indexOf(e)){const n=i.replace(e,"");t.add(n)}})),t}hasFlag(e,t="showcase"){return this.getFlags().has(`${t}/${e}`)}isOrganizationAdmin(e){const t=this.getMembership(e);return!!(null==t?void 0:t.roles.includes(d.ADMIN))}getMembershipFlags(e){const t=this.getMembership(e);return t?t.flags:[]}getMembership(e){return this.memberships.find((t=>t.organizationId===e))}hasMembershipFlag(e,t){return this.getMembershipFlags(e).includes(t)}getMembershipFeature(e,t){const i=this.getMembership(e);return(null==i?void 0:i.features[t])||!1}hasMembership(e){return this.memberships.some((t=>t.organizationId===e))}}class u{constructor(e){this.features={},e&&Object.assign(this,e)}}var m=i(10060);const p=new n.Ay("user.serializers");function v(e,t="24.12.3_webgl-944-ge03b07c22c"){const i=[];for(let n of e){const e=n.match(/^.*\-(\d+(?:\.\d+)*)$/);if(e&&e[1]){if(n=n.replace(/-(\d+(?:\.\d+)*)$/,""),m.h.lt(t,e[1])){p.debug(`Dropping feature flag ${n}, version >= ${e[1]} required`);continue}p.debug(`Enabled versioned feature flag ${n}`)}i.push(n)}return i}var g=i(83662),y=i(8430);const f=new n.Ay("ImageBitmapSupport"),w=(0,c.P3)("imageBitmap",null);let b=null;function k(){return"1"===w||(null===b&&function(){if(b=!1,(0,y.gm)()){const e=(0,y.aZ)();e.major<=95&&(f.error(`Firefox/${e.major} issue, Disabling ImageBitmap support, upgrade to 96 for better performance.`),b=!0)}}(),!b&&("createImageBitmap"in window?"0"!==w:"1"===w))}var T=i(80168),S=i(38398),I=i(33004),E=i(3718),N=i(16730);class D{constructor(e,t,i,n){this.query=e,this.variables=t,this.response=i,this.anonymous=n}read(e,t,i){return e!==this.query||!!(null==i?void 0:i.anonymous)!=!!this.anonymous||(0,N.E7)(t,this.variables)?Promise.resolve(void 0):Promise.resolve(this.response)}}var C=i(54244),M=i(32903),O=i(76283);const _=new n.Ay("api");class A{constructor(e=new s.L3,t=new s.L3,i=window.location.origin,n){this.apiQueue=e,this.storeQueue=t,this.baseUrl=i,this.mdsContext=n,this._configCache={},this._userCache={},this._organizationCache={}}async init(e){this.user=this.getUser(),e&&await this.getConfigs(e)}getOnStoreQueue(e,t={}){return this.get(e,t,this.storeQueue)}get(e,t={},i=this.apiQueue){const{headers:n={}}=t;return t.headers=(0,g.v)(e,n),i.get(e,t).then((e=>{if(null===e)throw Error("Data from get was null, possibly unparsable JSON");return e}))}getImage(e,t){return this.get(e,Object.assign(Object.assign({},t),{responseType:"image"}))}async getImageBitmap(e,t,i,n={}){if(k()){const s=-1!==e.indexOf("?"),a=e+(s?"&":"?")+"imgopt=1",o=await this.get(a,Object.assign(Object.assign({},n),{responseType:"blob"}));return createImageBitmap(o,0,0,t,i,{imageOrientation:n.flipY?"flipY":"none"})}return this.getImage(e,n)}async getConfigs(e){if(e=e.toLowerCase(),this._configCache[e])return this._configCache[e];let t=O.P.config;if(!t){const i=this.baseUrl+`/api/v2/config/${e}`;try{t=await this.get(i,{responseType:"json"})}catch(e){_.warn(`Failed to load config from ${i}, ignoring`)}}return this._configCache[e]=t||{},t||{}}async getAppKey(e,t){if(""===e||""===t)return null;const i=await this.getConfigs(e);return i.hasOwnProperty(t)?i[t]:null}async getGeoIpLocation(){return(0,l.A)(this.apiQueue)}async modelExists(e,t={ignorePrefetch:!1}){var i,n,s,r,d,l,c;const{ignorePrefetch:h}=t;if(!h){const t=O.P.getQuery("GetModelPrefetch"),r=null===(i=null==t?void 0:t.data)||void 0===i?void 0:i.model;if(!(null==r?void 0:r.id)&&O.P.hasPassword)throw new o._W("Model requires a password");if(!(new T.e).isAuthenticated()){const t=O.P.modelErrorCode,i=null==r?void 0:r.state;if(t===M.b.MODEL_COMPLIANCE)throw new o.Q8;if(t===M.b.MODEL_DELETED)throw new o.a_;if(t===M.b.MODEL_PROCESSING||i===C.ve.PROCESSING)throw new o.Wz;if(t===M.b.MODEL_FAILED||i===C.ve.FAILED)throw new o.GI;if(t===M.b.MODEL_ARCHIVED||i===C.ve.INACTIVE)throw new o.X5;if(t===M.b.MODEL_PENDING||i===C.ve.PENDING)throw new o.cC;const d=null===(n=O.P.getQueryErrors("GetModelPrefetch"))||void 0===n?void 0:n.find((e=>{var t;return(null===(t=null==e?void 0:e.path)||void 0===t?void 0:t.length)&&"model"===(null==e?void 0:e.path[0])}));if((null===(s=null==d?void 0:d.extensions)||void 0===s?void 0:s.code)===a.c.NOT_FOUND)throw new o.X6("Model not found (404)");if(r&&(null==r?void 0:r.id)!==e)throw new o.ZT("Access denied (403)")}}const u=await this.modelQuery(e);if(null===(r=u.errors)||void 0===r?void 0:r.length){switch(null===(d=u.errors[0].extensions)||void 0===d?void 0:d.code){case a.c.PASSWORD_REQUIRED:throw new o._W("Access token required (401)");case a.c.NOT_FOUND:throw new o.X6("Model not found (404)");default:throw new o.ZT("Access denied (403)")}}else if((null===(c=null===(l=u.data)||void 0===l?void 0:l.model)||void 0===c?void 0:c.id)!==e)throw new o.ZT("Access denied (403)")}async getOrganization(e){if(e in this._organizationCache)return this._organizationCache[e];const t=`${this.baseUrl}/api/v2/organizations/${e}`,i=await this.get(t,{responseType:"json"}).catch((e=>{_.error(e)}));let n=null;return i&&(n=new r({id:i.sid,name:i.company_name||"",blurEnabled:!!i.manual_blur})),this._organizationCache[e]=n,n}async getUser(e){var t;if(e&&e in this._userCache)return this._userCache[e];const i=`${this.baseUrl}/api/v2/users/${e||"current"}`,n=function(e){if(!e)return new h;const t=(e.memberships||[]).map((t=>new u({userId:e.user_sid,organizationId:t.organization_sid,name:t.name,flags:v(t.flags||[]),roles:t.roles||[],features:t.features||{}})));return new h({id:e.user_sid,firstName:e.first_name,lastName:e.last_name,email:e.email,loggedIn:e.is_authenticated,flags:new Set(v(e.flags)),memberships:t})}(await this.get(i,{responseType:"json"}).catch((e=>{_.error(e)})));return n.id&&(this._userCache[n.id]=n),(null===(t=this.mdsContext)||void 0===t?void 0:t.simulateApiOutage)===S.u.TIMEOUT&&(n.loggedIn=!1),n}async modelQuery(e){var t;const i=null===(t=this.mdsContext)||void 0===t?void 0:t.sharedCaches,n=new I.t({baseUrl:this.baseUrl,mdsContext:this.mdsContext}),s=await n.query(E.GetModelPolicies,{modelId:e},{prefetchKey:"data.model.policies"}),a=(s.errors||[]).filter((e=>{var t;return 1===(null===(t=e.path)||void 0===t?void 0:t.length)&&"model"===e.path[0]}));return 0===a.length&&i&&(this.modelDetailCache&&i.delete(this.modelDetailCache),this.modelDetailCache=new D(E.GetModelPolicies,{modelId:e},s),i.add(this.modelDetailCache)),{data:s.data,errors:a}}}var P=i(23205);class L extends P.n{constructor(){super(...arguments),this.name="api-client"}async init(e,t){this.api=await this.initApi(e)}async initApi(e){const t=new A(e.apiQueue,e.storeQueue,e.baseUrl,e.mdsContext);return await t.init(e.preloadConfig),t}getApi(){return this.api}}},41490:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>_});var n=i(98925),s=i(35223),a=i(76035),o=i(23205),r=i(69505),d=i(82110),l=i(14754);class c extends l.QB{constructor(e){super(),this.is360=e}}var h=i(61589),u=i(54998);class m extends h.B{constructor(){super(),this.name="start-location-view-data",this.startLocationsObservable=(0,u.y)()}setStartLocations(e){this.atomic((()=>{this.startLocationsObservable.clear(),e.forEach((e=>{this.addStartLocationForView(e.sweepId,e.viewId)}))}))}getStartLocationsForSweep(e){return this.startLocationsObservable.get(e)||[]}isStartLocation(e){return this.startLocationsObservable.has(e)}isStartLocationForView(e,t){return this.getStartLocationsForSweep(e).includes(t)}onStartLocationSweepsChanged(e){return this.startLocationsObservable.onChanged(e)}addStartLocationForView(e,t){const i=this.startLocationsObservable.get(e);i?i.push(t):this.startLocationsObservable.set(e,[t])}}var p=i(18284),v=i(49191),g=i(76735),y=i(26325),f=i(80379),w=i(10657),b=i(71271),k=i(11826),T=i(35652),S=i(17650);class I{serialize(e){return{image:e.sid}}}const E=new T.Ay("mds-camera-start-store");class N extends w.g{constructor(e,t){super(e),this.baseModelId=t,this.serializer=new I,this.prefetchKey="data.model.image",this.deserializer=new S.S(this.getViewId.bind(this))}async read(e){var t,i;const n={modelId:this.getViewId()},s=await this.query(b.GetModelImage,n,e),a=null===(i=null===(t=null==s?void 0:s.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.image;return{image:(null==a?void 0:a.id)||"",snapshot:this.deserializer.deserialize(a)}}async update(e){const t=this.getViewId(),i=this.serializer.serialize(e);if(0===Object.keys(i).length)throw new Error("No data to update?");return this.mutate(k.PatchModel,{modelId:t,patch:i}).then((e=>{E.debug(e)}))}async getStartLocationSweeps(){var e,t;const i={modelId:this.baseModelId},n=null===(t=null===(e=(await this.query(b.GetStartLocations,i,{fetchPolicy:"no-cache"})).data)||void 0===e?void 0:e.model)||void 0===t?void 0:t.views,s=[];return n&&n.forEach((e=>{var t,i,n,a;const o=null===(a=null===(n=null===(i=null===(t=e.model)||void 0===t?void 0:t.image)||void 0===i?void 0:i.snapshotLocation)||void 0===n?void 0:n.anchor)||void 0===a?void 0:a.id;o&&s.push({viewId:e.id,sweepId:o})})),s}}var D=i(80262),C=i(16276),M=i(61334),O=i(23730);class _ extends o.n{constructor(){super(...arguments),this.name="camera-start",this.store=null,this.duplicateViewData=new a.G(void 0,new C.f("",new Date)),this.processData=async e=>{var t,i,n;let s,o;const r=e.image,d=e.snapshot;if(d?(s=this.buildCameraStart(d),o=d.thumbnailUrl):r&&(await this.snapshotDataLoadPromise,s=null!==(t=this.getIconStartPose(r))&&void 0!==t?t:void 0,o=this.getIconThumbnail(r)),s||(s=null!==(i=this.getStartFallback())&&void 0!==i?i:void 0),null===(n=null==s?void 0:s.pano)||void 0===n?void 0:n.uuid){const e=this.sweepData.getSweep(s.pano.uuid);e&&!e.enabled&&(this.log.warn(`Enabled hidden start sweep ${s.pano.uuid}`),e.enabled=!0,e.commit())}this.data.atomic((()=>{this.data.icon=r,o&&this.data.thumb?this.data.thumb.refreshFrom(o):(this.data.thumb=o,o&&(o.onStale=async()=>{var e;await(null===(e=this.store)||void 0===e?void 0:e.refresh())})),this.data.pose.copy(null!=s?s:new a.n)})),this.data.commit()},this.beforeViewDuplicate=async()=>{this.duplicateViewData.copy(this.data,!0)},this.afterViewDuplicate=async()=>{this.data.copy(this.duplicateViewData,!0),this.data.commit(),await this.save()}}async init(e,t){const{readonly:i,baseUrl:o,baseModelId:d}=e,{commandBinder:l,market:c}=t,[h,u,g]=await Promise.all([t.getModuleBySymbol(s.T9),c.waitForData(v.A),c.waitForData(M.P)]);this.storage=h,this.sweepData=u,this.data=new a.G,this.engine=t,this.snapshotDataLoadPromise=c.waitForData(n.O).then((e=>{this.snapshotsData=e}));const f=r.s.deserialize();if(f){const e=(0,p.d)(f,this.sweepData);(0,p.X)(e,this.sweepData)?(this.data.deepLinkPose=new a.n,this.data.deepLinkPose.copy(e),this.log.debug("Starting Camera Pose",this.data.deepLinkPose)):this.log.error("Invalid start pose",e)}this.bindings.push(l.addBinding(D.f,(async e=>this.updateStartLocationFromSnapshot(e.snapshotSid))),l.addBinding(D.y,(async e=>{this.data.moveCameraOnViewChange=e.moveCamera,this.data.commit()}))),this.store=new N({context:g.mdsContext,readonly:i,baseUrl:o},d),this.store.onNewData(this.processData),await this.store.refresh(),i||this.bindings.push(this.storage.onSave((()=>this.save()),{dataType:y.p.START_LOCATION})),this.duplicateViewHelper={beforeDuplicate:this.beforeViewDuplicate,afterDuplicate:this.afterViewDuplicate},l.issueCommand(new O.Xj(this.duplicateViewHelper)),t.market.register(this,a.G,this.data),this.startLocationViewData=new m,i?t.market.register(this,m,this.startLocationViewData):this.fetchAllStartLocations().then((()=>{t.market.register(this,m,this.startLocationViewData)}))}dispose(e){e.commandBinder.issueCommand(new O.gq(this.duplicateViewHelper))}async updateStartLocationFromSnapshot(e){const t=this.snapshotsData.get(e),i=this.buildCameraStart(t),n=new a.G(t.sid,t.thumbnailUrl,i);this.data.copy(n,!0),this.data.commit(),this.engine.broadcast(new c(t.is360)),await this.engine.commandBinder.issueCommand(new f.F({dataTypes:[y.p.START_LOCATION]}))}async fetchAllStartLocations(){if(this.store){const e=await this.store.getStartLocationSweeps();this.startLocationViewData.setStartLocations(e)}}async save(){const e=this.data.icon;if(!e||!this.store)return void this.log.warn("Unable to save start location");const t=this.snapshotsData.get(e);this.store.update(t).then((()=>{this.fetchAllStartLocations()}))}buildCameraStart(e){const t={mode:e.metadata.cameraMode,camera:{position:e.metadata.cameraPosition,rotation:e.metadata.cameraQuaternion,zoom:e.metadata.orthoZoom},pano:{}};return(0,d.nI)(t.mode)&&(t.pano={uuid:e.metadata.scanId}),t.floorVisibility=e.metadata.floorVisibility,t}defaultCameraStart(e){return{mode:d.N3.Panorama,camera:{position:e.position,rotation:(0,g.V5)(e.rotation),zoom:0},pano:{uuid:e.id}}}getStartFallback(){const e=this.sweepData.getFirstAlignedSweep()||this.sweepData.getFirstSweep();return void 0===e?null:this.defaultCameraStart(e)}getIconStartPose(e){let t=null;return e&&e in this.snapshotsData.collection&&(t=(new a.n).copy(this.buildCameraStart(this.snapshotsData.get(e)))),(0,p.X)(t,this.sweepData)||(t=null),t}getIconThumbnail(e){if(e&&e in this.snapshotsData.collection)return this.snapshotsData.get(e).thumbnailUrl}}},60867:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>w});var n=i(23205),s=i(53366),a=i(94298),o=i(14754);class r extends o.QB{constructor(e,t){super(),this.x=e,this.y=t}}var d=i(68857),l=i(71294),c=i(18268);class h extends c.u{constructor(e){super(),this.payload=Object.assign({},e)}}h.id="SCREEN_TO_CANVAS_POINT";var u=i(95226);class m extends c.u{constructor(e,t){super(),this.name="blur-canvas",this.payload={duration:e,pixelBlur:t}}}m.id="BLUR_CANVAS";var p=i(84229),v=i(92188),g=i(45018);class y extends p.t{}const f={[d.U.width]:"width",[d.U.height]:"height",[d.U.top]:"top",[d.U.left]:"left"};class w extends n.n{constructor(){super(...arguments),this.name="canvas",this.getNewX=()=>0,this.getNewY=()=>0,this.getNewWidth=e=>e.width,this.getNewHeight=e=>e.height,this.activeTransitions=[],this.activeTransitionMap={left:null,top:null,width:null,height:null},this.onResize=e=>{e.propertyName in d.U&&(this.resolveActiveTransition(e.propertyName),this._canvas.style.transitionDuration=this.stringifyTransitionDurations())},this.onContainerResize=()=>{this.transitionDurations.left=this.transitionDurations.top=this.transitionDurations.width=this.transitionDurations.height="0s",this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this.applySize(),this.applyPosition(),this.activeTransitions.forEach(this.resolveActiveTransition.bind(this)),this._canvas.style.transitionDuration=this.stringifyTransitionDurations()},this.resizeCanvas=async e=>{if(0!==e.resizeDimensions.length)return this.cameraData&&!this.cameraData.canTransition()&&await this.cameraData.transition.promise,this.activeTransitions.forEach(this.resolveActiveTransition.bind(this)),e.resizeDimensions.forEach((e=>{const{property:t,setDimension:i,duration:n=0}=e,s=f[t],a=this._canvas.style[s];switch(t){case d.U.height:this.setHeight(i,n);break;case d.U.width:this.setWidth(i,n);break;case d.U.top:this.setY(i,n);break;case d.U.left:this.setX(i,n)}if(this._canvas.style[s]!==a&&n>0){const e=new l.i;e.then((()=>{clearTimeout(i)}));const i=setTimeout((()=>{this.resolveActiveTransition(t)}),n+500);this.activeTransitionMap[t]=e,this.activeTransitions.push(t)}})),this.hasActiveTransitions()||(this.canvasBounds=this._canvas.getBoundingClientRect()),this.getTransitionPromise()}}async init(e,t){if(this.engine=t,!e.container)throw new y;this.container=e.container,this.container.appendChild(e.canvas),this.containerBounds=this.container.getBoundingClientRect(),this._canvas=e.canvas,this._canvas.style.position="absolute",this._canvas.style.left="0",this._canvas.style.top="0",this.transitionDurations={left:"0s",top:"0s",width:"0s",height:"0s",filter:"0.4s"},this._canvas.style.transitionProperty=Object.keys(this.transitionDurations).join(","),this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this.updateTransitions(),this.bindings.push(t.subscribe(v.P,this.onContainerResize),t.commandBinder.addBinding(d.E,this.resizeCanvas),this.makeTransitionEndSubscription(),t.commandBinder.addBinding(h,(async e=>this.screenToCanvasPoint(e.x,e.y))),t.commandBinder.addBinding(m,this.blur.bind(this)));for(const e of this.bindings)e.renew();this.canvasBounds=this._canvas.getBoundingClientRect(),this.containerBounds=this.container.getBoundingClientRect(),this.data=new s.p(this.canvasBounds.width,this.canvasBounds.height,this._canvas),t.market.register(this,s.p,this.data),this.cameraData=await this.engine.market.waitForData(g.M)}makeTransitionEndSubscription(){let e=!1;return{renew:()=>{e||(this.element.addEventListener("transitionend",this.onResize),e=!0)},cancel:()=>{e&&(this.element.removeEventListener("transitionend",this.onResize),e=!1)}}}dispose(e){super.dispose(e)}get element(){return this._canvas}get width(){return this.canvasBounds.width}get height(){return this.canvasBounds.height}get x(){return this.canvasBounds.left}get y(){return this.canvasBounds.top}onUpdate(){const e=this.container.getBoundingClientRect(),t=this.containerHasChanged(e);t&&(this.containerBounds=e,this.updateTransitions()),(t||this.hasActiveTransitions())&&(this.canvasBounds=this._canvas.getBoundingClientRect());const i=this.data.width!==this.width||this.data.height!==this.height,n=this.data.x!==this.x||this.data.y!==this.y;i&&(this.data.width=this.width,this.data.height=this.height,this.data.commit(),this.engine.broadcast(new a.h(this.width,this.height))),n&&(this.data.x=this.x,this.data.y=this.y,this.data.commit(),this.engine.broadcast(new r(this.x-this.containerBounds.left,this.y-this.containerBounds.top)))}containerHasChanged(e){return e.left!==this.containerBounds.left||e.top!==this.containerBounds.top||e.width!==this.containerBounds.width||e.height!==this.containerBounds.height}setX(e,t=0){this.getNewX="number"==typeof e?()=>e:e,this.transitionDurations.left=`${t}ms`,this.updateTransitions()}setY(e,t=0){this.getNewY="number"==typeof e?()=>e:e,this.transitionDurations.top=`${t}ms`,this.updateTransitions()}setWidth(e,t=0){this.getNewWidth="number"==typeof e?()=>e:e,this.transitionDurations.width=`${t}ms`,this.updateTransitions()}setHeight(e,t=0){this.getNewHeight="number"==typeof e?()=>e:e,this.transitionDurations.height=`${t}ms`,this.updateTransitions()}screenToCanvasPoint(e,t){return{x:e-this.x,y:t-this.y}}async blur(e){this.transitionDurations.filter=`${e.duration}ms`,this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this._canvas.style.filter=`blur(${e.pixelBlur}px)`,await(0,u.cb)(e.duration),0===e.pixelBlur&&(this._canvas.style.filter="")}getTransitionPromise(){return Promise.all(this.activeTransitions.map((e=>this.activeTransitionMap[e])).filter((e=>!!e)))}updateTransitions(){this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this.applySize(),this.applyPosition()}applySize(){this._canvas.style.width=`${this.getNewWidth(this.containerBounds)}px`,this._canvas.style.height=`${this.getNewHeight(this.containerBounds)}px`}applyPosition(){this._canvas.style.left=`${this.getNewX(this.containerBounds)}px`,this._canvas.style.top=`${this.getNewY(this.containerBounds)}px`}stringifyTransitionDurations(){return Object.keys(this.transitionDurations).map((e=>this.transitionDurations[e])).join(",")}resolveActiveTransition(e){this.canvasBounds=this._canvas.getBoundingClientRect();const t=this.activeTransitions.indexOf(e);-1!==t&&this.activeTransitions.splice(t,1);const i=this.activeTransitionMap[e];i&&i.resolve(),this.activeTransitionMap[e]=null,this.transitionDurations[e]="0s"}hasActiveTransitions(){return this.activeTransitions.length>0}}},51474:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>d});var n=i(23205),s=i(4913),a=i(29600),o=i(92188),r=i(43591);class d extends n.n{constructor(){super(...arguments),this.name="container-data",this.onResize=()=>{const{clientWidth:e,clientHeight:t}=this.data.element;this.data.size={width:e,height:t},this.data.orientation=e>t?a.U.LANDSCAPE:a.U.PORTRAIT,this.data.commit()}}async init(e,t){this.data=new s.G(e.element),t.market.register(this,s.G,this.data),this.resizeObserver=new r.A(this.onResize),this.resizeObserver.observe(e.element),this.onResize(),this.data.onPropertyChanged("size",(e=>{t.broadcast(new o.P(e.width,e.height))})),this.data.onPropertyChanged("orientation",(e=>{t.broadcast(new o.H(e))}))}dispose(e){e.market.unregister(this,s.G),this.resizeObserver.disconnect(),super.dispose(e)}}},92188:(e,t,i)=>{"use strict";i.d(t,{H:()=>a,P:()=>s});var n=i(14754);class s extends n.QB{constructor(e,t){super(),this.width=e,this.height=t}}class a extends n.QB{constructor(e){super(),this.orientation=e}}},9264:(e,t,i)=>{"use strict";i.d(t,{$V:()=>c,DQ:()=>o,Dw:()=>f,X8:()=>h,Yf:()=>g,Yp:()=>l,aY:()=>m,bI:()=>y,eW:()=>d,g1:()=>v,mK:()=>u,ol:()=>r,pz:()=>p,qD:()=>s,vc:()=>a});var n=i(75673);const s=1e3/60,a=89*n.fy,o=90*n.fy,r=.001*n.fy,d=10*n.fy,l=20*n.fy,c=30*n.fy,h=.25,u=500,m=.1,p=.16,v=.08,g=Math.PI/1e3,y=.02,f=150},53312:(e,t,i)=>{"use strict";i.d(t,{C:()=>s,x:()=>a});var n=i(13686);class s extends n.E{constructor(e,t,i){super(),this.pointerCount=e,this.position=Object.assign({},t),this.delta=Object.assign({},i)}}class a extends n.E{constructor(e,t,i,n){super(),this.pointerCount=e,this.position=Object.assign({},t),this.delta=Object.assign({},i),this.timeSinceLastMove=n}}},85239:(e,t,i)=>{"use strict";i.d(t,{g:()=>a,l:()=>s});var n=i(13686);class s extends n.E{constructor(e){super(),this.pinchDelta=e}}class a extends n.E{constructor(e,t){super(),this.pinchDelta=e,this.timeSinceLastMove=t}}},8423:(e,t,i)=>{"use strict";i.d(t,{H:()=>s});var n=i(13686);class s extends n.E{constructor(e){super(),this.pointers=e}}},57090:(e,t,i)=>{"use strict";i.d(t,{K:()=>s,t:()=>a});var n=i(13686);class s extends n.E{constructor(e){super(),this.rotateDelta=e}}class a extends n.E{constructor(e,t){super(),this.rotateDelta=e,this.timeSinceLastMove=t}}},57458:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>oe});var n=i(23205),s=i(17603),a=i(14054),o=i(79105);const r=e=>{const t=o.O[o.m[e]];return"number"==typeof t?t:void 0},d=e=>{const t=o.m[o.O[e]];return"number"==typeof t?t:void 0};var l=i(75650),c=i(48439),h=i(24525),u=i(95226),m=i(8430),p=i(47110),v=i(93834);class g{constructor(e,t,i,n,s){if(this.config=e,this.canvasData=i,this.gutterScrollEnabled=s,this.handledTouchesAsPointer=0,this.lastTouchEnd=0,this.scrollGutterStart=!1,this.bindings=[],this.activeButtons=o.O.NONE,this.preventDoubleTap=e=>{e.cancelable&&e.timeStamp-this.lastTouchEnd<=g.doubleTapThreshold&&e.preventDefault(),this.lastTouchEnd=e.timeStamp},this.preventMultiTouchGesture=e=>{const t=e.touches&&e.touches.length>1,i="scale"in e&&1!==e.scale;(t||i)&&e.cancelable&&e.preventDefault()},this.onEventCallback=n,window.PointerEvent||this.bindings.push(new p.w(t,"mousedown",(e=>this.onMouseDown(e))),new p.w(t,"mouseup",(e=>this.onMouseUp(e))),new p.w(t,"mousemove",(e=>this.onMouseMove(e))),new p.w(t,"mouseenter",(e=>this.onMouseEnter(e)))),this.bindings.push(new p.w(t,"contextmenu",(e=>e.preventDefault())),new p.w(t,"touchstart",(e=>this.onTouchStart(e))),new p.w(t,"touchend",(e=>this.onTouchEnd(e))),new p.w(t,"touchmove",(e=>this.onTouchMove(e))),new p.w(t,"touchcancel",(e=>this.onTouchEnd(e))),new p.w(t,"pointerdown",(e=>this.onPointerDown(e))),new p.w(t,"pointerup",(e=>this.onPointerUp(e))),new p.w(t,"pointermove",(e=>this.onPointerMove(e))),new p.w(t,"pointercancel",(e=>this.onPointerUp(e))),new p.w(t,"pointerenter",(e=>this.onMouseEnter(e)))),(0,m.OF)()||(0,m.J0)()){const e=h.u?{passive:!1}:void 0;this.bindings.push(new p.w(t,"touchmove",this.preventMultiTouchGesture,e),new p.w(t,"touchend",this.preventDoubleTap,e))}}dispose(){for(const e of this.bindings)e.cancel();this.bindings.length=0}toggleTouchScrolling(e){this.gutterScrollEnabled=e}onMouseDown(e){e.currentTarget.focus(),this.tryPreventDefault(e);const t=e.button;if((0,m.T)()&&this.isMouseHeld())return;this.activeButtons|=1<<t;const{ndc:i,client:n}=this.getPointerPosition(e);this.onEventCallback(new l.CD(this.getPointerId(e),i,n,t,!0,c.o.MOUSE,e))}onMouseUp(e){this.tryPreventDefault(e);const t=d(this.activeButtons),i=(0,m.T)()&&null!=t?t:e.button;this.activeButtons&=~(1<<i);const{ndc:n,client:s}=this.getPointerPosition(e);this.onEventCallback(new l.CD(this.getPointerId(e),n,s,i,!1,c.o.MOUSE,e))}onMouseMove(e){this.tryPreventDefault(e);const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new l.$3(this.getPointerId(e),t,i,this.activeButtons,c.o.MOUSE,e))}onMouseEnter(e){this.checkMissingButtons(e)}isMouseHeld(){return this.activeButtons!==o.O.NONE}checkMissingButtons(e){const t=(0,u.Uk)(e.buttons,o.m.MIDDLE,o.m.SECONDARY),i=(this.activeButtons^t)&~t;for(let t=o.m.PRIMARY;t<o.m.COUNT;++t){const n=r(t);if(n&&(i&n)>0){const{ndc:i,client:n}=this.getPointerPosition(e);this.onEventCallback(new l.CD(this.getPointerId(e),i,n,t,!1,c.o.MOUSE,e))}}this.activeButtons=t}onTouchStart(e){if(this.scrollGutterStart=this.isScrollGutter(e),e.currentTarget.focus(),this.scrollGutterStart||this.tryPreventDefault(e),this.handledTouchesAsPointer)--this.handledTouchesAsPointer;else for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches.item(t),{ndc:n,client:s}=this.getTouchPosition(i);this.onEventCallback(new l.CD(i.identifier,n,s,o.m.PRIMARY,!0,c.o.TOUCH,e))}}onTouchEnd(e){if(this.scrollGutterStart?this.scrollGutterStart=!1:this.tryPreventDefault(e),this.handledTouchesAsPointer)--this.handledTouchesAsPointer;else for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches.item(t),{ndc:n,client:s}=this.getTouchPosition(i);this.onEventCallback(new l.CD(i.identifier,n,s,o.m.PRIMARY,!1,c.o.TOUCH,e))}}onTouchMove(e){if(this.scrollGutterStart&&(this.isScrollGutter(e)||(this.scrollGutterStart=!1)),this.scrollGutterStart||this.tryPreventDefault(e),this.handledTouchesAsPointer)--this.handledTouchesAsPointer;else for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches.item(t),{ndc:n,client:s}=this.getTouchPosition(i),a=new l.$3(i.identifier,n,s,o.O.PRIMARY,c.o.TOUCH,e);this.onEventCallback(a)}}onPointerDown(e){const{ndc:t,client:i}=this.getPointerPosition(e);switch(this.scrollGutterStart=this.isScrollGutter(e),this.scrollGutterStart||this.tryPreventDefault(e),e.pointerType){case c.o.MOUSE:this.onMouseDown(e);break;case c.o.GAMEPAD:case c.o.TOUCH:++this.handledTouchesAsPointer,this.onEventCallback(new l.CD(e.pointerId,t,i,o.m.PRIMARY,!0,e.pointerType,e))}}onPointerUp(e){switch(this.scrollGutterStart?this.scrollGutterStart=!1:this.tryPreventDefault(e),e.pointerType){case c.o.MOUSE:this.onMouseUp(e);break;case c.o.GAMEPAD:case c.o.TOUCH:++this.handledTouchesAsPointer;const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new l.CD(e.pointerId,t,i,o.m.PRIMARY,!1,e.pointerType,e))}}onPointerMove(e){switch(this.scrollGutterStart&&(this.isScrollGutter(e)||(this.scrollGutterStart=!1)),this.scrollGutterStart||this.tryPreventDefault(e),e.pointerType){case c.o.MOUSE:-1!==e.button?this.activeButtons<e.buttons?this.onMouseDown(e):this.activeButtons>e.buttons&&this.onMouseUp(e):this.onMouseMove(e);break;case c.o.GAMEPAD:case c.o.TOUCH:++this.handledTouchesAsPointer;const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new l.$3(e.pointerId,t,i,o.O.PRIMARY,e.pointerType,e))}}getPointerId(e){return(0,a.EE)(e)?e.pointerId:0}getPointerPosition(e){return{ndc:this.normalizePosition(e.clientX,e.clientY),client:{x:e.clientX-this.canvasData.x,y:e.clientY-this.canvasData.y}}}getTouchPosition(e){return{ndc:this.normalizePosition(e.clientX,e.clientY),client:{x:e.clientX-this.canvasData.x,y:e.clientY-this.canvasData.y}}}normalizePosition(e,t){return{x:2*(e-this.canvasData.x)/this.canvasData.width-1,y:-2*(t-this.canvasData.y)/this.canvasData.height+1}}isScrollGutter(e){if(!this.gutterScrollEnabled)return!1;let t;if(!(e instanceof PointerEvent)){if(1!==e.changedTouches.length)return!1;const i=e.changedTouches.item(0);t=this.getTouchPosition(i).client.x}else{if(e.pointerType!==c.o.TOUCH)return!1;t=this.getPointerPosition(e).client.x}return(0,v.b)(t,e.currentTarget)}tryPreventDefault(e){if(!e.cancelable)return;(!(e instanceof MouseEvent||e instanceof PointerEvent)||this.config.pointerPreventDefault)&&e.preventDefault()}}g.doubleTapThreshold=300;var y,f=i(44158),w=i(44634),b=i(33518);!function(e){e[e.SEMICOLON=59]="SEMICOLON",e[e.PLUSEQUALS=61]="PLUSEQUALS",e[e.DASHUNDERSCORE=173]="DASHUNDERSCORE"}(y||(y={}));const k=[f.D.TAB,f.D.RETURN,f.D.SPACE,f.D.ESCAPE];class T{constructor(e,t){this.rootNode=e,this.keysDown={},this.bindings=[],this.onEventCallback=t,this.bindHandlers()}dispose(){for(const e of this.bindings)e.cancel();this.bindings.length=0}isKeyHeld(e){return!!this.keysDown[e]}bindHandlers(){const e=this.rootNode;this.bindings.push(new p.w(e,"focusout",(({relatedTarget:e})=>{e&&e instanceof Node&&this.rootNode.contains(e)||Object.keys(this.keysDown).forEach((e=>this.keysDown[e]=!1))})),new p.w(e,"keydown",(e=>{if(e.ctrlKey||e.metaKey)return void(this.keysDown[this.translateFirefoxKeys(e.which||e.keyCode)]=!0);k.includes(e.keyCode)||(e.preventDefault(),e.stopPropagation());const t=this.translateFirefoxKeys(e.which||e.keyCode);this.keysDown[t]=!0,this.onEventCallback(new b.k(t,w.$.DOWN,e))})),new p.w(e,"keyup",(e=>{const t=this.translateFirefoxKeys(e.which||e.keyCode);e.ctrlKey||e.metaKey?this.keysDown[t]=!1:(k.includes(e.keyCode)||(e.preventDefault(),e.stopPropagation()),this.keysDown[t]&&this.onEventCallback(new b.k(t,w.$.PRESSED,e)),this.keysDown[t]=!1,this.onEventCallback(new b.k(t,w.$.UP,e)))})))}translateFirefoxKeys(e){switch(e){case y.SEMICOLON:return f.D.SEMICOLON;case y.PLUSEQUALS:return f.D.PLUSEQUALS;case y.DASHUNDERSCORE:return f.D.DASHUNDERSCORE}return e}}var S,I=i(68909);!function(e){e[e.WAITING=0]="WAITING",e[e.WAITINGTOEXCEEDTHRESHOLD=1]="WAITINGTOEXCEEDTHRESHOLD",e[e.GESTURING=2]="GESTURING"}(S||(S={}));const E=.04;var N=i(42311);class D{constructor(e=.04,t=300){this.dragLimit=e,this.holdLimit=t,this.startPosition=new I.Vector2,this.pointerDelta=new I.Vector2,this.activeButtons=o.O.NONE,this.state=S.WAITING}start(e){if(this.state===S.WAITING&&this.startPosition.copy(e.position),e.buttons&e.buttons-1){if(this.activeButtons)return this.state=S.GESTURING,new N.Ds(e.position,this.activeButtons)}else this.startTime=Date.now(),this.activeButtons=e.buttons,this.state=S.WAITINGTOEXCEEDTHRESHOLD}stop(){let e;return this.state===S.WAITINGTOEXCEEDTHRESHOLD&&Date.now()-this.startTime<this.holdLimit&&(e=new N.rX(this.startPosition.add(this.pointerDelta),d(this.activeButtons)),this.pointerDelta.set(0,0)),this.state=S.WAITING,e}onMove(e){if(this.state===S.WAITINGTOEXCEEDTHRESHOLD&&(this.pointerDelta.copy(e.position).sub(this.startPosition),this.pointerDelta.length()>this.dragLimit))return this.state=S.GESTURING,new N.Ds(e.position,e.buttons)}compareState(e){return e===this.state}}class C{constructor(e=.04){this.dragLimit=e,this.lastClick=null,this.lastClickButton=null,this.lastClickPosition={x:0,y:0}}checkForDoubleClick(e){const t=()=>{this.lastClick=performance.now(),this.lastClickButton=e.button,this.lastClickPosition.x=e.position.x,this.lastClickPosition.y=e.position.y};if(this.lastClick){const i=performance.now()-this.lastClick,n=this.lastClickPosition.x-e.position.x,s=this.lastClickPosition.y-e.position.y;if(!(i>500||n*n+s*s>this.dragLimit||e.button!==this.lastClickButton))return this.lastClick=null,new N.wR(e.position,e.button);t()}else t()}}var M=i(32981);class O{constructor(e,t=.04){this.onEventCallback=e,this.startPosition=new I.Vector2,this.previousPosition=new I.Vector2,this.pointerDelta=new I.Vector2,this.lastPointerMove=Date.now(),this.state=S.WAITING,this.pointerId=0,this.threshold=t,this.device=null}start(e){return this.state===S.WAITING&&(this.startPosition.copy(e.position),this.previousPosition.copy(this.startPosition),this.pointerDelta.set(0,0),this.state=S.WAITINGTOEXCEEDTHRESHOLD,this.device=e.device,this.pointerId=e.id,this.pointer=e),new M.SK(e.position,e.buttons,e.device,!!e.ctrlKey,e.id)}stop(){const e=(new I.Vector2).copy(this.previousPosition).sub(this.startPosition);this.state===S.GESTURING&&this.onEventCallback(new M.Ve(this.previousPosition,this.startPosition,e,this.pointer)),this.state===S.WAITING&&this.pointerDelta.set(0,0),this.state=S.WAITING;const t=Date.now()-this.lastPointerMove,i=this.device;if(this.device=null,!i)throw new Error("Cannot stop a drag gesture without a device that was tracked at the start");return new M._w(this.previousPosition,this.pointerDelta,o.O.NONE,t,e,i,this.pointerId)}onMove(e){let t;return this.state===S.WAITINGTOEXCEEDTHRESHOLD&&(this.pointerDelta.copy(e.position).sub(this.startPosition),this.pointerDelta.length()>this.threshold&&(this.state=S.GESTURING,this.onEventCallback(new M.Qm(this.startPosition,e)))),this.state===S.GESTURING&&(this.pointerDelta.copy(e.position).sub(this.previousPosition),this.device=e.device,this.pointerDelta.length()>0&&(t=new M.jF(this.previousPosition,this.pointerDelta,e.buttons,e.clientPosition,e.device,e.id))),this.previousPosition.copy(e.position),this.lastPointerMove=Date.now(),t}compareState(e){return e===this.state}compareStartPoint(e){return e.equals(this.startPosition)}compareDelta(e){return e.equals(this.pointerDelta)}}var _=i(13686);class A extends _.E{constructor(e){super(),this.scrollY=e}}class P{constructor(e,t,i=3){this.gutterScrollEnabled=e,this.canvas=t,this.threshold=i,this.state=S.WAITING}toggleTouchScrolling(e){this.gutterScrollEnabled=e}start(e){this.gutterScrollEnabled&&(0,v.b)(e.clientPosition.x,this.canvas)&&this.state===S.WAITING&&(this.startPosition=Object.assign({},e.clientPosition),this.previousY=e.clientPosition.y,this.state=S.WAITINGTOEXCEEDTHRESHOLD)}stop(){this.gutterScrollEnabled&&(this.state=S.WAITING)}onMove(e){if(!this.gutterScrollEnabled)return;const{x:t,y:i}=e.clientPosition,n=(0,v.b)(t,this.canvas);if(n&&this.state===S.WAITINGTOEXCEEDTHRESHOLD){const e=Math.abs(t-this.startPosition.x),n=Math.abs(i-this.startPosition.y);n>e&&n>this.threshold&&(this.state=S.GESTURING)}const s=i-this.previousY;if(this.previousY=i-s,n&&this.state===S.GESTURING)return new A(-s);!n&&[S.GESTURING,S.WAITINGTOEXCEEDTHRESHOLD].includes(this.state)&&(this.state=S.WAITING)}}var L=i(85239);class x{constructor(e=new I.Vector2,t=new I.Vector2,i=0){this.lastPosition=e,this.velocity=t,this.samePositionTicks=i}start(e){this.lastPosition.copy(e),this.velocity.set(0,0),this.samePositionTicks=0}update(e){if(this.lastPosition.distanceTo(e)<=.01){if(this.samePositionTicks++,this.samePositionTicks<2)return}else this.samePositionTicks=0;this.velocity.copy(this.lastPosition).sub(e),this.lastPosition.copy(e)}stationary(){return this.samePositionTicks>=2||this.velocity.length()<.01}}const R=2*Math.SQRT2;class V{constructor(e=.04){this.threshold=e,this.startDistance=0,this.previousDistance=0,this.pointerDelta=new I.Vector2,this.lastPointerMove=Date.now(),this.pinchDelta=0,this.state=S.WAITING,this.pointerMovement1=new x,this.pointerMovement2=new x}start(e,t){this.state===S.WAITING&&(this.restart(e,t),this.pointerMovement1.start(e.position),this.pointerMovement2.start(t.position))}stop(){this.state=S.WAITING;const e=Date.now()-this.lastPointerMove;return new L.g(this.pinchDelta,e)}onMove(e,t){this.pointerMovement1.update(e.position),this.pointerMovement2.update(t.position);if(!(this.pointerMovement1.stationary()||this.pointerMovement2.stationary()||this.pointerMovement1.velocity.dot(this.pointerMovement2.velocity)<0))return void this.restart(e,t);this.pointerDelta.copy(e.position).sub(t.position);const i=this.pointerDelta.length()/R;if(this.state===S.WAITINGTOEXCEEDTHRESHOLD){const e=i-this.startDistance;Math.abs(e)>this.threshold&&(this.state=S.GESTURING)}let n;if(this.state===S.GESTURING){const e=i-this.previousDistance;Math.abs(e)>0&&(this.pinchDelta=e,n=new L.l(e))}return this.previousDistance=i,this.lastPointerMove=Date.now(),n}restart(e,t){this.state=S.WAITINGTOEXCEEDTHRESHOLD,this.startDistance=e.position.distanceTo(t.position)/R,this.previousDistance=this.startDistance}}var U=i(43998),B=i(57090);class G{constructor(e=.1){this.startPointerDelta=new I.Vector2,this.previousPointerDelta=new I.Vector2,this.pointerDelta=new I.Vector2,this.lastPointerMove=Date.now(),this.angleWithDirection=0,this.state=S.WAITING,this.threshold=e}start(e,t){this.state===S.WAITING&&(this.state=S.WAITINGTOEXCEEDTHRESHOLD,this.startPointerDelta.copy(e.position).sub(t.position).normalize(),this.pointerDelta.copy(this.startPointerDelta),this.previousPointerDelta.copy(this.pointerDelta))}stop(){this.state=S.WAITING;const e=Date.now()-this.lastPointerMove;return new B.t(this.angleWithDirection,e)}onMove(e,t){if(this.pointerDelta.copy(e.position).sub(t.position).normalize(),this.state===S.WAITINGTOEXCEEDTHRESHOLD){Math.acos((0,U.qE)(this.pointerDelta.dot(this.startPointerDelta),-1,1))>this.threshold&&(this.state=S.GESTURING)}let i;if(this.state===S.GESTURING){const e=Math.acos((0,U.qE)(this.pointerDelta.dot(this.previousPointerDelta),-1,1));if(e>0){const t=this.previousPointerDelta.x*this.pointerDelta.y-this.previousPointerDelta.y*this.pointerDelta.x;this.angleWithDirection=t>=0?e:-e,i=new B.K(this.angleWithDirection)}}return this.previousPointerDelta.copy(this.pointerDelta),this.lastPointerMove=Date.now(),i}compareState(e){return e===this.state}}const F=function(e,t){if(t.setLength(0),0===e.length)return t;let i=0;for(const n of e)t.add(n),i++;return t.divideScalar(i),t};var j=i(53312);class H{constructor(e=.04){this.startEpicenter=new I.Vector2,this.previousEpicenter=new I.Vector2,this.deltaEpicenter=new I.Vector2,this.currentEpicenter=new I.Vector2,this.pointerCount=0,this.lastPointerMove=Date.now(),this.state=S.WAITING,this.pointerMovements=[],this.threshold=e}start(e){this.state===S.WAITING&&(this.restart(e),this.pointerMovements=e.map((e=>new x)),e.forEach(((e,t)=>{this.pointerMovements[t].start(e.position)})))}stop(){this.state=S.WAITING;const e=this.pointerCount;this.pointerCount=0;const t=Date.now()-this.lastPointerMove;return new j.x(e,this.currentEpicenter,this.deltaEpicenter,t)}onMove(e){F(this.getPointerPositions(e),this.currentEpicenter),e.forEach(((e,t)=>{this.pointerMovements[t].update(e.position)}));if(this.pointerMovements.find((e=>e.stationary())))return void this.restart(e);const t=this.pointerMovements[0].velocity;if(this.pointerMovements.find((e=>t.dot(e.velocity)<0)))return void this.restart(e);if(this.state===S.WAITINGTOEXCEEDTHRESHOLD){this.currentEpicenter.distanceTo(this.startEpicenter)>this.threshold&&(this.state=S.GESTURING)}let i;return this.state===S.GESTURING&&(this.deltaEpicenter.copy(this.currentEpicenter).sub(this.previousEpicenter),i=new j.C(e.length,this.currentEpicenter,this.deltaEpicenter)),this.previousEpicenter.copy(this.currentEpicenter),this.lastPointerMove=Date.now(),i}getPointerPositions(e){return e.map((e=>e.position))}restart(e){F(this.getPointerPositions(e),this.startEpicenter),this.previousEpicenter.copy(this.startEpicenter),this.currentEpicenter.copy(this.previousEpicenter),this.state=S.WAITINGTOEXCEEDTHRESHOLD,this.pointerCount=e.length}}var $=i(46464),z=i(74568);const W=new(i(35652).Ay)("longpress");var K;!function(e){e[e.IDLE=0]="IDLE",e[e.WAITING=1]="WAITING",e[e.STARTED=2]="STARTED",e[e.SUCCESSFUL=3]="SUCCESSFUL"}(K||(K={}));class X{constructor(e,t=500){this.onEventCallback=e,this.state=K.IDLE,this.ndcStartPosition=new I.Vector2,this.pointerDelta=new I.Vector2,this.ndcPosition=new I.Vector2,this.clientPosition=new I.Vector2,this.pressConfirmThreshold=this.pressStartThreshold=Math.max(t,1e-4)}start(e){this.state!==K.IDLE&&this.stop(),this.state===K.IDLE&&(e.buttons&e.buttons-1||(this.ndcStartPosition.copy(e.position),this.state=K.WAITING,this.buttons=e.buttons,this.pointerDelta.set(0,0),this.ndcPosition.copy(e.position),this.clientPosition.copy(e.clientPosition),this.holdTimeout=window.setTimeout((()=>{this.state=K.STARTED,W.debug("STARTED"),this.startTime=Date.now(),this.progress(0),this.onEventCallback(new z.OR(e.position,e.clientPosition,e.buttons)),this.successTimeout=window.setTimeout((()=>{W.debug("SUCCESSFUL"),this.state=K.SUCCESSFUL,this.progress(1),this.onEventCallback(new z.Zl(this.ndcPosition,this.clientPosition))}),this.pressConfirmThreshold)}),this.pressStartThreshold)))}stop(){const e=this.state;if(this.state=K.IDLE,window.clearTimeout(this.holdTimeout),window.clearTimeout(this.successTimeout),e>K.WAITING){W.debug("DONE, cancelled:",e<K.SUCCESSFUL);const t=e<K.SUCCESSFUL;this.onEventCallback(new z.vp(this.ndcPosition,this.clientPosition,t))}}onMove(e){const t=this.state===K.STARTED||this.state===K.WAITING,i=this.state===K.STARTED||this.state===K.SUCCESSFUL;(t||i)&&(this.ndcPosition.copy(e.position),this.clientPosition.copy(e.clientPosition),this.pointerDelta.copy(this.ndcPosition).sub(this.ndcStartPosition)),t&&this.pointerDelta.length()>.1?this.stop():i&&this.onEventCallback(new z.v3(this.ndcPosition,this.clientPosition,this.pointerDelta,this.buttons))}tick(){if(this.state===K.STARTED){const e=1-(this.pressStartThreshold-(Date.now()-this.startTime))/this.pressStartThreshold;this.progress(Math.min(1,e))}}progress(e){this.onEventCallback(new z.v0(this.ndcPosition,this.clientPosition,this.pointerDelta,this.buttons,e))}}var q=i(8423),Y=i(80328);class Q{constructor(){this.displayTouches=!1,this.touches=new Map}async init(e){const[t]=await Promise.all([e.getModuleBySymbol(Y.ZF)]);t.registerMenuButton({header:"Input",buttonName:"Toggle pointer visualization",callback:()=>{this.displayTouches=!this.displayTouches}})}addPointer(e,t){this.displayTouches&&(this.touches.set(e,this.createPointer(t)),this.movePointer(e,t))}removePointer(e){const t=this.touches.get(e);t&&(document.body.removeChild(t),this.touches.delete(e))}movePointer(e,t){const i=this.touches.get(e);i&&(i.style.left=t.x-25+"px",i.style.top=t.y-25+"px")}createPointer(e){const t=document.createElement("div");return t.style.position="fixed",t.style.backgroundColor="#aa11aa",t.style.width="50px",t.style.height="50px",t.style.zIndex="99999",t.style.pointerEvents="none",t.style.touchAction="none",t.style.borderRadius="50px",document.body.appendChild(t),t}}var Z,J=i(35223);!function(e){e[e.NONE=0]="NONE",e[e.CLICK_DRAG_LONGPRESS=1]="CLICK_DRAG_LONGPRESS",e[e.PINCH_ROTATE=2]="PINCH_ROTATE",e[e.MULTI_SWIPE_ONLY=3]="MULTI_SWIPE_ONLY"}(Z||(Z={}));class ee{constructor(){this.activeGesture=Z.NONE,this.pointers=[],this.couldBeClick=!1,this.isScrolling=!1,this.bindings=[],this.config={}}async init(e,t,i){this.config=e,this.onEventCallback=t;const n=await i.getModuleBySymbol(J.CE);this.clicker=new D(e.dragThreshold),this.doubleClicker=new C(e.dragThreshold),this.longPress=new X(t,e.holdThreshold),this.dragger=new O(t,e.dragThreshold),this.pincher=new V(e.pinchThreshold),this.rotater=new G(e.rotateThreshold),this.multiswiper=new H(e.dragThreshold);const s=(0,m.al)()&&(0,m.C8)();this.scroller=new P(s,n.element,e.scrollThreshold),e.disableWheel||this.bindWheelHandlers(n.element),this.inputDebug=new Q,this.inputDebug.init(i)}dispose(){for(const e of this.bindings)null==e||e.cancel();this.bindings=[]}setDragThreshold(e){var t;const i=null!==(t=null!=e?e:this.config.dragThreshold)&&void 0!==t?t:E;this.dragger.threshold=i,this.clicker.dragLimit=i,this.doubleClicker.dragLimit=i}get activePointers(){return this.pointers.length}onPointerChange(e){this.isMoveEvent(e)?this.onPointerMove(e):this.onPointerButton(e)}toggleTouchScrolling(e){this.scroller.toggleTouchScrolling(e)}isMoveEvent(e){return!e.hasOwnProperty("down")}onPointerMove(e){this.movePointer(e),this.inputDebug.movePointer(e.id,e.clientPosition)}onPointerButton(e){e.down?(this.addPointer(e),this.inputDebug.addPointer(e.id,e.clientPosition)):(this.removePointer(e),this.inputDebug.removePointer(e.id))}bindWheelHandlers(e){this.bindings.push(new p.w(e,"wheel",(t=>{(0,m.al)()&&(0,v.b)(t.clientX,e)||(t.preventDefault(),this.onEventCallback(new $.s({x:t.clientX,y:t.clientY},{x:this.normalizeWheelDelta(t.deltaMode,t.deltaX),y:this.normalizeWheelDelta(t.deltaMode,t.deltaY)})))})))}normalizeWheelDelta(e,t){if(e===WheelEvent.DOM_DELTA_LINE){return.7*t*t*t+13*t}return t}addPointer(e){const{id:t,button:i,position:n,clientPosition:s,device:a}=e,o=r(i);if(!o)return;const d=this.getPointer(t);!d||d.buttons&o?this.pointers.push({id:t,position:new I.Vector2(n.x,n.y),clientPosition:new I.Vector2(s.x,s.y),buttons:o,activeButtons:1,device:a,ctrlKey:e.nativeEvent.ctrlKey}):(d.buttons|=o,d.activeButtons++,d.device=a),this.toggleGestures(e)}removePointer(e){const{id:t,button:i}=e,n=r(i);if(!n)return;const s=this.getPointerIndex(t);if(-1!==s){const t=this.pointers[s];t.buttons&n&&(t.buttons&=~n,t.activeButtons--),t.activeButtons||this.pointers.splice(s,1),this.toggleGestures(e)}}movePointer(e){const{id:t,position:i,clientPosition:n,buttons:s}=e,a=this.getPointer(t);if(a)switch(a.position.copy(i),a.clientPosition.copy(n),a.buttons!==s?this.updateOffscreenPointer(a,e):this.onEventCallback(new q.H(this.pointers)),this.activeGesture){case Z.CLICK_DRAG_LONGPRESS:const e=this.scroller.onMove(a);this.isScrolling=!!e;const t=this.clicker.onMove(a);t&&this.onEventCallback(t);const i=this.dragger.onMove(a);i&&!this.isScrolling&&this.onEventCallback(i),this.longPress.onMove(a);break;case Z.PINCH_ROTATE:const n=this.pincher.onMove(this.pointers[0],this.pointers[1]),s=this.rotater.onMove(this.pointers[0],this.pointers[1]);n&&this.onEventCallback(n),s&&this.onEventCallback(s);case Z.MULTI_SWIPE_ONLY:const o=this.multiswiper.onMove(this.pointers);o&&this.onEventCallback(o)}}getPointer(e){const t=this.getPointerIndex(e);if(-1!==t)return this.pointers[t]}toggleGestures(e){this.onEventCallback(new q.H(this.pointers));const t=this.activeGesture;if(this.activeGesture=this.pointers.length,t===Z.CLICK_DRAG_LONGPRESS&&this.activeGesture===Z.NONE&&this.couldBeClick){const e=this.clicker.stop();if(e&&!this.isScrolling){this.onEventCallback(e);const t=this.doubleClicker.checkForDoubleClick(e);t&&this.onEventCallback(t)}}if(this.couldBeClick=t===Z.NONE&&this.activeGesture===Z.CLICK_DRAG_LONGPRESS,this.activeGesture===Z.CLICK_DRAG_LONGPRESS){const t=this.clicker.start(this.pointers[0]);if(t&&this.onEventCallback(t),!e.defaultPrevented){this.scroller.start(this.pointers[0]);const e=this.dragger.start(this.pointers[0]);e&&this.onEventCallback(e),this.longPress.start(this.pointers[0])}}else if(t===Z.CLICK_DRAG_LONGPRESS){const e=this.dragger.stop();this.scroller.stop(),this.isScrolling=!1,this.longPress.stop(),this.onEventCallback(e)}this.activeGesture===Z.PINCH_ROTATE?(this.pincher.start(this.pointers[0],this.pointers[1]),this.rotater.start(this.pointers[0],this.pointers[1]),this.multiswiper.start(this.pointers)):t===Z.PINCH_ROTATE&&(this.onEventCallback(this.pincher.stop()),this.onEventCallback(this.rotater.stop()),this.onEventCallback(this.multiswiper.stop())),this.activeGesture===Z.MULTI_SWIPE_ONLY?this.multiswiper.start(this.pointers):t===Z.MULTI_SWIPE_ONLY&&this.onEventCallback(this.multiswiper.stop())}getPointerIndex(e){for(let t=0;t<this.pointers.length;t++){if(this.pointers[t].id===e)return t}return-1}updateOffscreenPointer(e,t){if(e.buttons=t.buttons,0===t.buttons){const i=this.getPointerIndex(e.id);this.pointers.splice(i,1),this.toggleGestures(t)}}tick(){this.longPress.tick()}}var te=i(62569),ie=i(2785),ne=i(53366),se=i(18461);class ae{constructor(e,t,i){this._renew=e,this._cancel=t,this.active=i}renew(){this.active()||this._renew()}cancel(){this.active()&&this._cancel()}}class oe extends n.n{constructor(){super(...arguments),this.name="input-ini",this.fallbackHandlerMap={},this.meshHandlerMap={},this.priorityHandlerMap={},this.unfilteredHandlerMap={},this.captureHandlerMap={},this.gesturing=!1,this.gestureCapture=new te.A((e=>e.object.id)),this.activeIntersections=new te.A((e=>e.object.id)),this.eventTypeLookup=new s.b0,this.meshTypeLookup=new s.b0,this.hoveredMesh={object:null,instanceId:void 0,index:void 0},this.registerUnfilteredHandler=(e,t)=>{this.insertHandler(e,this.unfilteredHandlerMap,t);const i=this.eventTypeLookup.getKeyByType(e);return new ae((()=>this.registerUnfilteredHandler(e,t)),(()=>this.unregisterUnfilteredHandler(e,t)),(()=>-1!==this.unfilteredHandlerMap[i].indexOf(t)))},this.registerMesh=(e,t,i)=>{this.raycaster.targets.addTarget(e,t,i)},this.unregisterMesh=e=>{this.raycaster.targets.removeTarget(e)},this.onPointerEvent=e=>{const t=!e.hasOwnProperty("down"),i=!t&&e.down,n=!i&&!t;this.raycaster.pointer.updatePointer(e.position),this.activeIntersections.clear();for(const e of this.raycaster.pointer.cast())this.activeIntersections.add(e);if(t||i){if(!this.gesturing){this.gestureCapture.clear();for(const e of this.activeIntersections)this.gestureCapture.add(e);this.updateHoveredMesh(e)}i&&(this.gesturing=!0),this.onEvent(e)}n&&this.onEvent(e),this.inputGesture.onPointerChange(e),0===this.inputGesture.activePointers&&(this.activeIntersections.clear(),this.gestureCapture.clear(),this.gesturing&&this.updateHoveredMesh(e),this.gesturing=!1)},this.onEvent=e=>{const t=this.eventTypeLookup.getKeyByInstance(e),i=this.captureHandlerMap[t];if(i&&i.length>0){for(const t of i)t(e);return void(i.length=0)}const n=this.unfilteredHandlerMap[t];if(n)for(const t of n)t(e);const s=this.iterateMeshCallbacks(e,this.gesturing?this.gestureCapture:this.activeIntersections),a=this.fallbackHandlerMap[t];if(!s&&a)for(const t of a)t(e)}}async init(e,t){const i={disableWheel:!!e.disableWheel},n=(0,m.al)()&&(0,m.C8)();this.bindings.push(t.commandBinder.addBinding(se.R,(async()=>{n&&(this.inputGesture.toggleTouchScrolling(!0),this.inputPointer.toggleTouchScrolling(!0))})),t.commandBinder.addBinding(se.W,(async()=>{n&&(this.inputGesture.toggleTouchScrolling(!1),this.inputPointer.toggleTouchScrolling(!1))})));const s=await t.getModuleBySymbol(J.CE),a=await t.market.waitForData(ne.p);this.raycaster=await t.getModuleBySymbol(J.sA),this.inputPointer=new g({pointerPreventDefault:e.pointerPreventDefault},s.element,a,this.onPointerEvent,n),this.keyboardState=new T(e.rootNode,this.onEvent),this.inputGesture=new ee,this.inputGesture.init(i,this.onEvent,t)}overrideDragThreshold(e){this.inputGesture.setDragThreshold(e)}dispose(e){super.dispose(e),this.inputPointer.dispose(),this.keyboardState.dispose(),this.inputGesture.dispose()}registerHandler(e,t){this.insertHandler(e,this.fallbackHandlerMap,t);const i=this.eventTypeLookup.getKeyByType(e,!0);return new ae((()=>this.registerHandler(e,t)),(()=>this.unregisterHandler(e,t)),(()=>-1!==this.fallbackHandlerMap[i].indexOf(t)))}unregisterHandler(e,t){this.removeHandler(e,this.fallbackHandlerMap,t)}registerMeshHandler(e,t,i,n){return this._registerMeshHandler(e,{comparator:t,callback:i,default:null==n?void 0:n.default})}_registerMeshHandler(e,t){var i;const n=this.eventTypeLookup.getKeyByType(e,!0);this.meshHandlerMap[n]||(this.meshHandlerMap[n]=[]);const s=this.meshHandlerMap[n];let a=s.length;if(!t.default)for(;null===(i=s[a-1])||void 0===i?void 0:i.default;)a--;return s.splice(a,0,t),new ae((()=>this._registerMeshHandler(e,t)),(()=>this.unregisterMeshHandler(e,t)),(()=>-1!==s.indexOf(t)))}unregisterMeshHandler(e,t){const i=this.eventTypeLookup.getKeyByType(e,!0);if(this.meshHandlerMap[i]){const e=this.meshHandlerMap[i],n=e.indexOf(t);n>-1&&e.splice(n,1)}}registerPriorityHandler(e,t,i){const n=this.eventTypeLookup.getKeyByType(e,!0),a=this.meshTypeLookup.getKeyByType(t,!0);this.priorityHandlerMap[n]||(this.priorityHandlerMap[n]={});const o=this.priorityHandlerMap[n];if(o[a]){const i=(0,s.Uz)(e),n=(0,s.Uz)(t);throw Error(`${i} already has a priority handler registered for mesh type: ${n}`)}return o[a]=i,new ae((()=>this.registerPriorityHandler(e,t,i)),(()=>this.unregisterPriorityHandler(e,t,i)),(()=>void 0!==o[a]))}unregisterPriorityHandler(e,t,i){const n=this.eventTypeLookup.getKeyByType(e),s=this.priorityHandlerMap[n];if(s){const e=this.meshTypeLookup.getKeyByType(t),n=s[e];n&&i===n&&delete s[e]}}unregisterUnfilteredHandler(e,t){this.removeHandler(e,this.unfilteredHandlerMap,t)}captureNext(e,t){return this.insertHandler(e,this.captureHandlerMap,t),t}removeCaptureHandler(e,t){this.removeHandler(e,this.captureHandlerMap,t)}registerSnappingMeshGeometry(e,t,i,n){this.raycaster.snapping.addMeshGeometry(e,t,i,n)}unregisterSnappingMeshGeometry(e){this.raycaster.snapping.removeMeshGeometry(e)}getCurrentPointerRay(){return this.raycaster.pointer.pointerRay.clone()}getCurrentRayHits(){return this.activeIntersections.copyToList([])}updateHoveredMesh(e){const t=this.activeIntersections.getByIndex(0),i=t&&t.object===this.hoveredMesh.object&&t.instanceId===this.hoveredMesh.instanceId&&t.index===this.hoveredMesh.index;let n=!1;if(this.hoveredMesh.object&&(void 0===t||!i)){const i=this.getMeshHandler(ie.q,(0,s.Pw)(this.hoveredMesh.object),this.priorityHandlerMap);if(i&&(n=i(new ie.q(e.nativeEvent),this.hoveredMesh.object,t)||!1),!n){const i=this.meshHandlerMap[this.eventTypeLookup.getKeyByType(ie.q)];if(i)for(const n of i)n.comparator.compare(this.hoveredMesh.object)&&n.callback(new ie.q(e.nativeEvent),this.hoveredMesh.object,t)}}let a=!1;if(t&&!i){const i=this.getMeshHandler(ie.L,(0,s.Pw)(t.object),this.priorityHandlerMap);if(i&&(a=i(new ie.L(e.nativeEvent),t.object,t)||!1),!a){const i=this.meshHandlerMap[this.eventTypeLookup.getKeyByType(ie.L)];if(i)for(const n of i)n.comparator.compare(t.object)&&n.callback(new ie.L(e.nativeEvent),t.object,t)}}this.hoveredMesh.object=t&&t.object||null,this.hoveredMesh.instanceId=null==t?void 0:t.instanceId,this.hoveredMesh.index=null==t?void 0:t.index}iterateMeshCallbacks(e,t){let i=!1;const n=this.eventTypeLookup.getKeyByInstance(e);for(let s=0;s<t.count();s++){const a=t.getByIndex(s);if(!a)continue;if(i)break;const o=a.object,r=this.activeIntersections.get(o.id)||a;for(const t in this.priorityHandlerMap[n])if(a.object instanceof this.meshTypeLookup.getTypeByKey(t)){const s=this.priorityHandlerMap[n]&&this.priorityHandlerMap[n][t];if(s&&(i=!0,s(e,o,r)||e.propagationStopped))return!0}const d=this.meshHandlerMap[n];if(d)for(const t of d)if(t.comparator.compare(o)&&(!t.default||!e.defaultPrevented)){const n=t.callback(e,o,r);(n||void 0===n||e.propagationStopped)&&(i=!0)}}return i}insertHandler(e,t,i){const n=this.eventTypeLookup.getKeyByType(e,!0);t[n]||(t[n]=[]),t[n].push(i)}removeHandler(e,t,i){const n=t[this.eventTypeLookup.getKeyByType(e)];if(n)for(let e=0;e<n.length;e++)if(n[e]===i){n.splice(e,1);break}}getMeshHandler(e,t,i){const n=i[this.eventTypeLookup.getKeyByType(e)];if(n){return n[this.meshTypeLookup.getKeyByType(t)]}return null}onUpdate(){this.inputGesture.tick()}}},44239:(e,t,i)=>{"use strict";i.r(t),i.d(t,{LayersModule:()=>V,default:()=>U});var n=i(23205),s=i(35223),a=i(2789),o=i(58838),r=i(28997),d=i(38398),l=i(24563),c=i(54244),h=i(66083),u=i(66931),m=i(23730),p=i(68340),v=i(84229);class g extends v.t{constructor(e,t="80001"){super(e),this.name="LayersViewError",this.code=t}}var y=i(33324),f=i(33848),w=i(82856),b=i(61334),k=i(9826),T=i(61373),S=i(10657),I=i(35652),E=i(50987),N=i(43066);const D=new I.Ay("MdsModelViewStore");class C extends S.g{constructor(e){super(e),this.prefetchKey=l.l9,this.deserializer=new E.K}async read(e){var t,i;if(!this.viewId)throw new T.V("Cannot read Views, no initial view configured");const n=null===(i=null===(t=(await this.query(N.GetViews,{modelId:this.viewId},e).catch((e=>{throw new T.tW(e)}))).data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.views,s=[];if(n)for(const e of n){const t=this.deserializer.deserialize(e);t&&s.push(t)}return s.sort(((e,t)=>e.created.getTime()-t.created.getTime())),s}async readView(e){var t,i;const n=null===(i=null===(t=(await this.query(N.GetView,{viewId:e}).catch((e=>{throw new T.tW(e)}))).data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.views;if(!n||1!==n.length)throw new T.V("GetView failed");const s=this.deserializer.deserialize(n[0]);if(!s)throw new T.V("Cannot read view");return s}async create(e){const t=this.getBaseViewId();return this.mutate(N.AddUserView,{modelId:t,name:e}).then((e=>{var t;return this.deserializer.deserialize(null===(t=e.data)||void 0===t?void 0:t.addView)}))}async delete(e,t){var i;const n=this.getBaseViewId();if(e===n)throw new T.V("Cannot delete the base view");const s=!!(null===(i=(await this.mutate(N.DeleteView,{modelId:n,viewId:e,deleteLayersIfOrphaned:t})).data)||void 0===i?void 0:i.deleteView);return s||D.error("View deletion failed!"),s}async copyItemsToLayer(e,t,i){var n;const s=!!(null===(n=(await this.mutate(N.CopyViewDataToLayer,{viewId:e,layerId:t,copyDataFrom:i})).data)||void 0===n?void 0:n.copyViewData);return s||D.error("CopyViewData failed!"),s}async moveItemsToLayer(e,t,i){var n;const s=!!(null===(n=(await this.mutate(N.MoveViewDataToLayer,{viewId:e,layerId:t,viewSelections:i})).data)||void 0===n?void 0:n.moveViewData);return s||D.error("MoveViewDataToLayer failed!"),s}async deleteItemsFromView(e,t){var i;if(t.find((e=>!e.ids||0===e.ids.length)))return D.error("deleteItemsFromView fails without list of ids"),!1;const n=!!(null===(i=(await this.mutate(N.DeleteFromView,{viewId:e,viewSelections:t})).data)||void 0===i?void 0:i.deleteFromView);return n||D.error("DeleteFromView failed!"),n}async rename(e,t){var i,n;const s=null===(n=null===(i=(await this.mutate(N.RenameView,{viewId:e,name:t})).data)||void 0===i?void 0:i.patchView)||void 0===n?void 0:n.name;if(null==s)throw new T.YA("Unable to rename view!");return s}async setEnabled(e,t){var i,n;const s=null===(n=null===(i=(await this.mutate(N.SetViewEnabled,{viewId:e,enabled:t})).data)||void 0===i?void 0:i.patchView)||void 0===n?void 0:n.enabled;if(null==s)throw new T.YA("Unable to enable/disable view!");return s}async convertModelToLayered(e){var t;const i=null===(t=(await this.mutate(N.ConvertRootViewToLayered,{modelId:e})).data)||void 0===t?void 0:t.convertRootViewToLayered;if(null==i)throw new T.YA("Unable to convert model to layered!");const n=this.deserializer.deserialize(i);if(!n)throw new T.V("Cannot read converted view");return n}async convertModelToLegacy(e){var t;const i=null===(t=(await this.mutate(N.ConvertRootViewToLegacy,{modelId:e})).data)||void 0===t?void 0:t.convertRootViewToLegacy;if(null==i)throw new T.YA("Unable to convert model to legacy!");const n=this.deserializer.deserialize(i);if(!n)throw new T.V("Cannot read converted view");return n}async duplicate(e,t,i,n){var s;const a=await this.mutate(N.DuplicateView,{modelId:e,viewId:t,name:i,enabled:n});return this.deserializer.deserialize(null===(s=a.data)||void 0===s?void 0:s.addView)}async hasWorkshopChanges(e){var t,i,n;const s=null===(n=null===(i=null===(t=(await this.client.query(N.GetMergeDiff,{viewId:e}).catch((e=>{throw new T.tW(e)}))).data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.mergeDiff)||void 0===n?void 0:n.typesModified;return!!s&&s.length>0}}var M=i(92646),O=i(32538);class _ extends S.g{constructor(){super(...arguments),this.deserializer=new O.F,this.prefetchKey="data.view.layers"}async read(){return this.readLayersForView(this.getViewId())}async readLayersForView(e,t=!0){var i,n;const s={viewId:e,modelId:e},a={prefetchKey:t?this.prefetchKey:void 0,fetchPolicy:t?"cache-first":"no-cache"},o=null===(n=null===(i=(await this.query(M.GetLayers,s,a).catch((e=>{throw new T.tW(e)}))).data)||void 0===i?void 0:i.view)||void 0===n?void 0:n.layers;if(!o)throw new Error("No layers to read for view!");const r=[];for(const e of o){const t=this.deserializer.deserialize(e);t&&r.push(t)}return r}async addLayer(e,t,i,n,s=!0){var a,o;const r={viewId:this.getViewId(),label:e,writable:t,position:i,copyDataFrom:n,generateIds:s},d=null===(o=null===(a=(await this.mutate(M.AddLayer,r).catch((e=>{throw new T.YA(e)}))).data)||void 0===a?void 0:a.layer)||void 0===o?void 0:o.id;if(!d)throw new Error("Unable to get id for new layer");return d}async addCommonLayer(e,t){var i,n;const s={viewId:this.getViewId(),label:e,position:t},a=null===(n=null===(i=(await this.mutate(M.AddCommonLayer,s).catch((e=>{throw new T.YA(e)}))).data)||void 0===i?void 0:i.layer)||void 0===n?void 0:n.id;if(!a)throw new Error("Unable to get id for new common layer");return await this.refresh(),a}async duplicateLayer(e,t,i){var n,s;const a={viewId:this.getViewId(),label:e,visible:t,copyDataFrom:i},o=null===(s=null===(n=(await this.mutate(M.DuplicateLayer,a).catch((e=>{throw new T.YA(e)}))).data)||void 0===n?void 0:n.layer)||void 0===s?void 0:s.id;if(!o)throw new Error("Unable to duplicate layer");return await this.refresh(),o}async convertLayerToCommon(e,t,i){var n,s;const a={viewId:this.getViewId(),layerId:e,visible:t,position:i};if(!(null===(s=null===(n=(await this.mutate(M.ConvertToCommonLayer,a).catch((e=>{throw new T.YA(e)}))).data)||void 0===n?void 0:n.convertToCommonLayer)||void 0===s?void 0:s.id))throw new Error("Unable to convert layer to common");await this.refresh()}async convertLayerToDedicated(e){var t,i;const n={viewId:this.getViewId(),layerId:e};if(!(null===(i=null===(t=(await this.mutate(M.ConvertToDedicatedLayer,n).catch((e=>{throw new T.YA(e)}))).data)||void 0===t?void 0:t.convertToDedicatedLayer)||void 0===i?void 0:i.id))throw new Error("Unable to convert layer to dedicated");await this.refresh()}async patchLayer(e,t,i,n,s){var a,o;const r={viewId:this.getViewId(),layerId:e,layerLabel:t,writable:i,position:n,visible:s};if(!(null===(o=null===(a=(await this.mutate(M.PatchLayer,r).catch((e=>{throw new T.YA(e)}))).data)||void 0===a?void 0:a.patchLayer)||void 0===o?void 0:o.id))throw new Error("No data returned by patch");null===i&&null===n&&null===s||await this.refresh()}async patchLayerViews(e,t,i,n){var s,a;const o=t.map((e=>({viewId:e,visible:i,remove:n}))),r={viewId:this.getViewId(),layerId:e,views:o};if(!(null===(a=null===(s=(await this.mutate(M.PatchLayerViews,r).catch((e=>{throw new T.YA(e)}))).data)||void 0===s?void 0:s.patchLayerViews)||void 0===a?void 0:a.id))throw new Error("No data returned by patchLayerViews");await this.refresh()}async deleteLayer(e){const t={viewId:this.getViewId(),layerId:e};await this.mutate(M.DeleteLayer,t).catch((e=>{throw new T.YA(e)}))}async convertToProxiedLayering(){const e={modelId:this.getBaseViewId()};await this.mutate(M.ConvertToProxiedLayering,e)}}var A=i(76445),P=i(9026),L=i(80379),x=i(26325),R=i(95149);class V extends n.n{constructor(){super(...arguments),this.name="layers",this.viewChangeConfirmers=[],this.duplicateHelpers=new Set,this.onHistoryPop=()=>{if(this.data.getCurrentView().viewType===w.jK.SESSION)return;const e=(0,R.DE)(),t=e.get("m")||e.get("model");t&&t!==this.data.currentViewId&&this.setActiveModelView(t)},this.layerModelAndUpdate=this.modifyInsideSaveCommand((()=>{let e;return async()=>{e||(e=new Promise((async e=>{const t=this.data.getBaseModelView();if(t&&!(0,f.r0)(t)){const e=await this.viewStore.convertModelToLayered(t.id),i=await this.layerStore.readLayersForView(this.data.getBaseModelId(),!1);this.updateViewDetails(t,e),t.layers.replace(i)}e()}))),await e}})()),this.checkForProxyLayer=this.modifyInsideSaveCommand((async()=>{if(this.data.isWorkshopSessionView())throw new Error("Workshop session view not supported!");const e=this.data.getBaseModelView();if(!e)return;if(!this.data.getProxyLayerId()){await this.layerStore.convertToProxiedLayering();const t=await this.layerStore.readLayersForView(this.data.getBaseModelId(),!1);if(!e)throw new Error("Expected base view when converting to proxied layer!!");e.layers.replace(t);const i=this.data.getCurrentView();if(i!==e){const e=await this.layerStore.readLayersForView(i.id,!1);i.layers.replace(e)}}}))}async init(e,t){var i;const{baseUrl:n,readonly:s,viewId:d,mdsContext:c}=e,{commandBinder:h,market:u}=t,[p,v]=await Promise.all([t.market.waitForData(r.o),t.market.waitForData(o.L)]);this.data=new b.P(c,new k.j({id:d})),this.settingsData=p,this.config=e,this.viewStore=new C({context:c,readonly:s,baseUrl:n,viewId:d}),this.engine=t,await this.loadViews();const g=await this.getInitialViewId(),f=g===(null===(i=this.data.getWorkshopSessionView())||void 0===i?void 0:i.id),T=(0,y.Tl)(v),S=!f&&this.isViewsPolicyEnabled(T);this.setViewsFeatureSetting(S);const I=!f&&this.isDataLayersPolicyEnabled(T);this.setLayersFeatureSetting(I),c.baseViewId=this.data.getBaseModelId(),this.layerStore=new _({context:c,readonly:s,baseUrl:n}),I&&this.layerStore.onNewData((async e=>{const t=e.filter((e=>e.layerType!==w.ku.WORKSHOP)).sort(((e,t)=>e.position-t.position));if(!t.length)throw new Error("No layers available!!");const i=this.data.getCurrentView(),n=i.layers.filter((e=>e.layerType===w.ku.IN_MEMORY));for(const e of n)t.push(e);i.layers.replace(t);const s=this.data.activeLayerId;if(!s||!t.find((e=>e.id===s))){const e=this.data.filterUserFacingLayers(t);this.data.setActiveCurrentLayer(e[0].id)}})),c.autoProvisionLayerCheckCallback=async e=>{this.data.getLayer(e)||await this.layerStore.refresh()},await this.setActiveModelView(g),this.updateMdsContext(),I||(this.data.setBaseLayerOnly(),this.data.setActiveCurrentLayer(l.qw)),window.addEventListener("popstate",this.onHistoryPop),this.config.readonly||(this.bindings.push(h.addBinding(m.FX,this.modifyInsideSaveCommand((()=>this.disableWorkshopSession()))),h.addBinding(m.xI,(()=>this.convertModelToLayered())),h.addBinding(m.KQ,(()=>this.checkForProxyLayer()))),S&&(this.editViewHandlers=new a.P(h.addBinding(m.Py,this.modifyInsideSaveCommand((e=>this.addUserView(e.name)))),h.addBinding(m.ie,this.modifyInsideSaveCommand((e=>this.deleteView(e.viewId)))),h.addBinding(m.Zl,this.modifyInsideSaveCommand((e=>this.renameView(e.viewId,e.name)))),h.addBinding(m.cf,this.modifyInsideSaveCommand((e=>this.setViewEnabled(e.viewId,e.enabled)))),h.addBinding(m.iM,this.modifyInsideSaveCommand((e=>this.duplicateView(e.viewId,e.name))))),S||this.editViewHandlers.cancel()),I&&(this.editLayerHandlers=new a.P(h.addBinding(m.ff,this.modifyInsideSaveCommand((e=>this.addLayer(e.label,e.common)))),h.addBinding(m.C6,this.modifyInsideSaveCommand((e=>this.duplicateLayer(e.layerId,e.label)))),h.addBinding(m.SG,this.modifyInsideSaveCommand((e=>this.deleteLayer(e.layerId)))),h.addBinding(m.i,this.modifyInsideSaveCommand((e=>this.toggleLayerAsCommon(e.layerId,e.common)))),h.addBinding(m.BC,this.modifyInsideSaveCommand((e=>this.toggleLayerVisible(e.layerId,e.visible)))),h.addBinding(m.nl,this.modifyInsideSaveCommand((e=>this.renameLayer(e.layerId,e.label)))),h.addBinding(m.ey,this.modifyInsideSaveCommand((e=>this.setLayerPosition(e.layerId,e.position)))),h.addBinding(m.jC,this.modifyInsideSaveCommand((e=>this.copyItemsToLayer(e.items,e.layerId)))),h.addBinding(m.B7,this.modifyInsideSaveCommand((e=>this.copyItemsToLayer(e.items,null,e.name)))),h.addBinding(m.pB,this.modifyInsideSaveCommand((e=>this.moveItemsToLayer(e.items,e.layerId)))),h.addBinding(m.wd,this.modifyInsideSaveCommand((e=>this.deleteItemsFromView(e.items))))),I||this.editLayerHandlers.cancel())),I&&this.bindings.push(h.addBinding(m.X_,(e=>this.toggleLayer(e.layerId,e.on)))),S&&I&&this.bindings.push(this.data.onPropertyChanged("currentViewId",(()=>this.updateMdsContext()))),this.bindings.push(h.addBinding(m.k,(async e=>this.addInMemoryLayer(e.layerProps))),h.addBinding(m.uo,(e=>this.setActiveModelView(e.viewId))),h.addBinding(m.SL,(async e=>this.registerConfirmViewChange(e.confirmViewChange))),h.addBinding(m.Xj,(async e=>this.duplicateHelpers.add(e))),h.addBinding(m.gq,(async e=>this.duplicateHelpers.delete(e))),h.addBinding(m.HA,(e=>this.selectLayer(e.layerId,e.selected)))),u.register(this,b.P,this.data);let E=this.onInMemoryLayerChanges();this.data.onPropertyChanged("currentViewId",(()=>{E&&E.cancel(),E=this.onInMemoryLayerChanges()}))}dispose(e){var t,i;super.dispose(e),null===(t=this.editViewHandlers)||void 0===t||t.cancel(),null===(i=this.editLayerHandlers)||void 0===i||i.cancel(),window.removeEventListener("popstate",this.onHistoryPop)}async getInitialViewId(){const{viewId:e,inWorkshop:t}=this.config,i=this.data.getBaseModelView();if(t&&i&&i.id===e&&!(0,f.r0)(i)){const e=this.data.getWorkshopSessionView();if(e&&e.enabled){if(await this.viewStore.hasWorkshopChanges(e.id))return e.id}}return e}isDataLayersPolicyEnabled(e){return[y.T5.LAYERS_ONLY,y.T5.VIEWS_AND_LAYERS].includes(e)}isViewsPolicyEnabled(e){return[y.T5.VIEWS_OPTIONAL_OPT_IN,y.T5.VIEWS_ENABLED,y.T5.VIEWS_AND_LAYERS].includes(e)}setViewsFeatureSetting(e){this.settingsData.setProperty(y.rX,e),this.engine.getModuleBySymbol(s.aF).then((t=>{t.trackFeatures(`${y.AH}:${e}`)}))}setLayersFeatureSetting(e){this.data.layersEnabled=e,this.data.commit(),this.settingsData.setProperty(y.qD,e),this.engine.getModuleBySymbol(s.aF).then((t=>{t.trackFeatures(`${y.H6}:${e}`)}))}async loadViews(){let e=await this.viewStore.read();if(!e.find((e=>e.id===this.config.viewId))){const t=await this.engine.getModuleBySymbol(s.qL),{loggedIn:i}=await t.getApi().user;i&&(e=await this.viewStore.read({anonymous:!1,fetchPolicy:"no-cache"}))}e.length>0&&(this.data.setViews(e),this.log.debug("Loaded views",e))}async setActiveModelView(e){const{currentViewId:t}=this.data;if(e===t||!await this.canChangeView())return;const i=this.data.getView(e);if(i){const e=t;this.log.debug(`Switching to view: ${i.id} (${i.viewType}), from: ${e}`),this.data.setCurrentView(i.id),await this.refreshView(i,e)}else this.log.warn(`Missing model view '${e}'`)}async refreshView(e,t){const{mdsContext:i}=this.config,n=this.settingsData.tryGetProperty(y.qD,!1),s=new A.B({baseUrl:this.config.baseUrl,prefetchPolicy:d.G.PRELOAD,query:P.GetModelViewPrefetch,variables:{modelId:e.id,includeDisabled:!this.config.readonly,includeLayers:n&&this.viewSupportsLayers()},mdsContext:this.data.mdsContext,anonymous:!this.config.inWorkshop,initialData:void 0});i.sharedCaches.add(s),await s.preload()?(n&&(this.layerStore.setStoreViewId(e.id),await this.layerStore.refresh()),await i.setCurrentViewId(e.id),this.updateBrowserOnViewChange(e),t?(i.sharedCaches.delete(s),this.engine.broadcast(new p.tj)):this.config.modulesLoadedPromise.then((()=>{i.sharedCaches.delete(s)}))):t&&this.data.setCurrentView(t);for(const e of this.data.commonInMemoryLayers)await e.applyTransactions();for(const t of e.layers)t.layerType===w.ku.IN_MEMORY&&await t.applyTransactions()}async canChangeView(){for(const e of this.viewChangeConfirmers)if(!await e())return!1;return!0}registerConfirmViewChange(e){this.viewChangeConfirmers.push(e)}updateBrowserOnViewChange(e){if(e.viewType===w.jK.SESSION)return;const t=(0,R.DE)(),i=t.get("m")||t.get("model");e.id!==i&&(t.has("model")?t.set("model",e.id):t.has("m")&&t.set("m",e.id),(0,R.KZ)(t.toString(),!0))}async disableWorkshopSession(){const e=this.data.getWorkshopSessionView();if(!e)return void this.log.debug("No Workshop Session View to disable.");if(!e.enabled)return;const t=await this.viewStore.setEnabled(e.id,!1);e.enabled=t,e.commit()}async addUserView(e){if(!this.data.validateViewName(e))throw new g("Invalid view name!");const t=await this.viewStore.create(e);t&&(this.data.addView(t),this.log.debug("Added new view"),await this.setActiveModelView(t.id))}async deleteView(e){if(!this.data.canDeleteView(e))throw new g("Cannot delete model view");const t=this.data.getView(e);if(!t)throw new g("Cannot delete missing view");const i=e===this.data.currentViewId,n=!(0,f.V6)(t);await this.viewStore.delete(e,n)&&this.data.atomic((()=>{if(this.data.deleteView(e),this.log.debug("Deleted user view"),i){const e=this.data.getBaseModelId();if(!e)throw new g("No base view");this.setActiveModelView(e)}}))}async copyItemsToLayer(e,t,i){const{currentViewId:n}=this.data,s={},a=[];e.forEach((e=>{if(e.supportsLayeredCopyMove()){s[e.typeId]||(s[e.typeId]=[]);const t=e.parentId||e.id;s[e.typeId].push(t),a.push(e)}}));const o=[];for(const e in s)o.push({viewId:n,type:e,ids:s[e]});let r;if(t)r=await this.viewStore.copyItemsToLayer(n,t,o);else{if(!i)throw new g("No layer id or name for copy");r=await this.addLayer(i,!1,o)}r&&(this.data.mdsContext.refreshLayeredStores(o.map((e=>e.type))),this.engine.broadcast(new p.NX(a)))}async moveItemsToLayer(e,t){const{currentViewId:i}=this.data,n={},s=[];e.forEach((e=>{if(e.supportsLayeredCopyMove()){n[e.typeId]||(n[e.typeId]=[]);const t=e.parentId||e.id;n[e.typeId].push(t),s.push(e)}}));const a=[];for(const e in n)a.push({type:e,ids:n[e],all:!1});await this.viewStore.moveItemsToLayer(i,t,a)&&(this.data.mdsContext.refreshLayeredStores(a.map((e=>e.type))),this.engine.broadcast(new p.NX(s)))}async deleteItemsFromView(e){if(!this.data.canBatchDeleteInActiveView())return void this.log.debug("Cannot batch delete items in non-layered model");const{currentViewId:t}=this.data,i={},n=[];e.forEach((e=>{if(e.supportsBatchDelete()){i[e.typeId]||(i[e.typeId]=[]);const t=e.parentId||e.id;i[e.typeId].push(t),n.push(e)}}));const s=[];for(const e in i)s.push({type:e,ids:i[e]});await this.viewStore.deleteItemsFromView(t,s)&&(this.data.mdsContext.refreshLayeredStores(s.map((e=>e.type))),this.engine.broadcast(new p.NX(n)))}getLayerTypesToDuplicate(){const e=[c.jM.LABEL,c.jM.MEASUREMENTPATH,c.jM.MATTERTAG];this.settingsData.tryGetProperty(h.nc,!1)&&e.push(c.jM.NOTE);return this.settingsData.tryGetProperty(u._H,!1)&&e.push(c.jM.OBJECTANNOTATION),e}async duplicateLayer(e,t){const i=this.data.getLayer(e);if(!i)throw new g("Unable to find layer to duplicate");const n=i.layerType===w.ku.BASE_LAYER,s=i.layerType===w.ku.VIEW_DATA_LAYER;if(n||s)return void this.log.debug("Duplicate not supported on base or view layer");const a=this.getLayerTypesToDuplicate(),o=this.data.getCurrentView().id,r=a.map((t=>({viewId:o,layerId:e,type:t})));await this.layerStore.duplicateLayer(t,i.visible,r)&&this.data.mdsContext.refreshLayeredStores(a)}async renameView(e,t){const i=this.data.getView(e);if(!i)throw new g("View does not exist");if(!this.data.validateViewName(t))throw new g("Invalid view name!");const n=await this.viewStore.rename(e,t);i.name=n,i.commit()}async setViewEnabled(e,t){const i=this.data.getView(e);if(!i)throw new g("View does not exist");if(!this.data.canDisableView(e))throw new g("Unable to enable/disable view");const n=await this.viewStore.setEnabled(e,t);i.enabled=n,i.commit()}async duplicateView(e,t){const i=this.data.getView(e);if(!i)throw new g("Cannot duplicate, view does not exist");if(!this.data.canDuplicateView(e))throw new g("Duplicate not supported on this view");const n=Array.from(this.duplicateHelpers.keys());await Promise.all(n.map((e=>e.beforeDuplicate())));const s=await this.viewStore.duplicate(this.data.getBaseModelId(),e,t,i.enabled);if(!s)throw new g("Unable to duplicate view!");this.data.addView(s),await this.setActiveModelView(s.id),await Promise.all(n.map((e=>e.afterDuplicate())))}viewSupportsLayers(){return this.data.getCurrentView().viewType!==w.jK.SESSION}updateMdsContext(){const e=this.viewSupportsLayers(),t=this.settingsData.tryGetProperty(y.qD,!1),i=this.data.isCurrentViewLayered();this.data.mdsContext.readLayerId=e;const n=e&&t&&i;this.data.mdsContext.toggleNonBaseLayeredWrites(n)}updateViewDetails(e,t){Object.assign(e,{viewType:t.viewType,rawViewType:t.rawViewType,name:t.name,enabled:t.enabled,modified:t.modified}),e.commit(),this.updateMdsContext()}async convertModelToLayered(){if(this.data.isWorkshopSessionView())return;const e=this.data.getBaseModelView();e&&!(0,f.r0)(e)&&await this.layerModelAndUpdate()}async addLayer(e,t,i=[]){let n;n=t?await this.layerStore.addCommonLayer(e,0):await this.layerStore.addLayer(e,!0,0,i);const s=this.data.getCurrentView();if((0,f.XF)(s)&&!(0,f.r0)(s)){const e=await this.viewStore.readView(s.id);this.updateViewDetails(s,e)}return await this.layerStore.refresh(),this.selectLayer(n,!0),this.engine.broadcast(new p.V7(n)),n}addInMemoryLayer(e){return this.data.addInMemoryLayer(e)}onInMemoryLayerChanges(){const e=this.data.getCurrentView(),t={onAdded:e=>{e.layerType===w.ku.IN_MEMORY&&e.applyTransactions()},onRemoved:t=>{t.layerType===w.ku.IN_MEMORY&&this.refreshView(e)}};return e.layers.onElementChanged(t)}async toggleLayerAsCommon(e,t){const i=this.data.getLayer(e);if(!i)throw new g("Unable to find layer to toggle common");t?await this.layerStore.convertLayerToCommon(e,i.visible,0):await this.layerStore.convertLayerToDedicated(e)}async toggleLayerVisible(e,t){const i=this.data.getLayer(e);if(!i)throw new g("Unable to find layer to toggle visibility");if(i.layerType===w.ku.COMMON_USER_LAYER){const i=this.data.getOrderedModelViews({includeInsights:!0}).map((e=>e.id));await this.layerStore.patchLayerViews(e,i,t)}else await this.layerStore.patchLayer(e,null,null,null,t)}async renameLayer(e,t){const i=this.data.getLayer(e);if(!i)throw new g("Unable to find layer to rename");await this.layerStore.patchLayer(e,t,null,null,null),i.name=t,i.commit()}async setLayerPosition(e,t){await this.layerStore.patchLayer(e,null,null,t,null)}async deleteLayer(e){if(!this.data.getLayer(e))throw new g("Unable to find layer to delete");await this.layerStore.deleteLayer(e),this.refreshView(this.data.getCurrentView())}async selectLayer(e,t){const i=this.data.getViewLayerId(),n=this.data.getBaseLayerId(),s=e===i||e===n,a=i||n;let o;if(t)o=s?a:e;else{if(s)throw new g("Cannot deselect a system layer!");o=a}if(!o)throw new g("No Active layer to set");o!==this.data.activeLayerId&&this.data.setActiveCurrentLayer(o)}async toggleLayer(e,t){this.data.toggleLayer(e,t)}modifyInsideSaveCommand(e){return async(...t)=>{await this.engine.commandBinder.issueCommand(new L.F({dataTypes:[x.p.LAYERS],onCallback:()=>e(...t),skipDirtyUpdate:!0}))}}}const U=V},77453:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>w});var n=i(96540),s=i(5338),a=i(23205),o=i(71294),r=i(74848),d=i(32485),l=i.n(d),c=i(99366);const h=i.p+"images/login-screen-background.jpg";var u=i(52385);const{INVITED_MESSAGE:m,CREATE_ACCOUNT:p,HAVE_ACCOUNT:v,SIGN_IN:g}=c.A.LOGIN;class y extends n.Component{constructor(e){super(e),this.signup=()=>{window.top&&(window.top.location.href=this.props.registerUrl)}}render(){const{loginUrl:e,backgroundUrl:t,locale:i}=this.props,n=t||h;return(0,r.jsx)("div",Object.assign({className:"login-redirect-screen",style:{backgroundImage:`url(${n})`}},{children:(0,r.jsx)("div",Object.assign({className:l()("login-redirect",{skrim:!!t})},{children:(0,r.jsxs)("div",Object.assign({className:"login-redirect-body"},{children:[(0,r.jsx)("h1",Object.assign({className:"login-redirect-title"},{children:i.t(m)})),(0,r.jsx)("div",Object.assign({className:"login-redirect-create"},{children:(0,r.jsx)(u.$n,{variant:u.Ak.PRIMARY,size:"large",theme:"dark",onClick:this.signup,label:i.t(p)})})),(0,r.jsxs)("div",Object.assign({className:"login-redirect-link"},{children:[i.t(v),(0,r.jsx)("a",Object.assign({className:"link",href:e},{children:i.t(g)}))]}))]}))}))}))}}var f=i(35223);class w extends a.n{constructor(){super(...arguments),this.name="login-redirect",this.authenticated=!1}async init(e,t){this.config=e,this.engine=t}async loadUi(){var e;const{container:t,loginUrl:i,registerUrl:a}=this.config,r=await this.engine.getModuleBySymbol(f.gS),d=encodeURIComponent((null===(e=window.top)||void 0===e?void 0:e.location.href)||"");return this.reactContainer=document.createElement("div"),this.reactContainer.id="login-redirect-container",t.appendChild(this.reactContainer),this.reactRoot=(0,s.createRoot)(this.reactContainer),this.reactRoot.render((0,n.createElement)(y,{locale:r,backgroundUrl:this.getBackground(),loginUrl:`${i}?target=${d}`,registerUrl:`${a}?target=${d}`})),new o.i}async unloadUi(){return!!this.reactContainer&&(this.reactRoot.unmount(),this.reactContainer.remove(),delete this.reactContainer,!0)}getBackground(){const{baseUrl:e,modelId:t}=this.config;if(!t||!e)return;const i=window.devicePixelRatio||1;return`${e}/api/v1/player/models/${t}/thumb?width=${Math.max(this.config.container.clientWidth,400)}&dpr=${i}&disable=upscale`}}},81686:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>U});var n=i(23205),s=i(59810),a=i(27230),o=i(68781),r=i(73072),d=i(86260),l=i(44940),c=i(99366),h=i(35223),u=i(39486);class m{constructor(e){this.config=e}serialize(e){const{serializer:t}=this.config;if(!e||!t)return null;const i={};for(const n in e){const s=t.serialize(e[n]);s&&(i[n]=s)}return i}deserialize(e){const{deserializer:t}=this.config;if(!e||!t)return{};const i={};for(const n in e){const s=t.deserialize(e[n]);s&&(i[n]=s)}return i}}var p=i(49475),v=i(76735),g=i(88488),y=i(68909),f=i(61693),w=i(35535),b=i(34944),k=i(60282);const T=new y.Vector3;class S extends f.v{constructor(e,t,i,n,s,a,o=new Date,r=new Date,d,l,c,h){super(),this.position=e,this.scale=t,this.rotation=i,this.enabled=s,this.meshGroup=a,this.created=o,this.modified=r,this.discardContents=!0,this.activeInPanoMode=!0,this._rotationMatrix=new y.Matrix4,this._matrix=new y.Matrix4,this.id=d||`${this.meshGroup}`+(0,k.D)(11),this.index=n,this.name=l,this.discardContents=void 0===c||c,this.activeInPanoMode=void 0===h||h}get sid(){return this.id}isPointTrimmed(e,t){return!!this.enabled&&(!(t&&!this.activeInPanoMode)&&(this.discardContents?this.isPointInside(e):!this.isPointInside(e)))}getTransformationMatrix(e){return(e=e||new y.Matrix4).compose(this.position,this.rotation,this.scale),e}getInverseTransformationMatrix(e){return(e=this.getTransformationMatrix(e)).invert(),e}isPointInside(e){this.getInverseTransformationMatrix(this._matrix);const t=T.copy(e).applyMatrix4(this._matrix);return t.x<.5&&t.x>-.5&&t.y<.5&&t.y>-.5&&t.z<.5&&t.z>-.5}updateRotationMatrix(){const e=this.rotation,t=this.rotation.clone().set(e.x,e.y,e.z,-e.w);this._rotationMatrix.makeRotationFromQuaternion(t.normalize())}get rotationMatrix(){return this.updateRotationMatrix(),this._rotationMatrix}static getUnitAABB(){return new y.Box3(new y.Vector3(-.5,-.5,-.5),new y.Vector3(.5,.5,.5))}getContainingAABB(){const e=S.getUnitAABB(),t=(0,b.jF)(e),i=this.getTransformationMatrix();return(0,b.nD)(t,e,i)}getOBB(){const e=(new y.Matrix4).makeRotationFromQuaternion(this.rotation),t=(new y.Matrix3).setFromMatrix4(e);return new w.OBB(this.position,this.scale.clone().multiplyScalar(.5),t)}}var I=i(35652),E=i(79889);const N=new I.Ay("JsonStoreMeshTrimDeserializer"),D=[{path:["position","x"],type:"number"},{path:["position","y"],type:"number"},{path:["position","z"],type:"number"},{path:["scale","x"],type:"number"},{path:["scale","y"],type:"number"},{path:["scale","z"],type:"number"},{path:["rotation","x"],type:"number"},{path:["rotation","y"],type:"number"},{path:["rotation","z"],type:"number"},{path:["rotation","w"],type:"number"},{path:["index"],type:"number"},{path:["enabled"],type:"boolean"},{path:["meshGroup"],type:"number"},{path:["id"],type:"string"},{path:["created"],type:"string"},{path:["modified"],type:"string"}];class C{constructor(){this.deserialize=e=>{if(!this.isValid(e))return N.debug("Unable to deserialize invalid mesh trim data",e),null;const{position:t,scale:i,rotation:n,index:s,enabled:a,meshGroup:o,created:r,modified:d,id:l,name:c,discardContents:h,activeInPanoMode:u}=e;return new S(v.U$.fromVisionVector(t),v.U$.fromVisionVector(i),v.U$.fromVisionSweepQuaternion(n),s,a,o,(0,g.X)(r),(0,g.X)(d),l,c,h,u)}}isValid(e){if(!e||"object"!=typeof e)return!1;const t=e;return(0,E.s)(t.meshGroup)||(t.meshGroup=t.floorIndex),D.every((t=>this.hasRequiredField(e,t)))}hasRequiredField(e,t){try{return typeof t.path.reduce(((i,n)=>{if("object"==typeof i&&null!==i)return i[n];throw new Error(`data ${JSON.stringify(e)} must be addressable by ${t.path.join(".")} with a value of type ${t.type}`)}),e)===t.type}catch(e){return N.debug(e),!1}}}var M=i(43797);class O{serialize(e){if(!e)return null;const{position:t,scale:i,rotation:n,index:s,enabled:a,meshGroup:o,created:r,modified:d,id:l,name:c,discardContents:h,activeInPanoMode:u}=e;return{position:(0,M.pX)(v.U$.toVisionVector(t)),scale:(0,M.pX)(v.U$.toVisionVector(i)),rotation:(0,M.ps)(v.U$.toVisionSweepQuaternion(n)),index:s,enabled:a,meshGroup:o,created:(0,g.$)(r),modified:(0,g.$)(d),id:l,name:c,discardContents:h,activeInPanoMode:u}}}class _ extends p.xO{constructor(e,t,i){const n=new C,s=new O,a=new m({deserializer:n,serializer:s});super({queue:e,path:`${t}/api/v1/jsonstore/model/trims/${i}`,batchUpdate:!0,deserialize:e=>a.deserialize(e),serialize:e=>a.serialize(e)})}}var A=i(18268);class P extends A.u{constructor(e){super(),this.payload=e}}P.id="CREATE_MESH_TRIM";class L extends A.u{constructor(e){super(),this.payload=e}}L.id="DELETE_MESH_TRIM";class x extends A.u{constructor(e){super(),this.payload=e}}x.id="MOVE_MESH_TRIM_ALL_FLOORS";var R=i(71294);const{TRIM:V}=c.A.WORKSHOP;class U extends n.n{constructor(){super(...arguments),this.name="trim-data",this.dataLoadedPromise=new R.i,this.load=async()=>{let e={};try{e=await this.store.read()||{}}catch(e){this.log.debug("error when reading from json storage"),this.log.debug(e)}try{const t=Object.values(e);this.modelMeshModule.meshTrimData.addMeshGroups(t.map((e=>e.meshGroup))),this.modelMeshModule.meshTrimData.add(...t)}catch(e){this.log.debug("error when adding trims from json storage"),this.log.debug(e)}this.monitor&&this.monitor.removeOnChanged(this.onMeshTrimsChanged),this.monitor=new a.F(this.modelMeshModule.meshTrimData.meshTrimsById,{aggregationType:s.D.Immediate}),this.monitor.onChanged(this.onMeshTrimsChanged),this.dataLoadedPromise.resolve()},this.createMeshTrim=async e=>{try{this.modelMeshModule.meshTrimData.add(e)}catch(e){if(e instanceof u.J){const e=V.MAX_TRIMS_ERROR_MESSAGE;this.engine.commandBinder.issueCommand(new d.P(e,{throttle:0,type:r.v.ERROR}))}}},this.deleteMeshTrim=async e=>{this.modelMeshModule.meshTrimData.delete(e)},this.save=async()=>{const e=this.monitor.getDiffRecord();if(this.monitor.clearDiffRecord(),!e.length)return;const t={};for(const i of e)switch(i.action){case o.Xw.added:case o.Xw.updated:t[i.index]=this.modelMeshModule.meshTrimData.getTrimById(i.index);break;case o.Xw.removed:t[i.index]=null}try{await this.store.update(t)}catch(e){this.log.debug("error when writing to json storage"),this.log.debug(e);const t=V.UNABLE_TO_SAVE_CHANGES_ERROR_MESSAGE;this.engine.commandBinder.issueCommand(new d.P(t,{throttle:30,type:r.v.ERROR}))}},this.moveMeshTrimToAllFloors=async e=>{const t=e.enabled;this.deleteMeshTrim(e),e.meshGroup=-1,e.enabled=t,this.createMeshTrim(e)},this.onMeshTrimsChanged=(0,l.n)(this.save,1e3)}get waitForData(){return this.dataLoadedPromise.nativePromise()}async init(e,t){this.engine=t,this.store=new _(e.queue,e.baseUrl,e.baseModelId),this.modelMeshModule=await t.getModuleBySymbol(h.GR),this.load(),this.bindings.push(t.commandBinder.addBinding(P,this.createMeshTrim),t.commandBinder.addBinding(L,this.deleteMeshTrim),t.commandBinder.addBinding(x,this.moveMeshTrimToAllFloors))}}},30280:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ModelData:()=>c.q,default:()=>A});var n=i(23205),s=i(80328),a=i(35223),o=i(55756),r=i(61334),d=i(16276),l=i(20764),c=i(35062),h=i(86265),u=i(71271),m=i(10657),p=i(88488),v=i(35652);class g{constructor(){this.lastPublished=null}key(){var e,t,i,n,s,a;return null!==(a=null!==(s=null!==(t=null===(e=this.tileset)||void 0===e?void 0:e.s3LocationKey)&&void 0!==t?t:null===(n=null===(i=this.meshUrls)||void 0===i?void 0:i[0])||void 0===n?void 0:n.s3LocationKey)&&void 0!==s?s:this.uuid)&&void 0!==a?a:this.sid}refresh(e){var t;this.sid=e.sid,this.details=e.details,this.uuid=e.uuid;for(const t in this.textures)e.textures[t]&&this.textures[t].refreshFrom(e.textures[t]);null===(t=this.meshUrls)||void 0===t||t.forEach(((t,i)=>{var n,s;const a=null===(s=null===(n=e.meshUrls)||void 0===n?void 0:n[i])||void 0===s?void 0:s.url;t.url&&a&&t.url.refreshFrom(a)})),this.tileset&&e.tileset&&(this.tileset.urlTemplate.refreshFrom(e.tileset.urlTemplate),this.tileset.s3LocationKey=e.tileset.s3LocationKey,this.tileset.maxLOD=e.tileset.maxLOD,this.tileset.rootFilename=e.tileset.rootFilename,this.tileset.tilesetVersion=e.tileset.tilesetVersion)}assetsEqual(e){return this.tileset&&e.tileset?this.tileset.s3LocationKey===e.tileset.s3LocationKey:!(!this.meshUrls||!e.meshUrls)&&this.meshUrls[0].s3LocationKey===e.meshUrls[0].s3LocationKey}}var y=i(54244),f=i(52147),w=i(95149),b=i(84229);class k extends b.t{constructor(e,t){super(e),this.name="ModelLoadException",this.code=t}}var T=i(10060),S=i(79166),I=i(76283),E=i(79889);const N=new v.Ay("mds-model-serializer");class D{deserialize(e){var t,i,n,s,a,o,r,l,c,h;if(!(e&&this.validate(e)&&e.publication&&e.assets))return N.debug("Deserialized invalid model data from MDS",e),null;const u=null!==(t=e.state)&&void 0!==t?t:y.ve.ACTIVE;if(u!==y.ve.ACTIVE)throw N.error(`model unavailable, status: ${u}`,e),new k("model unavailable",u);const m=e.publication,v=m.contact||{name:"",email:"",phoneNumber:""},f=e.options,w=new g;w.sid=e.id,w.details={sid:e.id,name:e.name||"",presentedBy:m.presentedBy||"",summary:m.summary||"",description:m.description||"",formattedAddress:m.address||"",contact:{email:v.email||"",name:v.name||"",phone:v.phoneNumber||"",formattedPhone:v.phoneNumber||""},externalUrl:m.externalUrl||""},w.options={urlBranding:null===(i=null==f?void 0:f.urlBrandingEnabled)||void 0===i||i,socialSharing:!!(null==f?void 0:f.socialSharingEnabled),isPublic:!!m.published,isVR:!!(null==f?void 0:f.vrEnabled)},m.lastPublished&&(w.lastPublished=(0,p.X)(m.lastPublished,null));const b=M(e.assets.textures.filter((e=>"high"===e.quality))[0]),T=M(e.assets.textures.filter((e=>"low"===e.quality))[0]);w.textures={},b&&(w.textures.high=new d.f(b,(0,p.X)(b.validUntil,null))),T&&(w.textures.low=new d.f(T,(0,p.X)(T.validUntil,null)));const S=this.getDamFileUrls(e);(null==S?void 0:S.length)&&(w.meshUrls=S);const I=null===(n=e.assets.tilesets)||void 0===n?void 0:n[0];if(this.validateTileset(I)&&(w.tileset=this.getTileset(I,e.lod),w.textures.max=this.getTilesetTextures(I)),!w.meshUrls&&!w.tileset)throw N.error("No DAM or tileset info found for model",w),new k("No DAM or tileset info found for model",u);return w.uuid=(null===(s=null==S?void 0:S[0])||void 0===s?void 0:s.uuid)||"",w.visibility=this.getModelVisibility(e),w.baseModelId=null!==(l=null!==(o=null===(a=null==e?void 0:e.baseView)||void 0===a?void 0:a.model.id)&&void 0!==o?o:null===(r=null==e?void 0:e.legacyBaseView)||void 0===r?void 0:r.model.id)&&void 0!==l?l:"",w.overlayActive=!(null===(h=null===(c=null==e?void 0:e.overlayLayers)||void 0===c?void 0:c.length)||void 0===h||!h),w.overlayAvailable=((null==e?void 0:e.defurnishViews)||[]).some((e=>null==e?void 0:e.model.id))?"defurnish":void 0,w}validate(e){return["id","assets","publication"].every((t=>t in e))}getDamFileUrls(e){var t;const i=((null===(t=e.assets)||void 0===t?void 0:t.meshes)||[]).reduce(((e,t)=>{var i;if(t.status===y.fd.AVAILABLE&&t.url){const n=new RegExp(/[a-f0-9]{8}[a-f0-9]{4}4[a-f0-9]{3}(:?8|9|A|B)[a-f0-9]{3}[a-f0-9]{12}/gi),s=new URL(t.url).pathname.matchAll(n);let a="";for(const e of s)a+=a?","+e[0]:e[0];const o=(null===(i=t.filename)||void 0===i?void 0:i.replace(".dam","").replace("_50k",""))||"unknown",r={url:new d.f(t.url,(0,p.X)(t.validUntil,null)),s3LocationKey:a,uuid:o};"50k"===t.resolution?e.unshift(r):e.push(r)}return e}),[]);return i}validateTileset(e){var t;if(!e)return!1;const i=T.h.lt(null!==(t=e.tilesetVersion)&&void 0!==t?t:"0","1.0.0");return e&&e.status===y.fd.AVAILABLE&&!i}getTileset(e,t){var i;const n=this.getTilesetMaxLOD(e,t),s=this.getRootTilesetFilename(e,t),a=this.getUrlTemplate(e),o=new URLSearchParams(a).get("k")+"/";return{maxLOD:n,rootFilename:s,urlTemplate:new d.f(a,(0,p.X)(e.validUntil,null)),tilesetVersion:null!==(i=e.tilesetVersion)&&void 0!==i?i:"0",s3LocationKey:o}}getTilesetMaxLOD(e,t){var i,n,s;let a=2;const o=T.h.gte(null!==(i=e.tilesetVersion)&&void 0!==i?i:"0","1.2.0"),r=!o&&e.tilesetPreset===S.wR.basic1,d=e.tilesetPreset===S.wR.custom,l=e.tilesetDepth;if(C(l)&&(o||d||!r))return l;switch(null===(n=null==t?void 0:t.options)||void 0===n?void 0:n[0]){case S.vn.MAX:a=C(l)?l:4,T.h.lt(null!==(s=e.tilesetVersion)&&void 0!==s?s:"0","1.1.0")&&(a=3);break;case S.vn.LOD3:a=3;break;case S.vn.LOD2:a=2;break;case S.vn.LOD1:a=1;break;case S.vn.LOD0:a=0}return 1===(0,w.P3)("debugTiles",0)&&(0,w.P3)("maxLOD",a)!==a&&(a=(0,w.P3)("maxLOD",a)),a}getRootTilesetFilename(e,t){if(1===(0,w.P3)("debugTiles",0)&&""!==(0,w.P3)("tilesetroot",""))return(0,w.P3)("tilesetroot","");if(e.tilesetPreset===S.wR.custom)return"tileset.json";return`${this.getTilesetMaxLOD(e,t)}.json`}getTilesetTextures(e){const t=this.getUrlTemplate(e);return new d.f({filename:null,id:"tiled",resolution:"*",quality:"max",format:"jpg",urlTemplate:t.replace(f.tQ.urlTemplateToken,"<folder>/<texture>.jpg"),validUntil:e.validUntil},(0,p.X)(e.validUntil,null))}getUrlTemplate(e){var t;return f.tQ.urlTemplateOverride?f.tQ.urlTemplateOverride+f.tQ.urlTemplateToken+"?t=fake":null!==(t=e.urlTemplate)&&void 0!==t?t:f.tQ.urlTemplateToken}getModelVisibility(e){return I.P.hasPassword?S.K7.PASSWORD:(0,E.s)(e.visibility)&&e.visibility!==y.K7.PUBLIC?e.visibility===y.K7.PRIVATE?S.K7.PRIVATE:S.K7.UNKNOWN:e.discoverable?S.K7.PUBLIC:S.K7.UNLISTED}}function C(e){return(0,E.s)(e)&&!isNaN(e)}function M(e){var t;return(null==e?void 0:e.id)&&e.resolution&&e.quality&&e.urlTemplate?{id:e.id,filename:null!==(t=e.filename)&&void 0!==t?t:null,format:e.format,validUntil:e.validUntil||"",resolution:e.resolution,quality:e.quality,urlTemplate:e.urlTemplate}:null}class O extends m.g{constructor(){super(...arguments),this.serializer=new D,this.prefetchKey="data.model.name"}async read(e){var t,i;const n={modelId:null!==(t=null==e?void 0:e.modelId)&&void 0!==t?t:this.getViewId()},s=await this.query(u.GetModelDetails,n,e),a=this.serializer.deserialize(null===(i=null==s?void 0:s.data)||void 0===i?void 0:i.model);return a&&!a.baseModelId&&(a.baseModelId=this.getBaseViewId()),a}async refresh(e){return super.refresh(Object.assign({fetchPolicy:"no-cache"},e))}}async function _(e,t,i){var n;(await i.getModuleBySymbol(a.aF)).setOptions({model_id:null!==(n=e.baseModelId)&&void 0!==n?n:e.sid,model_mesh_type:e.tileset&&t.tiledMeshEnabled?"streamed":"dam",overlay_active:e.overlayActive,overlay_available:e.overlayAvailable})}class A extends n.n{constructor(){super(...arguments),this.name="model-data",this.data=new c.q}async init(e,t){this.engine=t;const{baseUrl:i,readonly:n}=e,s=await t.market.waitForData(r.P);this.store=new O({context:s.mdsContext,readonly:n,baseUrl:i}),s.onPropertyChanged("currentViewId",(e=>{const t=this.data.getModel(e);this.log.debugInfo("view change",e,t),t&&this.setActiveModel(t)})),this.store.onNewData((async e=>{if(e){const t=this.data.getModel(e.sid);this.log.debugInfo("data change",e.sid,void 0!==t?"refresh":"add"),t?t.refresh(e):(this.addModel(e),this.setActiveModel(e))}})),t.getModuleBySymbol(a.GR).then((i=>{let n=this.data.getModel();i.isolateMesh(this.data.getModel()),this.data.onPropertyChanged("activeModelId",(async s=>{const a=this.data.getModel(s);_(a,e,t),(!n||a&&!a.assetsEqual(n))&&(i.isolateMesh(a),n=a)}))})),await this.store.refresh({modelId:s.currentViewId,fetchPolicy:"cache-first"}),t.market.register(this,c.q,this.data),this.registerSettings(this.data.getModel()),_(this.data.getModel(),e,t),t.market.waitForData(o.M).then((e=>{var t;const i=null===(t=this.data.getModel())||void 0===t?void 0:t.lastPublished;i&&(e.lastPublished=i.getTime())}))}queryModel(e){return this.store.read({modelId:e})}setActiveModel(e){this.data.activeModelId=e.sid,this.data.commit()}addModel(e){if(!this.data.hasModel(e.sid)){const t=this.data.getModel();this.data.addModel(e.sid,e),(0,d._)(e,(async()=>{await this.store.refresh({modelId:e.sid})})),(!t||t&&!t.assetsEqual(e))&&this.engine.broadcast(new h.A(e.sid,e.vrSupported))}}async registerSettings(e){var t;const i=await this.engine.getModuleBySymbol(s.ZF),n="Model Options",{urlBranding:a=!0,socialSharing:o,isPublic:r,isVR:d}=e.options||{};i.registerSetting(n,f.wD,o),i.registerSetting(n,"is_public",r),i.registerSetting(n,"is_vr",d);const c=!a||!!i.settingsData.getOverrideParam("brand",!0),h=a?i.settingsData.getOverrideParam("mls","0"):"0",u=a?i.settingsData.getOverrideParam("title","1"):"1",m=null!==(t=i.settingsData.getOverrideParam("tagNav","1"))&&void 0!==t?t:"1";i.registerSetting(n,f.wx,"0"!==u&&"2"!==h),i.registerSetting(n,f.ov,"0"!==u&&"2"!==u),i.registerSetting(n,f.Lj,c),i.registerSetting(n,f.qu,"1"===h||"2"===h),i.registerSetting(n,l.rp,"0"!==m)}}},39486:(e,t,i)=>{"use strict";i.d(t,{J:()=>s});var n=i(84229);class s extends n.t{constructor(e){super(e),this.name="TooManyTrimsError"}}},76879:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a,u:()=>s});var n=i(14754);class s extends n.QB{constructor(e,t,i){super(),this.name=e,this.version=t,this.loadTime=i}}class a{constructor(){this.handlers=[{msgType:s,func:(e,t,i)=>{e.track("plugin_loaded",{name:t.name,version:t.version,time:t.loadTime})}}]}}},97552:(e,t,i)=>{"use strict";i.r(t),i.d(t,{PolicyData:()=>d.L,WORKSHOP_EDIT_POLICY:()=>c,default:()=>h});var n=i(23205),s=i(10657),a=i(3718),o=i(54244);class r extends s.g{constructor(e){super(e),this.prefetchKey="data.model.policies"}async read(e){const t=this.getViewId();return this.query(a.GetModelPolicies,{modelId:t},e).then((e=>{var t,i;const n=((null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.policies)||[]).filter((e=>{switch(e.type){case"PolicyFlag":return e.enabled;case"PolicyValue":return null!==e.value;case"PolicyOptions":return e.options&&e.options.length>0;case"PolicyFeature":return e.availability===o.UY.UNLOCKED;default:return!1}}));return n.map((e=>({name:e.name,value:e.value,options:e.options})))}))}}var d=i(58838);class l extends n.n{constructor(){super(...arguments),this.name="policy-module"}async init(e,t){this.store=new r({context:e.mdsContext,readonly:!0,baseUrl:e.baseUrl,viewId:e.viewId});const i=await this.store.read();this.policyData=new d.L(i),t.market.register(this,d.L,this.policyData)}dispose(e){super.dispose(e),e.market.unregister(this,d.L)}}const c="perm.spaces.workshop.edit",h=l},58291:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>M});var n=i(23205),s=i(35223),a=i(68909);function o(e){return"excludeFromOctree"in e}var r=i(76735),d=i(34944);const l=new a.Vector3;class c{constructor(){this.parent=null,this.raycastDistance=1/0,this.distance=1/0}updateRaycastDistance(e){this.raycastDistance=this.bounds.distanceToPoint(e)}updateDistanceToBounds(e){this.distance=this.bounds.distanceToPoint(e)}}class h extends c{constructor(e){super(),this.mesh=e,this.bounds=(0,d.UX)(this.mesh.geometry).clone().applyMatrix4(this.mesh.matrixWorld),this.center=this.bounds.getCenter(new a.Vector3)}raycast(e,t){this.mesh.visible&&this.mesh.raycast(e,t)}nearestPointOnGeometry(e){const t=e.clone().applyMatrix4((new a.Matrix4).copy(this.mesh.matrixWorld).invert());let i;const n=this.mesh.geometry.boundsTree;return i=n?n.closestPointToPoint(t):(0,d.U7)(this.mesh.geometry,t),i?(i.point.applyMatrix4(this.mesh.matrixWorld),{object:this.mesh,point:i.point,distance:i.point.distanceTo(e),faceIndex:i.faceIndex}):null}}class u extends c{constructor(e,t,i){super(),this.level=t,this.leafMinSize=i,this.childNodes=[],this.children=[],this.listeners={},this.bounds=e.clone(),this.size=e.getSize(new a.Vector3),this.center=e.getCenter(new a.Vector3)}get depth(){return this.level}*addMeshes(e){e.updateMatrixWorld(!0);const t=[];e.traverse((e=>{!(e instanceof a.Mesh&&e.geometry)||o(e)&&e.excludeFromOctree||t.push(e)}));for(const e of t)this.addMesh(new h(e))}removeMeshes(e){let t=!1;for(let i=0;i<this.children.length;i++){const n=this.children[i];n instanceof h&&n.mesh.id===e.id&&(n.parent=null,this.children.splice(i,1),this.emit("removed",this,n),t=!0)}if(!t)throw new Error("Mesh that is being attempted removed does not exist in this node.")}addMesh(e){this.parent||this.expandToFit(e);let t=!1;if(this.size.length()>this.leafMinSize){0===this.childNodes.length&&this.buildChildNodes();for(const i of this.childNodes)i.bounds.containsBox(e.bounds)&&(t=!0,i.addMesh(e))}t||this.add(e)}add(e){if(e.parent)throw new Error("ColliderNode already has a parent, remove before trying to add in another node");e.parent=this,this.children.push(e),this.emit("added",this,e)}expandToFit(e){let t=!1;for(;!this.bounds.containsBox(e.bounds);){const{bounds:i,size:n,center:s,children:a,childNodes:o}=this,r=s.clone();this.children=[],this.childNodes=[],n.multiplyScalar(2),s.set(i[e.center.x>s.x?"max":"min"].x,i[e.center.y>s.y?"max":"min"].y,i[e.center.z>s.z?"max":"min"].z),i.setFromCenterAndSize(s,n),this.buildChildNodes();for(const e of this.childNodes)if(e.center.distanceToSquared(r)<1e-10){e.children=a,e.childNodes=o,a.forEach((t=>{this.emit("removed",t.parent,t),t.parent=e,this.emit("added",e,t)}));break}t=!0}t&&this.traverse((e=>{e.parent&&(e.level=e.parent.level+1)}))}traverse(e){e(this);for(const t of this.childNodes)t.traverse(e)}clear(){this.childNodes.length=0,this.children.length=0}buildChildNodes(){const e=l.copy(this.size).multiplyScalar(.5);for(let t=0;t<2;t++)for(let i=0;i<2;i++)for(let n=0;n<2;n++){const s=this.bounds.min.x+e.x*n,o=s+e.x,r=this.bounds.min.y+e.y*t,d=r+e.y,l=this.bounds.min.z+e.z*i,c=l+e.z,h=new a.Box3(new a.Vector3(s,r,l),new a.Vector3(o,d,c)),m=new u(h,this.level+1,this.leafMinSize);this.childNodes.push(m),this.add(m)}}raycast(e,t){if(!0===e.ray.intersectsBox(this.bounds))for(const i of this.children)i.raycast(e,t)}pick(e,t,i,n=null){if(!e.ray.intersectsBox(this.bounds))return t;for(const t of this.children)t.updateRaycastDistance(e.ray.origin);this.children.sort(((e,t)=>e.raycastDistance-t.raycastDistance));for(const s of this.children){if(t&&t.distance<s.raycastDistance)break;if(i(s))if(s instanceof u)t=s.pick(e,t,i,n);else{const i=[];s.raycast(e,i);for(const e of i)t&&!(t.distance>e.distance)||n&&!n(e)||(t=e)}}return t}nearestTo(e,t,i=null){for(const t of this.children)t.updateDistanceToBounds(e);this.children.sort(((e,t)=>e.distance-t.distance));for(const n of this.children){if(0!==n.distance&&i&&i.distance<n.distance)break;if(t(n))if(n instanceof u)i=n.nearestTo(e,t,i);else if(n instanceof h){const t=n.nearestPointOnGeometry(e);if(t){(!i||i.distance>t.distance)&&(i=t)}}}return i}getAllBounds(e,t=0,i=1/0,n=!1){for(const s of this.children)this.level>=t&&this.level<=i&&(n||e.push(s.bounds.clone())),s instanceof u&&s.getAllBounds(e,t,i,n)}emit(e,...t){const i=this.listeners[e]||[];for(const e of i)e(...t);this.parent&&this.parent.emit(e,...t)}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}}class m{constructor(e,t){this.meshToNodes={},this._depth=0;const i=(0,r.C)(e);this.root=new u(i,0,t),this.root.on("added",((e,t)=>{e.depth>this._depth&&(this._depth=e.depth),t instanceof h&&(this.meshToNodes[t.mesh.id]||(this.meshToNodes[t.mesh.id]=[]),this.meshToNodes[t.mesh.id].push(t))})),this.root.on("removed",((e,t)=>{if(t instanceof h){const e=this.meshToNodes[t.mesh.id];for(let i=0;i<e.length;i++)e[i]===t&&e.splice(i,1)}}))}get depth(){return this._depth}*addMeshesAsync(e){yield*this.root.addMeshes(e)}addMeshes(e){for(const t of this.root.addMeshes(e));}removeMeshes(e){e.traverse((e=>{const t=this.meshToNodes[e.id]||[];for(const i of t)i.parent&&i.parent.removeMeshes(e)}))}clear(){this.root.clear(),this.meshToNodes={}}raycast(e){const t=[];return this.root.raycast(e,t),t}getAllBounds(e=0,t=1/0,i=!1){const n=[];return this.root.getAllBounds(n,e,t,i),n}pick(e,t,i=null){const n=e.firstHitOnly;e.firstHitOnly=!i;const s=this.root.pick(e,null,(e=>!(t&&e instanceof h)||t(e.mesh)),i);return e.firstHitOnly=n,s}nearestMeshTo(e,t){const i=this.root.bounds.clampPoint(e,new a.Vector3);return this.root.nearestTo(i,(e=>!(t&&e instanceof h)||t(e.mesh)))}getDebugBoundsMesh(e=16777215,t=0,i=1/0,n=!1){const s=this.getAllBounds(t,i,n),o=new a.LineBasicMaterial({color:e});if(s.length>0){const e=[];for(const t of s){const i=new a.Box3Helper(t);i.updateMatrixWorld(!0),i.geometry.applyMatrix4(i.matrixWorld),e.push(i.geometry)}const t=(0,d.h0)(e);return new a.LineSegments(t,o)}return new a.LineSegments(new a.BufferGeometry,o)}}var p=i(47103),v=i(94221);class g{constructor(e,t,i,n){this.camera=e,this.cameraData=t,this.defaultRaycastFilter=i,this.intersectionFilter=n,this.meshes={},this.octreeEnabledMeshes={},this.meshFilters=new Map,this.raycaster=new a.Raycaster,this.prevRay=new a.Ray,this._hitCache=[],this.hitCacheValid=!0,this.getOctree=()=>this.octree}init(){this.raycaster=new a.Raycaster,this.raycaster.camera=this.camera,this.raycaster.params.Line&&(this.raycaster.params.Line.threshold=.1)}dispose(){this.octree.clear(),this._hitCache.length=0,this.meshes={}}updateIntersectionFilter(e){this.intersectionFilter=e}cast(e,t,i){if(e&&t&&(this.prevRay.copy(this.raycaster.ray),this.raycaster.set(e,t)),!i&&this.prevRay.equals(this.raycaster.ray)&&this.hitCacheValid)return this._hitCache;if(this.hitCacheValid=!0,this.raycaster.layers.mask=this.camera.layers.mask,this._hitCache.length=0,this.octree){const e=this.getRaycastFilter(w.OctreeMeshes,i),t=this.octree.pick(this.raycaster,e,this.intersectionFilter);t&&this._hitCache.push(t)}const n=this.getRaycastFilter(w.DynamicMeshes,i);for(const e in this.meshes){const t=this.meshes[e];if(n(t)){const e=this.raycaster.intersectObject(t,!0);this._hitCache=this._hitCache.concat(e)}}const s=this.cameraData.isOrtho()?f:y;return this._hitCache.sort(((e,t)=>s(e,t))),this.prevRay.copy(this.raycaster.ray),this._hitCache}pick(e,t,i){var n;this.raycaster.set(e,t);const s=this.getRaycastFilter(w.OctreeMeshes,i);return null===(n=this.octree)||void 0===n?void 0:n.pick(this.raycaster,s,this.intersectionFilter)}nearest(e,t){return this.octree.nearestMeshTo(e,this.getRaycastFilter(w.OctreeMeshes,t))}setupOctree(e){this.octree=new m(e,.5);for(const e of Object.keys(this.meshes))if(this.octreeEnabledMeshes[e]){const t=this.meshes[e];this.octree.addMeshes(t)}return this.octree}addTarget(e,t,i){const n=e,s=n.collider?n.collider:e;this.meshes[e.id]=s,i&&this.meshFilters.set(s,i),this.octreeEnabledMeshes[e.id]=t,this.octree&&t&&(this.octree.addMeshes(e),e.traverse((e=>{!(e instanceof a.Mesh)||o(e)&&e.excludeFromOctree||(this.octreeEnabledMeshes[e.id]=t,i&&this.meshFilters.set(e,i))}))),this.hitCacheValid=!1}removeTarget(e){this.octree&&this.octreeEnabledMeshes[e.id]&&(this.octree.removeMeshes(e),this.octreeEnabledMeshes[e.id]=!1,e.traverse((e=>{e instanceof a.Mesh&&(this.octreeEnabledMeshes[e.id]=!1,this.meshFilters.delete(e))})));const t=this.meshes[e.id];t&&(this.meshFilters.delete(t),delete this.meshes[e.id]),this.hitCacheValid=!1}getRaycastFilter(e,t){const i=t||this.defaultRaycastFilter,n=t=>{const i=this.octreeEnabledMeshes[t.id];switch(e){case w.DynamicMeshes:return!i;case w.OctreeMeshes:return i}};return e=>n(e)&&i(e)&&this.checkMeshSpecificFilter(e)}checkMeshSpecificFilter(e){const t=this.meshFilters.get(e);return!t||t(e)}render(){}activate(){}deactivate(){}}function y(e,t){var i,n;const s=(null!==(i=e.object.intersectionPriority)&&void 0!==i?i:p.I.Normal)-(null!==(n=t.object.intersectionPriority)&&void 0!==n?n:p.I.Normal);return 0!==s?s:e.object.hasIntersectionPriorityWithRespectTo&&e.object.hasIntersectionPriorityWithRespectTo(t)?-1:t.object.hasIntersectionPriorityWithRespectTo&&t.object.hasIntersectionPriorityWithRespectTo(e)?1:e.distance-t.distance}function f(e,t){const i=e.object instanceof v.r?e.object.get2DPickingPriority():e.object.renderOrder,n=t.object instanceof v.r?t.object.get2DPickingPriority():t.object.renderOrder;return i>n?-1:i<n?1:y(e,t)}var w;!function(e){e[e.OctreeMeshes=0]="OctreeMeshes",e[e.DynamicMeshes=1]="DynamicMeshes"}(w||(w={}));var b=i(33630),k=i(84265),T=i(39591);class S{constructor(e,t){this.raycaster=e,this.cameraData=t,this.currentRay=new a.Ray,this.pointer=new a.Vector2(-2,-2),this.origin=new a.Vector3,this.direction=new a.Vector3,this.cast=e=>{const t=this.pointerRay;return this.raycaster.cast(t.origin,t.direction,e).slice()},this.updatePointer=e=>{this.pointer.distanceToSquared(e)>2e-5&&this.pointer.set(e.x,e.y)}}get pointerRay(){const{origin:e,direction:t}=this.updateDirections();return this.currentRay.set(e,t)}get ndcPosition(){return this.pointer}updateDirections(){return(0,T.Ft)(this.cameraData.pose,this.origin.set(this.pointer.x,this.pointer.y,-1),this.origin),(0,T.Ft)(this.cameraData.pose,this.direction.set(this.pointer.x,this.pointer.y,1),this.direction),this.direction.sub(this.origin).normalize(),{origin:this.origin,direction:this.direction}}}class I{constructor(e,t,i){this.raycaster=e,this.data=t,this.cameraData=i,this.cache={normal4:new a.Vector4,normal:new a.Vector3,rotationMatrix:new a.Matrix4,ndc3:new a.Vector3}}beforeRender(){if(this.raycaster.pointer.pointerRay.equals(this.data.pointerRay))return;this.data.pointerRay.copy(this.raycaster.pointer.pointerRay),this.data.pointerOrigin.copy(this.data.pointerRay.origin),this.data.pointerDirection.copy(this.data.pointerRay.direction);const e=this.raycaster.pointer.cast();if(this.data.hits.length=0,this.data.hits.push(...e),this.data.pointerNdcPosition.copy(this.raycaster.pointer.ndcPosition),this.cache.ndc3.set(this.data.pointerNdcPosition.x,this.data.pointerNdcPosition.y,.5),this.data.pointerScreenPosition.copy((0,T.zH)(this.cameraData.width,this.cameraData.height,this.cache.ndc3)),e.length>0){const t=e[0];if(t&&t.face){const e=t.face.normal;this.cache.normal4.set(e.x,e.y,e.z,0),this.cache.rotationMatrix.extractRotation(t.object.matrixWorld),this.cache.normal4.applyMatrix4(this.cache.rotationMatrix),this.cache.normal.set(this.cache.normal4.x,this.cache.normal4.y,this.cache.normal4.z),this.data.hit=new b.t(t.point.clone(),this.cache.normal.clone(),t.object,t)}}else this.data.hit=null;this.data.commit()}init(){}render(){}dispose(){this.data.hit=null,this.data.hits.length=0,this.data.commit()}activate(){}deactivate(){}}var E=i(45018),N=i(90302),D=i(93279),C=i(83372);class M extends n.n{constructor(){super(...arguments),this.name="raycaster",this.raycasterPointerData=new b.$,this.overridePointer=null,this.setOverridePointer=e=>{this.overridePointer=e}}async init(e,t){t.market.register(this,b.$,this.raycasterPointerData);const[i,n]=await Promise.all([t.getModuleBySymbol(s.M7),t.market.waitForData(E.M)]),a=i.getCamera();this.raycaster=new g(a,n,N.f_,null),t.addComponent(this,this.raycaster),this.defaultPointer=new S(this.raycaster,n),this.snapcaster=new k.v(n,t);const o=new I(this,this.raycasterPointerData,n);t.addComponent(this,o),t.broadcast(new D.sb(C.D.Raycaster)),t.broadcast(new D.sb(C.D.Octree)),t.broadcast(new D.sb(C.D.Snapping))}dispose(e){super.dispose(e),this.raycaster.dispose(),this.snapcaster.dispose()}setupOctree(e){this.raycaster.setupOctree(e),this.snapcaster.setupOctree(e)}setIntersectionFilter(e){this.raycaster.updateIntersectionFilter(e)}getOctree(){return this.raycaster.getOctree()}get pointer(){return null!==this.overridePointer?this.overridePointer:this.defaultPointer}get targets(){return this.raycaster}get picking(){return this.raycaster}get snapping(){return this.snapcaster}get data(){return this.raycasterPointerData}}},31012:(e,t,i)=>{"use strict";i.d(t,{h:()=>s});var n=i(14754);class s extends n.QB{constructor(e,t,i,n,s,a){super(),this.roomId=e,this.meshSubgroup=t,this.viewmode=i,this.visitCount=n,this.roomCount=s,this.roomType=a}}},82873:(e,t,i)=>{"use strict";i.d(t,{m:()=>s});var n=i(18268);class s extends n.u{constructor(e,t,i){super();const n=function*(){return t()}();this.payload={type:e,func:n,maxDelay:i,steps:1}}}s.id="SCHEDULE_TASK_COMMAND"},13198:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ScheduleProcessCommand:()=>o.i,ScheduleTaskCommand:()=>a.m,Task:()=>c,default:()=>h});var n,s=i(23205),a=i(82873),o=i(94713),r=i(84619);class d{constructor(e){this.name=e,this.taskDurations=new r.C(100),this.medianDuration=1}get typicalStepDuration(){return this.medianDuration}addTaskDuration(e){this.taskDurations.push(e),this.taskDurations.index%10==0&&(this.medianDuration=this.taskDurations.median())}}!function(e){e.WAITING="waiting",e.STARTED="started",e.DONE="done"}(n||(n={}));class l{constructor(){this.tasks=[],this.types={}}getType(e){return this.types[e]||(this.types[e]=new d(e)),this.types[e]}addTask(e){this.tasks.push(e)}update(e){this.tasks=this.tasks.filter((e=>e.status!==n.DONE)),this.tasks.sort(((e,t)=>t.urgency-e.urgency));let t=0;e:for(const i of this.tasks)for(;i.status!==n.DONE;){const n=performance.now(),s=t+i.type.typicalStepDuration>e,a=n>=i.deadline;if(s&&!a)break e;const o=n;i.run();const r=performance.now()-o;i.type.addTaskDuration(r),t+=r}}}class c{constructor(e,t,i,s){this.type=e,this.func=t,this.deadline=i,this.steps=s,this.status=n.WAITING,this.promise=new Promise(((e,t)=>{this.onSuccess=e,this.onError=t}))}run(){let e;this.status=n.STARTED;try{e=this.func.next()}catch(e){return this.status=n.DONE,void this.onError(e)}this.steps-=1,e.done&&(this.status=n.DONE,this.onSuccess(e.value))}get estimatedDuration(){return this.steps*this.type.typicalStepDuration}get urgency(){const e=this.deadline-performance.now();return e<=0?1e6-e:this.estimatedDuration/e/e}}class h extends s.n{constructor(){super(...arguments),this.name="scheduler-module",this.scheduler=new l}async init(e,t){this.engine=t,this.engine.commandBinder.addBinding(a.m,(async e=>{const t=new c(this.scheduler.getType(e.type),e.func,performance.now()+e.maxDelay,e.steps);return this.scheduler.addTask(t),t})),this.engine.commandBinder.addBinding(o.i,(async e=>{const t=new c(this.scheduler.getType(e.type),e.func,performance.now()+e.maxDelay,e.steps);return this.scheduler.addTask(t),t}))}onUpdate(e){this.scheduler.update(4)}}},11276:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>u});var n=i(35223),s=i(23205),a=i(96540),o=i(5338),r=i(99366),d=i(74848),l=i(91607);function c({loadingMessage:e,messageDelay:t}){const[i,n]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{if(!i){const e=setTimeout((()=>{n(!0)}),t);return()=>clearTimeout(e)}return()=>{}})),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",Object.assign({className:"spinner-container"},{children:(0,d.jsx)(l.A,{progress:33,barWidth:4,progressColor:"#ffffff"})})),i&&(0,d.jsx)("div",Object.assign({className:"message"},{children:e}))]})}class h extends s.n{constructor(){super(...arguments),this.name="sdk-landing",this.messageDelay=3e3}async init(e,t){this.locale=await t.getModuleBySymbol(n.gS),this.reactContainer=document.createElement("div"),this.reactContainer.id="sdk-landing-container",this.container=e.container}show(){this.container.appendChild(this.reactContainer),this.reactRoot=(0,o.createRoot)(this.reactContainer),this.reactRoot.render((0,a.createElement)(c,{loadingMessage:this.locale.t(r.A.SDK.AWAITING),messageDelay:this.messageDelay}))}hide(){var e;this.container.removeChild(this.reactContainer),this.reactRoot.unmount(),null===(e=this.reactContainer)||void 0===e||e.remove()}}const u=h},25660:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>T});var n=i(23205),s=i(82110),a=i(49191),o=i(34040),r=i(61334),d=i(98925),l=i(10657),c=i(58619),h=i(17650),u=i(54244),m=i(76735),p=i(43797),v=i(32361);const g={[s.N3.Dollhouse]:u.nE.DOLLHOUSE,[s.N3.Floorplan]:u.nE.FLOORPLAN,[s.N3.Panorama]:u.nE.PANORAMA,[s.N3.Outdoor]:u.nE.PANORAMA,[s.N3.Transition]:u.nE.MESH,[s.N3.Orthographic]:u.nE.MESH,[s.N3.Mesh]:u.nE.MESH};class y{constructor(){}serialize(e,t){const i=[];for(const[n,s]of e.metadata.floorVisibility.entries())if(1===s){const e=t.floorsData.getFloorAtIndex(n);e&&i.push(e.id)}return{label:e.name,contents:{filename:`${e.name}.jpg`,blob:e.imageBlob},snapshotLocation:{anchorId:e.metadata.scanId,visibleFloorIds:i,position:(0,p.pX)(m.U$.toVisionVector(e.metadata.cameraPosition)),rotation:(0,p.ps)(m.U$.toVisionCameraQuaternion(e.metadata.cameraQuaternion)),viewMode:g[e.metadata.cameraMode],zoom:e.metadata.cameraMode===s.N3.Floorplan?e.metadata.orthoZoom:e.metadata.ssZoom},photoType:e.category===v.X.PANORAMA?u.xx.EQUIRECTANGULAR:u.xx.PHOTO2D}}}class f extends l.g{constructor(e,t,i){super(e),this.getViewId=t,this.getBaseViewId=i,this.serializer=new y,this.prefetchKey="data.model.assets.photos",this.deserializer=new h.S(this.getViewId.bind(this))}async read(e){const t={modelId:this.getBaseViewId()};return e=Object.assign({anonymous:!0},e),this.query(c.GetSnapshots,t,e).then((e=>{var i,n,s,a,o,r,d,l;const c=((null===(s=null===(n=null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.model)||void 0===n?void 0:n.assets)||void 0===s?void 0:s.photos)||[]).map((e=>this.deserializer.deserialize(e))),h={};for(const e of c)e&&(e.sourceViewId=t.modelId,h[e.sid]=e);const u=(null===(o=null===(a=null==e?void 0:e.data)||void 0===a?void 0:a.model)||void 0===o?void 0:o.defurnishedViews)||[];for(const e of u){const t=((null===(d=null===(r=e.model)||void 0===r?void 0:r.assets)||void 0===d?void 0:d.photos)||[]).map((e=>this.deserializer.deserialize(e)));for(const i of t)i&&(i.sourceViewId=null===(l=e.model)||void 0===l?void 0:l.id,h[i.sid]=i)}return h}))}async refresh(){return super.refresh({fetchPolicy:"no-cache"})}async create(e,t){const i=this.getViewId(),n=e.category===v.X.TOUR,s=n?"UploadHighlightReelSnapshot":"UploadModelSnapshot",a=n?c.UploadHighlightReelSnapshot:c.UploadModelSnapshot,o=this.serializer.serialize(e,t);return this.client.upload(a,s,Object.assign(Object.assign({},o),{modelId:i})).then((e=>{var t;return this.deserializer.deserialize(null===(t=e.data)||void 0===t?void 0:t.snapshot)}))}async update(e){var t;const i=this.getViewId(),n=null===(t=(await this.client.mutate(c.PatchPhoto,{modelId:i,photoId:e.sid,label:e.name})).data)||void 0===t?void 0:t.patchPhoto;return this.deserializer.deserialize(n)}async delete(e){var t;const i=this.getViewId();return(null===(t=(await this.client.mutate(c.DeletePhoto,{modelId:i,photoId:e})).data)||void 0===t?void 0:t.deletePhoto)||!1}}var w=i(13539),b=i(14754);class k extends b.QB{constructor(e){super(),this.snapshot=e}}class T extends n.n{constructor(){super(...arguments),this.name="snapshots-data"}async init(e,t){const{readonly:i,baseUrl:n,baseModelId:s}=e;this.engine=t;const o=await t.market.waitForData(r.P);this.store=new f({context:o.mdsContext,readonly:i,baseUrl:n,viewId:s},(()=>o.getDefurnishOrBaseId()),(()=>o.getBaseModelId()));const l=await this.store.read()||{};this.sweepData=await t.market.waitForData(a.A);for(const e in l)this.processSnapshot(l[e]);this.snapshotsData=new d.O(l),this.snapshotsData.onStale=()=>this.store.refresh(),t.market.register(this,d.O,this.snapshotsData),i||this.bindings.push(t.commandBinder.addBinding(w.Ns,(({snapshot:e})=>this.uploadSnapshot(e))),t.commandBinder.addBinding(w.gp,(({id:e,name:t})=>this.renameSnapshot(e,t))),t.commandBinder.addBinding(w.tZ,(({id:e})=>this.deleteSnapshot(e))),t.commandBinder.addBinding(w.t6,(({id:e})=>this.setSelectedPhoto(e))))}async setSelectedPhoto(e){this.snapshotsData.setSelectedPhoto(e)}async uploadSnapshot(e){const t=await this.engine.market.waitForData(o.q),i=await this.store.create(e,{floorsData:t});return i&&(this.processSnapshot(i),this.snapshotsData.add(i),this.engine.broadcast(new k(i))),i}async renameSnapshot(e,t){const i=this.snapshotsData.get(e);if(t!==i.name)return i.name=t,i.commit(),this.snapshotsData.commit(),this.store.update(i)}async deleteSnapshot(e){await this.store.delete(e).catch((t=>{this.log.debug(t),this.log.error(`Failed to delete snapshot ${e}`)}))&&(this.snapshotsData.remove(e),this.snapshotsData.commit())}processSnapshot(e){const t=e.metadata.cameraMode===s.N3.Panorama,i=!this.sweepData.isSweepAligned(e.metadata.scanId);if(e.is360=t&&i,t&&e.metadata.scanId){const t=this.sweepData.getSweep(e.metadata.scanId);t&&e.metadata.cameraPosition.copy(t.position)}e.name=e.name.replace("_defurnished","")||"",e.name.match(/^[0-9.]+_[0-9.]+$/)&&(e.name=""),e.commit()}}},17650:(e,t,i)=>{"use strict";i.d(t,{S:()=>m});var n=i(68909),s=i(82110),a=i(35652),o=i(76735),r=i(88488),d=i(50593),l=i(32361),c=i(16276),h=i(54244);const u=new a.Ay("mds-snapshot-deserializer");class m{constructor(e){this.getViewId=e}deserialize(e){var t,i,a,m;if(!e||!this.validate(e))return u.debug("Deserialized invalid Snapshot data from MDS",e),null;const p=new d.F;p.sid=e.id,p.thumbnailUrl=new c.f(e.thumbnailUrl||"",(0,r.X)(e.validUntil,null)),p.imageUrl=new c.f(e.presentationUrl||"",(0,r.X)(e.validUntil,null)),p.name=e.label||"",p.category=this.getCwfSnapshotCategory(e)||l.X.USER,p.width=e.width||0,p.height=e.height||0,p.created=(0,r.X)(e.created),p.modified=(0,r.X)(e.modified),p.visionLabel=e.classification||"",p.sourceViewId=this.getViewId();const v=null===(a=null===(i=null===(t=e.snapshotLocation)||void 0===t?void 0:t.anchor)||void 0===i?void 0:i.pano)||void 0===a?void 0:a.placement;p.is360=!(!v||v===h.$h.AUTO);const{snapshotLocation:g}=e;if(g){const e=g.position?o.U$.fromVisionVector(g.position):new n.Vector3,t=g.rotation?o.U$.fromVisionCameraQuaternion(g.rotation):new n.Quaternion,i=this.getCwfViewmode(g.viewMode)||s.N3.Panorama,a=[];for(const e of g.floorVisibility||[]){for(let t=0;t<e.sequence;t++)a[t]=a[t]||0;a[e.sequence]=1}p.metadata={cameraMode:i,cameraPosition:e,cameraQuaternion:t,scanId:g.anchor&&g.anchor.id||"",orthoZoom:i===s.N3.Floorplan&&null!==(m=g.zoom)&&void 0!==m?m:-1,ssZoom:g.zoom||1,floorId:g.floorVisibility&&g.floorVisibility.length>0?g.floorVisibility[0].id:null,floorVisibility:a}}return p}validate(e){var t;if(!(null===(t=e.snapshotLocation)||void 0===t?void 0:t.position))return!1;const i=["id","snapshotLocation","thumbnailUrl","presentationUrl"].every((t=>t in e)),n=null!==this.getCwfSnapshotCategory(e);return i&&n}getCwfViewmode(e){const t={[h.nE.DOLLHOUSE]:s.N3.Dollhouse,[h.nE.PANORAMA]:s.N3.Panorama,[h.nE.FLOORPLAN]:s.N3.Floorplan,[h.nE.MESH]:s.N3.Panorama};return e&&e in t?t[e]:null}getCwfSnapshotCategory(e){var t,i,n;if(e.category===h.hL.TOUR)return l.X.TOUR;if(e.origin===h.pu.VISION)return l.X.AUTO;if(e.type===h.xx.EQUIRECTANGULAR)return l.X.PANORAMA;const s=null===(n=null===(i=null===(t=e.snapshotLocation)||void 0===t?void 0:t.anchor)||void 0===i?void 0:i.pano)||void 0===n?void 0:n.placement;return e.type===h.xx.PHOTO2D?s===h.$h.MANUAL?l.X.UNALIGNED:l.X.USER:null}}},22558:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DataSavedMessage:()=>u.DI,ForbiddenError:()=>d,ForbiddenErrorMessage:()=>u.xt,PublishError:()=>c,PublishErrorMessage:()=>u.ft,SaveCommand:()=>n.F,SaveError:()=>l,SaveErrorMessage:()=>u.xi,StorageAnalytics:()=>p,StorageData:()=>v.M,StorageError:()=>r,TransactionPhase:()=>s.w,TransactionState:()=>s.i,default:()=>x,getErrorCodeForDataType:()=>h});var n=i(80379),s=i(93159),a=i(84229),o=i(26325);class r extends a.t{constructor(e,t="50001"){super(e),this.name="StorageError",this.code=t}}class d extends a.t{constructor(e,t="53100"){super(e),this.name="ForbiddenError",this.code=t}}class l extends a.t{constructor(e,t="53100"){super(e),this.name="SaveError",this.code=t}}class c extends a.t{constructor(e,t="53200"){super(e),this.name="PublishError",this.code=t}}function h(e){return{[o.p.BLUR_SUGGESTIONS]:"12",[o.p.BLURS]:"01",[o.p.FLOORS]:"02",[o.p.HIGHLIGHTS]:"03",[o.p.LABELS]:"04",[o.p.MATTERTAGS]:"05",[o.p.MEASUREMENTS]:"06",[o.p.NOTES]:"07",[o.p.OBJECT_ANNOTATIONS]:"15",[o.p.ORDERED_LISTS]:"13",[o.p.PHOTOS]:"08",[o.p.PLUGINS]:"17",[o.p.SETTINGS]:"09",[o.p.START_LOCATION]:"10",[o.p.SWEEPS]:"11",[o.p.LAYERS]:"14",[o.p.ROOM_BOUNDS]:"16"}[e]||"99"}var u=i(53865),m=i(27147);class p{constructor(){this.handlers=[{msgType:u.xi,func:(e,t)=>{const{dataTypes:i,error:n}=t,s=n.name||"SaveError",a={error_code:(0,m.fS)(n).join(", "),error_type:s,error_dialog:"banner",data_type:i?i.join(", "):"",exception:{message:`${s}: ${n.message}`,stack:n.stack},mock_error:(0,m.zi)(n)};e.track("error_displayed",a)}},{msgType:u.ft,func:(e,t)=>{const{dataTypes:i,error:n}=t,s=n.name||"PublishError",a={error_code:(0,m.fS)(n).join(", "),error_type:s,error_dialog:"banner",data_type:i?i.join(", "):"",exception:{message:`${s}: ${n.message}`,stack:n.stack},mock_error:(0,m.zi)(n)};e.track("error_displayed",a)}}]}}var v=i(55756),g=i(23205),y=i(33004),f=i(45459),w=i(38710),b=i(61373),k=i(43066),T=i(35652),S=i(95149),I=i(61334),E=i(49191),N=i(48064),D=i(92590),C=i(45018),M=i(69505),O=i(35596),_=i(33020);const A=new T.Ay("publishing-manager");class P{constructor(e,t,i){this.engine=t,this.lock=i,this.client=e;const{market:n}=this.engine;Promise.all([n.waitForData(O.zH),n.waitForData(I.P)]).then((([e,i])=>{const n=i.getWorkshopSessionView();if(n)if(e.application===O.lg.WORKSHOP)this.publish(n);else{const e=t.subscribe(_.E5,(t=>{t.application===O.lg.WORKSHOP&&(e.cancel(),this.publish(n))}))}}))}async publish(e){const t=await this.lock.lock();A.debug("Publishing"),await this.mergeView(e.id).catch((e=>{A.error(e),t.unlock();const i="53200";if(e instanceof w.ZT||e instanceof w._W){const t=new d(e,i);throw this.engine.broadcast(new u.xt(t,[])),t}const n=new c(e,i);throw this.engine.broadcast(new u.ft(n,[])),n})),t.unlock(),await this.hasWorkshopChanges(e.id)?A.error("Auto-Publishing failed"):(A.debug("Auto-Publishing completed"),this.reloadWorkshop())}async mergeView(e){const t=await this.client.query(k.PublishView,{viewId:e}).catch((e=>{throw new b.YA(e)})),i="53200"===(0,S.P3)("error","");if(!y.t.isOk(t)||i){const e=new b.YA(y.t.getErrorMessage(t));throw i&&(e.isMock=!0),e}}async hasWorkshopChanges(e){var t,i,n;const s=null===(n=null===(i=null===(t=(await this.client.query(k.GetMergeDiff,{viewId:e}).catch((e=>{throw new b.tW(e)}))).data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.mergeDiff)||void 0===n?void 0:n.typesModified;return!!s&&s.length>0}async reloadWorkshop(){const{market:e}=this.engine,[t,i,n,s]=await Promise.all([e.waitForData(E.A),e.waitForData(N.X),e.waitForData(D.X),e.waitForData(C.M)]),a=M.s.serialize({cameraData:s,viewmodeData:i,floorsViewData:n,sweepData:t});a.set("edit","1"),a.set("qs","1"),(0,S.KZ)(a.toString())}}var L=i(1803);class x extends g.n{constructor(){super(...arguments),this.name="storage",this.saveHandlers=new Set,this.lock=new f.c,this.pendingSaves=0,this.unsavedChangesPopup=e=>{this.data.transactionState!==s.i.IDLE&&e.preventDefault()}}async init(e,t){const{baseUrl:i,mdsContext:s}=e;this.config=e,this.engine=t,this.client=new y.t({baseUrl:i,mdsContext:s}),this.data=new v.M,this.bindings.push(t.commandBinder.addBinding(n.F,(e=>this.save(e.dataTypes,e.onCallback,e.skipDirtyUpdate))),(0,L.Sh)((()=>window.addEventListener("beforeunload",this.unsavedChangesPopup)),(()=>window.removeEventListener("beforeunload",this.unsavedChangesPopup)))),t.market.waitForData(I.P).then((e=>{e.isWorkshopSessionView()&&new P(this.client,this.engine,this.lock)})),t.market.register(this,v.M,this.data)}dispose(e){super.dispose(e)}onSave(e,t={}){const i={callback:e,dataType:t.dataType,phase:t.phase||s.w.ON};return(0,L.Sh)((()=>this.saveHandlers.add(i)),(()=>this.saveHandlers.delete(i)),!0)}async save(e,t,i=!1){this.pendingSaves++;const n=await this.lock.lock(),a=t=>{this.log.error(t),this.pendingSaves--,n.unlock(),0===this.pendingSaves&&this.data.setTransactionState(s.i.IDLE);const i=e[0]?`531${h(e[0])}`:"53100";if(t instanceof w.ZT||t instanceof w._W){const n=new d(t,i);throw this.engine.broadcast(new u.xt(n,e)),n}const a=new l(t,i);throw this.engine.broadcast(new u.xi(a,e)),a};this.log.debug(`Saving ${[...e].join(", ")}...`),this.data.setTransactionState(s.i.SAVING);const{before:o,on:r,after:c}=this.getCallbacksByPhase(this.saveHandlers,e);await Promise.all(o.map((e=>e()))).catch(a),await Promise.all(r.map((e=>e()))).catch(a),t&&await t().catch(a),this.engine.broadcast(new u.DI(e)),await Promise.all(c.map((e=>e()))).catch(a),this.pendingSaves--,n.unlock(),0===this.pendingSaves&&this.data.setTransactionState(s.i.IDLE),this.log.debug(`Saving ${[...e].join(", ")} completed`)}getCallbacksByPhase(e,t){const i=Array.isArray(t)?t:Object.values(o.p),n=[...e.values()].filter((e=>!e.dataType||i.includes(e.dataType))),a={[s.w.BEFORE]:[],[s.w.ON]:[],[s.w.AFTER]:[]};return n.reduce(((e,t)=>(e[t.phase].push((()=>t.callback(i))),e)),a)}}},6650:(e,t,i)=>{"use strict";i.d(t,{d:()=>a,m:()=>s});var n=i(66871);class s extends n.d{constructor(e="SweepException"){super(e),this.name="SweepException"}}class a extends s{constructor(e="Tried to start transition while another transition was active"){super(e),this.name="SweepTransitionActiveException"}}},93990:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>W});var n=i(23205),s=i(35223),a=i(71136),o=i(66871),r=i(71294),d=i(79953),l=i(27230),c=i(59810),h=i(68781),u=i(16276),m=i(26325),p=i(80379),v=i(61334),g=i(33848),y=i(48064),f=i(80788),w=i(89383),b=i(10657),k=i(35652);const T=new k.Ay("mds-sweep-serializer");class S{serialize(e){const t={};return void 0===e.enabled&&void 0===e.vrenabled||(t.tags=[],e.enabled&&t.tags.push("showcase"),e.vrenabled&&t.tags.push("vr")),this.validate(t)?t:null}validate(e){if(!e)return!1;const t=["tags"],i=t.some((t=>t in e)),n=0===Object.keys(e).filter((e=>!t.includes(e))).length,s=void 0===e.tags||Array.isArray(e.tags),a=s&&i&&n;return a||T.debug("Invalid AnchorPatch:",{tagsIsArrayIfPresent:s,hasSomeChanges:i,hasNoExtraChanges:n,mutableFields:t,data:e}),a}}var I=i(8371),E=i(76735),N=i(61543),D=i(88488),C=i(15151),M=i(54244);const O=new k.Ay("mds-sweep-serializer"),_={[M.$h.AUTO]:I.EO.AUTO,[M.$h.MANUAL]:I.EO.MANUAL,[M.$h.UNPLACED]:I.EO.UNPLACED},A={[M.n.VISION]:I.c$.ALIGNED,[M.n.UPLOAD]:I.c$.UNALIGNED};class P{constructor(){this._sourceViewId=null}setSourceViewId(e){this._sourceViewId=e}deserialize(e){var t,i,n,s;if(!e||!this.validate(e))return O.debug("Deserialized invalid Sweep data from MDS",e),null;const a=e,o=new I.Ay({platformId:a.id,sourceViewId:this._sourceViewId});o.index=a.index,o.enabled=!!(null===(t=a.tags)||void 0===t?void 0:t.includes("showcase")),o.vrenabled=!!(null===(i=a.tags)||void 0===i?void 0:i.includes("vr")),o.neighbours=a.neighbors||[],a.position&&(o.floorPosition=E.U$.fromVisionVector(a.position)),o.floorId=(null===(n=a.floor)||void 0===n?void 0:n.id)||null,o.roomId=(null===(s=a.room)||void 0===s?void 0:s.id)||null;const r=a.pano;let d=r.label||"";if(d===`${o.index}`&&(d=""),o.name=d,o.alignmentType=A[r.source],o.uuid=r.sweepUuid||"",o.alignmentType===I.c$.ALIGNED?o.placementType=I.EO.AUTO:o.placementType=_[r.placement],r.position){const e=E.U$.fromVisionVector(r.position);o.placementType!==I.EO.AUTO&&e.distanceTo(o.floorPosition)>1e3&&(o.placementType=I.EO.UNPLACED),o.position=e}o.resolutions=[];const l=r.skyboxes||[];if(r.resolutions)for(const e of r.resolutions){const t=this.getPanoSizeClass(e),i=this.makeSkybox(l.find((t=>t.resolution===e)));t&&i?(o.resolutions.push(t),o.skyboxes[t]=i):O.debug(`Invalid pano size class ${e}`)}return r.rotation&&(o.rotation=E.U$.fromVisionSweepQuaternion(r.rotation)),o.floorId||(o.alignmentType===I.c$.ALIGNED?O.debug(`Aligned sweep ${o.index} has no floor association`):o.placementType===I.EO.MANUAL&&O.debug(`Manually placed sweep ${o.index} has no floor association`)),o.roomId||o.alignmentType===I.c$.ALIGNED&&O.debug(`Aligned sweep ${o.index} has no room association`),o}validate(e){if(!e)return!1;const t=[],i=["id","index","tags"];if(t.push((()=>i.every((t=>t in e)))),t.push((()=>"number"==typeof e.index)),t.push((()=>!!e.position&&(0,C.Z)(e.position))),t.push((()=>"pano"in e&&!!e.pano)),e.pano){const{placement:i,source:n,position:s}=e.pano;t.push((()=>!!i&&i in _)),t.push((()=>!!n&&n in A)),t.push((()=>!!s&&(0,C.Z)(s)))}return t.every((e=>e()))}getPanoSizeClass(e){const t={low:N.MF.BASE,high:N.MF.STANDARD,"2k":N.MF.HIGH,"4k":N.MF.ULTRAHIGH};return e in t?t[e]:void 0}makeSkybox(e){if(e&&e.tileUrlTemplate&&e.tileResolution&&e.tileCount)return new u.f({tileUrlTemplate:e.tileUrlTemplate,tileResolution:parseInt(e.tileResolution,10),tileCount:e.tileCount,urlTemplate:null!==e.urlTemplate?e.urlTemplate:void 0},(0,D.X)(e.validUntil,null))}}var L=i(43797);const x=new k.Ay("mds-sweep-serializer");class R{serialize(e){const t={};return e.rotation&&(t.rotation=(0,L.ps)(E.U$.toVisionSweepQuaternion(e.rotation))),e.position&&(t.position=(0,L.pX)(E.U$.toVisionVector(e.position))),e.placementType&&e.placementType===I.EO.UNPLACED&&(t.resetPlacement=!0,t.resetFloor=!0,t.resetRoom=!0),"roomId"in e&&(e.roomId?t.roomId=e.roomId:t.resetRoom=!0),"floorId"in e&&(e.floorId?(t.floorId=e.floorId,t.roomId||(t.resetRoom=!0)):t.resetFloor=!0),"name"in e&&(t.label=e.name||""),this.validate(t)?t:null}validate(e){if(!e)return!1;const t=["resetPlacement","resetFloor","resetRoom","rotation","position","floorId","roomId","label"],i=t.some((t=>t in e)),n=0===Object.keys(e).filter((e=>!t.includes(e))).length,s=i&&n;return s||x.debug("Invalid PanoramaLocation:",{hasSomeChanges:i,hasNoExtraChanges:n,mutableFields:t,data:e}),s}}const V=new k.Ay("mds-sweep-store");class U extends b.g{constructor(){super(...arguments),this.deserializer=new P,this.panoSerializer=new R,this.anchorSerializer=new S,this.prefetchKey="data.model.locations",this.syncedViewMap={}}async read(e={}){var t,i,n,s,a,o,r,d,l,c,h,u,m,p,v,g,y;const{readonly:f}=this.config,b=null!==(t=e.modelId)&&void 0!==t?t:this.getViewId(),k={modelId:b};let T;T=f?await this.query(w.GetShowcaseSweeps,k,e):await this.query(w.GetSweeps,k,e);const S=null!==(l=null!==(a=null===(s=null===(n=null===(i=null==T?void 0:T.data)||void 0===i?void 0:i.model)||void 0===n?void 0:n.baseView)||void 0===s?void 0:s.model.id)&&void 0!==a?a:null===(d=null===(r=null===(o=null==T?void 0:T.data)||void 0===o?void 0:o.model)||void 0===r?void 0:r.legacyBaseView)||void 0===d?void 0:d.model.id)&&void 0!==l?l:this.getBaseViewId(),I=((null===(h=null===(c=null==T?void 0:T.data)||void 0===c?void 0:c.model)||void 0===h?void 0:h.defurnishViews)||[]).map((e=>e.model.id));for(const e of I)this.syncedViewMap[e]=[S,...I.filter((t=>t!==e))],this.syncedViewMap[S]=this.syncedViewMap[S]?[...this.syncedViewMap[S],e]:[e];const E=null===(m=null===(u=null==T?void 0:T.data)||void 0===u?void 0:u.model)||void 0===m?void 0:m.locations,N=null!==(y=null===(g=null===(v=null===(p=null==T?void 0:T.data)||void 0===p?void 0:p.model)||void 0===v?void 0:v.overlayLayers)||void 0===g?void 0:g.some((e=>e.id)))&&void 0!==y&&y;if(!E||!Array.isArray(E))return null;this.deserializer.setSourceViewId(N?b:null);const D={},C={};for(const e of E){if(!e)continue;const t=this.deserializer.deserialize(e);t&&(D[t.id]=t,C[t.platformId]=t)}this.deserializer.setSourceViewId(null);for(const e of Object.values(D))e.neighbours=e.neighbours.filter((e=>e in C)),e.neighbours=e.neighbours.map((e=>C[e].id));return D}async refresh(e={}){return super.refresh(Object.assign({fetchPolicy:"no-cache"},e))}async update(e){if(!e||0===e.length)return;const t=[],i=new Map,n=this.getViewId();e.forEach((e=>{const t=e.sourceViewId||n,s=i.get(t)||[];s.push(e);const a=this.syncedViewMap[t]||[];for(const t of a){if(this.panoSerializer.serialize(e)){const n=i.get(t)||[];n.push(e),i.set(t,n)}}i.set(t,s)}));let s=0;for(const e of i.keys()){const n=i.get(e)||[];let a="";const o={};o.modelId=e;let r="";for(const e of n){s++;const t=this.panoSerializer.serialize(e),i=this.anchorSerializer.serialize(e);if(!t&&!i){V.debug("No changes to update:",e);continue}a+=""+(t?`, $pano${s}: PanoramicImageLocationPatch!`:"")+` ${i?`, $anchor${s}: AnchorPatch!`:""} `,t&&(o[`pano${s}`]=t),i&&(o[`anchor${s}`]=i),r+=`\n          ${t?`\n            panoLocation${s}: patchPanoLocation(modelId: $modelId, , locationId: "${e.id}", patch: $pano${s}) {\n              id\n              placement\n              model { id }\n              position { x y z }\n              rotation { x y z w }\n            }`:""}\n          ${i?`\n            panoAnchor${s}: patchAnchor(modelId: $modelId, , anchorId: "${e.id}", patch: $anchor${s}) {\n              id\n              tags\n              model { id }\n              floor { id, meshId }\n              room { id, meshId }\n            }`:""}\n        `}if(V.devInfo(r),""===r)continue;const d=f.gql`
        mutation sweepUpdate($modelId: ID! ${a}) {
          ${r}
        }
      `;t.push({mutation:d,variables:o})}return t.map((e=>V.devInfo(e.variables))),Promise.all(t.map((e=>this.mutate(e.mutation,e.variables)))).then((()=>{}))}}var B=i(49191),G=i(39425),F=i(49545),j=i(20560),H=i(58421),$=i(6650);const z=d.ME;class W extends n.n{constructor(){super(),this.name="sweep-data",this.data=new B.A,this.monitor=null,this.internalProgress=!1,this.filteredViewSubscription=null,this.activeOverlayViewId=null,this.ensureValidSweep=()=>{var e;const t=this.cameraModule.cameraData;if(t.transition.active&&t.transition.promise){return t.transition.promise.then((()=>{this.ensureValidSweep()}))}const i=!this.data.containsSweep(this.data.currentSweep),n=this.data.getSweep(this.data.currentSweep);if(this.data.currentSweep&&i){let i=this.data.getClosestSweep(t.pose.position,!0);if(n){const e=this.data.getAlternateSweeps(n)[0];e&&(i=e)}if(i)return(null===(e=this.engine.market.tryGetData(y.X))||void 0===e?void 0:e.isPano())?this.moveToSweep({sweepId:i.id,transitionType:n&&this.data.isSweepAligned(i.id)?a.fl.Interpolate:a.fl.Instant,transitionTime:500}).nativePromise():this.setCurrentSweep({sweepId:i.id})}return Promise.resolve()},this.moveToSweep=this.moveToSweep.bind(this),this.activateSweepUnsafe=this.activateSweepUnsafe.bind(this),this.instantSweepTransition=this.instantSweepTransition.bind(this),this.beginSweepTransition=this.beginSweepTransition.bind(this),this.endSweepTransition=this.endSweepTransition.bind(this),this.setCurrentSweep=this.setCurrentSweep.bind(this),this.sweepNeighborModify=this.sweepNeighborModify.bind(this)}async init(e,t){const{readonly:i}=e;this.engine=t,this.market=this.engine.market,this.bindings.push(t.commandBinder.addBinding(H.HP,this.setCurrentSweep),t.commandBinder.addBinding(H.WS,(async e=>this.sweepNeighborModify(e))),this.data.onSweepsChanged(this.ensureValidSweep)),this.cameraModule=await this.engine.getModuleBySymbol(s.jh),this.store=await this.initSweepStore(e,t),this.market.register(this,B.A,this.data),!1===i&&(this.monitor=new l.F(this.data.getCollectionUnfiltered(),{aggregationType:c.D.Debounced,aggregationDuration:250,shallow:!0},t),this.monitor.onChanged((()=>this.engine.commandBinder.issueCommand(new p.F({dataTypes:[m.p.SWEEPS]})))),t.getModuleBySymbol(s.T9).then((e=>{this.bindings.push(e.onSave((()=>this.save()),{dataType:m.p.SWEEPS}))})))}getSweepOnView(e,t=null){var i;const n=this.data.getSweep(e),s=null!==(i=null==n?void 0:n.platformId)&&void 0!==i?i:e,a=null!=t?t:this.activeOverlayViewId;return this.data.getSweep(I.Ay.formatId(s,a))}async setCurrentSweep(e){if(e.sweepId)try{const t=e.sweepId;await this.activateSweepUnsafe({sweepId:t}),this.beginSweepTransition({sweepId:t,transitionTime:0,internalProgress:!0}),this.data.currentSweep=t,this.endSweepTransition({sweepId:t}),this.data.commit()}catch(e){this.log.error(e)}else this.data.currentSweep=void 0,this.data.commit()}sweepNeighborModify(e){if(e.id){const t=this.data.getSweep(e.id);t&&t.atomic((()=>{let i=!1;for(const n of e.added)-1===t.neighbours.indexOf(n)&&this.data.containsSweep(n)&&(t.neighbours.push(n),i=!0);for(const n of e.removed){const e=t.neighbours.indexOf(n);-1!==e&&(t.neighbours.splice(e,1),i=!0)}i&&t.commit()}))}}moveToSweep(e){var t;const i=new r.i;let n=e.sweepId;if(n&&!this.data.containsSweep(n)&&this.data.getSweepByUuid(n)&&(n=null===(t=this.data.getSweepByUuid(n))||void 0===t?void 0:t.id,e.sweepId=n),n){const t=n,i=this.getSweepOnView(n);i&&(n=i.id,e.sweepId=n,n!==t&&this.log.info(`moveToSweep ${t} is not available in view, moving to ${n}.`))}if(!n||!this.data.getSweep(n))return this.log.error(`moveToSweep error ${JSON.stringify(e)}`,"Invalid sweep"),r.i.reject(new $.m("Invalid sweep"));const s=e;if(!this.data.canTransition()||!this.cameraModule.cameraData.canTransition())throw new $.d;return this.activateSweepUnsafe(s).then((()=>{if(!this.data.canTransition())throw new $.d;return this.beginSweepTransition(s),this.defaultSweepCameraMove(i,s)})).then((()=>{this.endSweepTransition(s),i.resolve()})).catch((e=>{e instanceof $.d||e instanceof $.m?this.log.info(`moveToSweep ignored ${JSON.stringify(s)}`,e):e instanceof o.d&&(this.data.transition.from&&this.endSweepTransition({sweepId:this.data.transition.from}),this.log.info(`exception moving to sweep ${JSON.stringify(s)}`,e)),i.reject(e)})),i.promise()}async activateSweepUnsafe(e){return this.panoRenderer||(this.panoRenderer=(await this.engine.getModuleBySymbol(s.qD)).getRenderer()),this.panoRenderer.activateSweep(e.sweepId,!0)}instantSweepTransition(e){const t=this.data.currentSweep;this.beginSweepTransition({sweepId:e,transitionTime:0,internalProgress:!0}),this.data.currentSweep=e,this.data.commit(),this.engine.broadcast(new j.A(e,t)),this.endSweepTransition({sweepId:e})}beginSweepTransition(e){this.data.activateTransition(e.sweepId,this.data.currentSweep),this.internalProgress=e.internalProgress||!1,this.data.transition.progress.modifyAnimation(0,1,e.transitionTime||0,e.easing||z),this.data.commit(),this.engine.broadcast(new G.A(e.sweepId,this.data.currentSweep))}endSweepTransition(e){const t=this.data.transition.from,i=this.data.getSweep(e.sweepId);this.data.deactivateTransition(),this.data.currentSweep=e.sweepId,this.data.transition.progress.stop(1),this.internalProgress=!1,this.data.commit(),this.engine.broadcast(new F.A(e.sweepId,i.alignmentType,i.placementType,t))}async defaultSweepCameraMove(e,t){const i={position:this.data.getSweep(t.sweepId).position,rotation:t.rotation};let n=a.fl.Interpolate;void 0!==t.transitionType&&a.fl[t.transitionType]&&(n=t.transitionType),(this.data.isSweepUnaligned(t.sweepId)||this.data.isSweepUnaligned(this.data.currentSweep))&&(n=a.fl.FadeToBlack);const s=this.cameraModule.moveTo({transitionType:n,pose:i,transitionTime:t.transitionTime,transitionSpeedMultiplier:t.transitionSpeedMultiplier,easing:t.easing,rotationDelay:t.rotationDelay,projection:t.projection});let o=!1;return s.progress((i=>{if(this.data.transition.progress.updateProgress(i),e.notify(i),i>=.5&&!o){o=!0;const e=this.data.currentSweep;this.data.currentSweep=t.sweepId,this.data.commit(),this.engine.broadcast(new j.A(t.sweepId,e))}})),s.nativePromise()}async initSweepStore(e,t){const{readonly:i,baseUrl:n}=e,s=await t.market.waitForData(v.P),a=new U({context:s.mdsContext,readonly:i,baseUrl:n}),o=async()=>{var e;const t=s.getCurrentView(),i=(0,g.Gk)(t)?t.id:null;this.activeOverlayViewId=i;const n=s.getView(null!=i?i:s.getWorkshopOrBaseId());if(this.data.getSweepList().length&&a.getViewId()===n.id)return;a.setStoreViewId(n.id);const o=await(null===(e=a.refresh)||void 0===e?void 0:e.call(a,{fetchPolicy:"cache-first"}))||{};(0,u._)(o,(async()=>{var e;const t=await(null===(e=a.refresh)||void 0===e?void 0:e.call(a,{modelId:n.id,fetchPolicy:"no-cache"}))||{};this.data.refresh(t)})),this.data.addSweeps(o),this.filteredViewSubscription&&this.filteredViewSubscription.cancel(),this.filteredViewSubscription=this.data.addFilter("sourceViewId",(e=>e.sourceViewId===i)),this.data.commit()};return this.bindings.push(s.onPropertyChanged("currentViewId",o)),await o(),a}onUpdate(e){this.internalProgress&&this.data.transition.active&&this.data.transition.progress.tick(e)}dispose(e){var t,i;super.dispose(e),null===(i=null===(t=this.store)||void 0===t?void 0:t.dispose)||void 0===i||i.call(t)}async save(){if(!this.store||!this.monitor)throw Error("No store configured for saving sweep edits!");const e=this.monitor.getDiffRecord();this.monitor.clearDiffRecord();const t=e.filter((e=>e.action===h.Xw.updated)).map((e=>{const t=this.data.getSweep(e.index),i=Object.assign({id:t.platformId},e.diff);return("position"in i||"rotation"in i)&&(i.position=t.position,i.rotation=t.rotation),("enabled"in i||"vrenabled"in i)&&(i.enabled=t.enabled,i.vrenabled=t.vrenabled),t.placementType===I.EO.AUTO&&K.forEach((e=>{e in i&&delete i[e]})),i}));return this.store.update(t)}}const K=["floorId","position","rotation"]},53009:(e,t,i)=>{"use strict";i.d(t,{f:()=>s});var n=i(14754);class s extends n.QB{constructor(){super()}}},46275:(e,t,i)=>{"use strict";i.r(t),i.d(t,{InviteUsersCommand:()=>g.jl,OrgUser:()=>r,ResolveUserMentionsCommand:()=>g.qO,UserData:()=>v.E,UserInfo:()=>b.o,UserMentionSearchCommand:()=>g.ly,UserStatus:()=>p._,default:()=>k,defaultUserColor:()=>w.g,getUnknownUserInfo:()=>w.A});var n=i(23205),s=i(35652),a=i(10657),o=i(54244);class r{constructor(e){this.id="",this.email="",this.firstName="",this.lastName="",this.modelAccess=o.OQ.PUBLIC,Object.assign(this,e)}}const d=new s.Ay("mds-user-deserializer");class l{constructor(){this.validate=e=>{if(!e)return!1;const t=["id","email"].filter((t=>!(t in e))),i=0===t.length;return i||d.debug("OrgUserMetadata invalid:",{missingFields:t}),i}}deserialize(e){return e&&this.validate(e)?new r(e):(d.debug("Deserialized invalid OrgUserMetadata from MDS",e),null)}}var c=i(46240),h=i(88488);const u=new s.Ay("users-store");class m extends a.g{constructor(e){super(e),this.deserializer=new l}async fetchAccessForUser(e,t){return this.query(c.GetCurrentUserModelAccess,{modelId:t,userId:e}).then((t=>{var i,n;const s=null===(i=t.data)||void 0===i?void 0:i.model,a=null===(n=null==s?void 0:s.users)||void 0===n?void 0:n.results;let r=o.OQ.PUBLIC;return a&&Array.isArray(a)?(a.find((e=>e.modelAccess===o.OQ.FULL))?r=o.OQ.FULL:a.find((e=>e.modelAccess===o.OQ.VIEWER))&&(r=o.OQ.VIEWER),u.debug(`modelAccess: ${a.length} response(s), set to "${r}"`)):u.debug(`fetchModelAccess failed for ${e}`),{modelAccess:r,organization:(null==s?void 0:s.organization)||void 0,demo:(null==s?void 0:s.demo)||void 0,created:(0,h.X)(null==s?void 0:s.created,null)||void 0}}))}async search(e,t,i){const n=this.getViewId();return this.query(c.GetUsers,{modelId:n,search:e||null,ids:i||null,emails:t||null}).then((e=>{var t,i,n;const s=null===(n=null===(i=null===(t=e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.users)||void 0===n?void 0:n.results;if(!s||!Array.isArray(s))return[];const a=[];for(const e of s){const t=this.deserializer.deserialize(e);t&&a.push(t)}return a}))}async addOrUpdateModelShareAccess(e,t,i,n=this.getViewId()){return this.mutate(c.AddOrUpdateModelShareAccess,{email:e,roleId:t,message:i,modelId:n}).then((e=>{var t,i,n;const s=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.addOrUpdateModelShareAccess,a=null==s?void 0:s.user,o=null==s?void 0:s.modelShareAccessLevel;if(a&&o)return{id:a.id,email:a.email,firstName:null!==(i=a.firstName)&&void 0!==i?i:"",lastName:null!==(n=a.lastName)&&void 0!==n?n:"",modelAccess:o.name};throw new Error(`Failed to invite user. ${e.errors}`)})).catch((e=>{throw u.error("Failed to invite user",e),e}))}async getAssignableRoles(e=this.getViewId()){return this.query(c.GetAssignableRoles,{modelId:e}).then((e=>{var t,i;const n=null===(i=null===(t=e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.assignableRoles;return n||(u.error("Failed to fetch assignable roles"),[])}))}}var p=i(7930),v=i(85217),g=i(2040),y=i(61334);class f extends n.n{constructor(){super(...arguments),this.name="users-module",this.onUserMentionSearch=async e=>{const t=await this.store.search(e.search);this.userData.loadKnownUsers(t)},this.resolveUserMentions=async e=>{if(0===e.userMentions.length)return void this.log.debug("No user mentions to resolve");const t=[];if(e.userMentions.forEach((e=>{this.userData.getUserInfoByEmail(e.email)&&e.userStatus!==p._.MENTIONED||t.push(e)})),t.length>0){const e=t.map((e=>e.email));return this.searchUsers(new Set(e),p._.MENTIONED)}},this.getRoleId=async e=>this.store.getAssignableRoles().then((t=>{var i;return null===(i=t.find((t=>t.name===e)))||void 0===i?void 0:i.id})),this.inviteUsers=async e=>{const{emails:t,modelAccess:i,message:n}=e;if(0===t.length)return;const s=new Set,a=await this.getRoleId(i);if(a)return await Promise.all(e.emails.map((e=>this.store.addOrUpdateModelShareAccess(e,a,n).then((e=>{this.userData.loadKnownUser(e)})).catch((()=>{this.log.debug(`User Invite failed: ${e}`),s.add(e)}))))),s.size>0?this.searchUsers(s,p._.FAILED):void 0;this.log.error(`User cannot assign role ${i} on this model.`)}}async init(e,t){this.store=new m({context:e.mdsContext,readonly:!1,baseUrl:e.baseUrl,viewId:e.viewId}),t.market.waitForData(y.P).then((async i=>{const n=await e.api.user;let s,a,r=o.OQ.PUBLIC,d=!1;if(n.loggedIn&&n.id){const e=await this.store.fetchAccessForUser(n.id,i.getBaseModelId());r=e.modelAccess,s=e.organization,d=!!s&&n.isOrganizationAdmin(s),a=e.created}this.userData=new v.E({id:n.id,firstName:n.firstName,lastName:n.lastName,email:n.email,modelAccess:r},n.loggedIn,d,s,a),this.bindings.push(t.commandBinder.addBinding(g.ly,this.onUserMentionSearch),t.commandBinder.addBinding(g.qO,this.resolveUserMentions),t.commandBinder.addBinding(g.jl,this.inviteUsers)),t.market.register(this,v.E,this.userData)}))}dispose(e){super.dispose(e),e.market.unregister(this,v.E)}async searchUsers(e,t){const i=Array.from(e),n=await this.store.search(void 0,i);this.userData.loadSearchResults(n,i,t)}}var w=i(27974),b=i(25125);const k=f},51238:(e,t,i)=>{"use strict";i.d(t,{A:()=>s});var n=i(36827);class s extends n.Y{}},57588:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>y});var n=i(68909),s=i(41733),a=i(94325),o=i(92590),r=i(23205),d=i(80328),l=i(48071),c=i(34944),h=i(74025);const u=(()=>{const e=Array.from({length:8},((e,t)=>new n.Vector3));return(t,i)=>{(0,c.jF)(i,e);for(const i of e)if(!t.containsPoint(i))return!1;return!0}})();var m=i(9264),p=i(35223);class v extends r.n{constructor(){super(...arguments),this.trimsFulfilled=!1,this.trimmedBounds=(0,s.p)({bounds:new n.Box3,center:new n.Vector3}),this.originalChunkBounds=(0,s.p)([]),this.trimmedChunkBounds=(0,s.p)([])}async init(e,t){e.calculateTrimmedBounds&&this._initTrims(t)}async _initTrims(e){const[t,i,n]=await Promise.all([e.getModuleBySymbol(d.ZF),e.getModuleBySymbol(p.M7),e.getModuleBySymbol(p.GR)]);this.modelMeshModule=n,await n.firstMeshLoadPromise;const s=n.getAllMeshes();this.updateTrimmedBounds(n.meshTrimData,s),this.bindings.push(n.meshTrimData.onChanged((()=>this.updateTrimmedBounds(n.meshTrimData,s)))),await e.addComponent(this,new g(this,t,i.getScene(),n.meshTrimData))}getTrimmedBounds(){return this.trimmedBounds.value.bounds}getOriginalChunkBounds(){return 0===this.originalChunkBounds.value.length&&this.calculateOriginalChunkBounds(this.modelMeshModule.getAllMeshes()),this.originalChunkBounds.value.map((e=>e.bounds))}getTrimmedChunkBounds(){return this.trimmedChunkBounds.value.map((e=>e.bounds))}getTrimmedCenter(){return this.trimmedBounds.value.center}onTrimmedBoundsChanged(e){return this.trimmedBounds.onChanged((({bounds:t})=>e(t)))}computePotentialFocusPoint(e){const t=this.getVisibleBounds(),i=this.getCenterOfMass(),s=Math.ceil(Math.abs(i.y-t.min.y)/3);let a=Number.MAX_VALUE;const o=new n.Vector3,r=new n.Vector3;let d=!1;if(Number.isFinite(s))for(let c=0;c<s;c++){const s=t.min.y+.01+3*c,h=(new n.Plane).setFromNormalAndCoplanarPoint(l.B1.UP,new n.Vector3(t.min.x,s,t.min.z)),u=!!e.intersectPlane(h,o),m=i.distanceTo(o);u&&m<a&&(a=m,r.copy(o),d=!0)}return{intersectsPlane:d,intersectionPoint:r}}computeFocusPoint(e,t){const i=this.getVisibleBounds(),s=this.getCenterOfMass(),{intersectsPlane:a,intersectionPoint:o}=this.computePotentialFocusPoint(e);let r;if(t)r=!t(o);else{const e=i.max.distanceTo(s)*Math.SQRT2;r=!i.clone().expandByVector(new n.Vector3(e,0,e)).containsPoint(o)}return a&&!r||(e.closestPointToPoint(s,o),e.origin.distanceTo(o)<m.X8&&e.at(m.X8,o)),o}calculateOriginalChunkBounds(e){let t=Number.MAX_VALUE;e.forEach((e=>{e.chunks.forEach((e=>{t=Math.min(t,e.lod)})),e.chunks.forEach((e=>{if(e.lod>t)return;let i;e.geometry.boundsTree?i=e.geometry.boundsTree.geometry.boundingBox||new n.Box3:(e.geometry.boundingBox||e.geometry.computeBoundingBox(),i=(new n.Box3).copy(e.geometry.boundingBox||new n.Box3)),this.originalChunkBounds.value.push({bounds:i,center:i.getCenter(new n.Vector3)})}))}))}updateTrimmedBounds(e,t){let i=null,s=!1;for(const t of e.meshTrimsById.values)s=s||!t.discardContents;if(i=this.getDiscardTrimmedBounds(e,t),s){let t=null;for(const i of e.meshTrimsById.values)if(!i.discardContents){const e=i.getContainingAABB();t=t?t.union(e):(new n.Box3).copy(e)}t&&(i=t.intersect(i))}this.trimsFulfilled=!0,i=i||new n.Box3,this.trimmedBounds.value={bounds:i,center:i.getCenter(new n.Vector3)}}getDiscardTrimmedBounds(e,t){let i=null,s=Number.MAX_VALUE;return t.forEach((t=>{t.chunks.forEach((e=>{s=Math.min(s,e.lod)})),t.chunks.forEach((t=>{if(t.lod>s)return;const a=this.getDiscardTrimmedBoundsForChunk(t,e);a&&(this.trimmedChunkBounds.value.push({bounds:a,center:a.getCenter(new n.Vector3)}),i=i?i.union(a):(new n.Box3).copy(a))}))})),i||new n.Box3}getDiscardTrimmedBoundsForChunk(e,t){return e.geometry.boundsTree?((e,t)=>{const i=t.map((e=>e.getOBB()));let s=null;return e.shapecast({intersectsBounds:(e,a,o,r)=>{const d=[];let l=!1;if(s&&s.containsBox(e))return h.Bw;for(let n=0;n<t.length;n++){const s=t[n],o=i[n];if(s.enabled&&s.discardContents){if(s.discardContents&&u(o,e)||!s.discardContents&&!o.intersectsBox3(e))return h.yj;o.intersectsBox3(e)&&(l=!0,(a||r>=10)&&d.push(e))}}if(l){if(a||r>=10){s=s||(new n.Box3).copy(d[0]);for(let e=1;e<d.length;e++)s.union(d[e]);return h.Bw}return h.b_}return s=s?s.union(e):(new n.Box3).copy(e),h.Bw},intersectsRange:()=>!1,intersectsTriangle:()=>!1}),s||null})(e.geometry.boundsTree,t.meshTrimsById.values):(e.geometry.boundingBox||e.geometry.computeBoundingBox(),e.geometry.boundingBox?e.geometry.boundingBox.clone():new n.Box3)}}class g{constructor(e,t,i,s){this.settings=t,this.webglScene=i,this.meshTrimData=s,this.trims=new Map,this.bounds={Trimmed:[new n.Box3Helper(e.getTrimmedBounds(),new n.Color("orange"))],Full:[new n.Box3Helper(e.getFullBounds(),new n.Color("white"))],Visible:[new n.Box3Helper(e.getFullBounds(),new n.Color("green"))],OriginalChunk:e.getOriginalChunkBounds().map((e=>new n.Box3Helper(e,new n.Color("red")))),TrimmedChunk:e.getTrimmedChunkBounds().map((e=>new n.Box3Helper(e,new n.Color("yellow"))))};for(const e of Object.values(this.bounds))e.forEach((e=>e.visible=!1));this.rebuildTrimHelpers();for(const[,e]of this.trims)e.visible=!1;e.onTrimmedBoundsChanged((()=>{this.rebuildTrimHelpers(),this.bounds.Trimmed[0].box.copy(e.getTrimmedBounds())})),e.onFullBoundsChanged((()=>this.bounds.Full[0].box.copy(e.getFullBounds()))),e.onVisibleBoundsChanged((()=>this.bounds.Visible[0].box.copy(e.getVisibleBounds())))}init(){for(const[e,t]of Object.entries(this.bounds))this.settings.registerMenuButton({header:"Bounds & Trim",buttonName:`Toggle ${e} bounds display`,callback:()=>{t.forEach((e=>e.visible=!e.visible))}});this.settings.registerMenuButton({header:"Bounds & Trim",buttonName:"Toggle trim visuals",callback:()=>{for(const[,e]of this.trims)e.visible=!e.visible}})}activate(){this.webglScene.add(...this.getAllBoxHelpers()),this.webglScene.add(...this.trims.values())}dispose(){for(const e of Object.values(this.bounds))e.forEach((e=>e.dispose()));for(const e of Object.values(this.trims))e.dispose()}deactivate(){this.webglScene.remove(...this.getAllBoxHelpers()),this.webglScene.remove(...this.trims.values())}render(){}rebuildTrimHelpers(){var e;for(const t of this.meshTrimData.meshTrimsById){const i=(null===(e=this.trims.get(t))||void 0===e?void 0:e.box)||new n.Box3;i.setFromCenterAndSize(t.position,t.scale);const s=this.trims.get(t)||new n.Box3Helper(i,t.discardContents?new n.Color("red"):new n.Color("yellow"));s.quaternion.copy(t.rotation),this.trims.set(t,s)}}getAllBoxHelpers(){return Object.values(this.bounds).reduce(((e,t)=>e.concat(...t)))}}class y extends v{constructor(){super(...arguments),this.name="visible-mesh-bounds",this.visibleBounds=(0,s.p)(new n.Box3),this.visibleCenterOfMass=(0,s.p)(new n.Vector3),this.fullBounds=(0,s.p)(new n.Box3)}async init(e,t){super.init(e,t),Promise.all([t.market.waitForData(a.U),t.market.waitForData(o.X)]).then((([e,t])=>{this.meshData=e,this.floorsViewData=t,this.fullBounds.value=this.meshData.extendedBounds,this.updateBounds(),this.bindings.push(this.onTrimmedBoundsChanged((()=>this.updateBounds())),this.floorsViewData.makeFloorChangeSubscription((()=>this.updateBounds())),...this.floorsViewData.floors.getOrderedValues().map((e=>e.onBoundsChanged((()=>this.updateBounds())))))}))}getVisibleBounds(){return this.visibleBounds.value.clone()}getFullBounds(){return this.fullBounds.value.clone()}getCenterOfMass(){return this.visibleCenterOfMass.value.clone()}onVisibleBoundsChanged(e){return this.visibleBounds.onChanged(e)}onFullBoundsChanged(e){return this.fullBounds.onChanged(e)}updateBounds(){this.floorsViewData.currentFloor?(this.visibleBounds.value=this.floorsViewData.currentFloor.boundingBox.clone(),this.visibleCenterOfMass.value=this.floorsViewData.currentFloor.centerOfMass.clone()):this.trimsFulfilled?(this.visibleBounds.value=this.getTrimmedBounds(),this.visibleCenterOfMass.value=this.getTrimmedCenter()):(this.visibleBounds.value=this.meshData.extendedBounds,this.visibleCenterOfMass.value=this.meshData.centerOfMass)}}},59666:(e,t,i)=>{"use strict";i.d(t,{o:()=>r,A:()=>l});var n=i(68909),s=i(53950),a=i(23847);class o extends n.Object3D{constructor(e){super(),this.anchor=this,this.reset=()=>{this.camera.position.set(0,0,0),this.camera.layers.mask=a.H.ALL.mask,this.camera.updateMatrixWorld(!0)},this.update=e=>{this.anchor.position.copy(e.position),this.camera.quaternion.copy(e.rotation),this.camera.projectionMatrix.copy(e.projection.asThreeMatrix4()),this.camera.projectionMatrixInverse.copy(e.projection.asThreeMatrix4()),this.camera.projectionMatrixInverse.invert(),this.updateMatrixWorld(!0)},this.camera=new n.PerspectiveCamera(s.Bv.fov,e,s.Bv.near,s.Bv.far),this.add(this.camera),this.name="CameraRig",this.reset()}dispose(){this.remove(this.camera)}}var r,d=i(2789);!function(e){e[e.Root=0]="Root",e[e.CameraRig=1]="CameraRig"}(r||(r={}));class l{constructor(e,t,i,s){this.scene=e,this.threeRenderer=t,this.cameraData=i,this.useEffectComposer=s,this.ids=r,this.rendering=!1,this.composer=null,this.cameraRigStale=!0,this.canvasSizeChanged=!0,this.updateComposer=(()=>{const e=new n.Vector2;return()=>{this.canvasSizeChanged&&this.composer&&(this.composer.setPixelRatio(this.composer.renderer.getPixelRatio()),this.composer.renderer.getSize(e),this.composer.setSize(e.x,e.y),this.canvasSizeChanged=!1)}})(),this.cameraRig=new o(i.aspect())}get lastRenderCallTime(){return this._lastRenderCallTime}add(...e){for(const t of e)this.addChild(r.Root,t)}remove(...e){for(const t of e)this.removeChild(r.Root,t)}addChild(e,t){switch(e){case r.Root:this.scene.add(t);break;case r.CameraRig:this.cameraRig.add(t);break;default:return!1}return!0}removeChild(e,t){switch(e){case r.Root:this.scene.remove(t);break;case r.CameraRig:this.cameraRig.remove(t);break;default:return!1}return!0}get camera(){return this.updateCameraRig(),this.cameraRig.camera}get effectComposer(){return this.composer}init(){this.useEffectComposer&&Promise.all([i.e(662).then(i.bind(i,42562)),i.e(662).then(i.bind(i,65804))]).then((([e,t])=>{const i=this.threeRenderer.getSize(new n.Vector2),s=new n.WebGLRenderTarget(i.x,i.y,{stencilBuffer:!0});this.composer=new e.EffectComposer(this.threeRenderer,s),this.composer.addPass(new t.RenderPass(this.scene,this.cameraRig.camera)),this.cameraRigStale=!0})),this.cameraRigStale=!0}dispose(){this.cameraRig.dispose()}startRender(e){this.rendering=e}activate(e){this.scene.add(this.cameraRig),this.cameraDataCallback=()=>this.cameraRigStale=!0,this.cameraData.pose.onChanged(this.cameraDataCallback),this.canvasSizeSub=new d.P(this.cameraData.onPropertyChanged("_width",(()=>this.onCanvasSizeChanged())),this.cameraData.onPropertyChanged("_height",(()=>this.onCanvasSizeChanged())))}deactivate(e){var t;this.scene.remove(this.cameraRig),this.cameraData.pose.removeOnChanged(this.cameraDataCallback),null===(t=this.canvasSizeSub)||void 0===t||t.cancel()}beforeRender(){this.updateCameraRig(),this.updateComposer()}setCameraDirty(){this.cameraRigStale=!0,this.cameraRig.camera.updateProjectionMatrix()}onCanvasSizeChanged(){this.canvasSizeChanged=!0}updateCameraRig(){this.cameraRigStale&&(this.cameraRig.update(this.cameraData.pose),this.cameraRigStale=!1)}render(e){this.rendering&&(this.composer?this.composer.render(e):(this.threeRenderer.clear(),this.threeRenderer.render(this.scene,this.cameraRig.camera))),this._lastRenderCallTime=Date.now()}}},62805:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MAX_RESOLUTION:()=>P,default:()=>L});var n=i(68909),s=i(23205),a=i(53366),o=i(45018),r=i(94298),d=i(46785),l=i(39591),c=i(28997),h=i(93279),u=i(83372),m=i(47110),p=i(79627);const v=(e,t)=>{switch(e){case p.A.GL_TEXTURE_CUBE_MAP_POSITIVE_X:t.set(0,-Math.PI/2,0);break;case p.A.GL_TEXTURE_CUBE_MAP_NEGATIVE_X:t.set(0,Math.PI/2,0);break;case p.A.GL_TEXTURE_CUBE_MAP_POSITIVE_Y:t.set(Math.PI/2,Math.PI,0);break;case p.A.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y:t.set(-Math.PI/2,Math.PI,0);break;case p.A.GL_TEXTURE_CUBE_MAP_POSITIVE_Z:t.set(0,-Math.PI,0);break;case p.A.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z:t.set(0,0,0)}};var g=i(99436),y=i(15098),f=i(27104),w=i.n(f),b=i(8454),k=i.n(b);const T={copyCubeMap:{uniforms:{tDiffuse:{type:"t",value:null},alpha:{type:"f",value:1}},vertexShader:w(),fragmentShader:k()}};var S=i(80172);const I={0:[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],1:[0,0,0,0,0,0,0,3e-6,229e-6,.005977,.060598,.24173,.382925,.24173,.060598,.005977,229e-6,3e-6,0,0,0,0,0,0,0],2:[0,0,1e-6,1e-5,78e-6,489e-6,.002403,.009245,.027835,.065591,.120978,.174666,.197413,.174666,.120978,.065591,.027835,.009245,.002403,489e-6,78e-6,1e-5,1e-6,0,0],3:[48e-6,169e-6,538e-6,.001532,.003907,.008921,.018247,.033432,.054867,.080658,.106212,.125283,.132372,.125283,.106212,.080658,.054867,.033432,.018247,.008921,.003907,.001532,538e-6,169e-6,48e-6],4:[.001133,.002316,.00445,.008033,.013627,.021724,.032542,.04581,.0606,.075333,.088001,.096603,.099654,.096603,.088001,.075333,.0606,.04581,.032542,.021724,.013627,.008033,.00445,.002316,.001133],5:[.004571,.00723,.010989,.016048,.022521,.03037,.039354,.049003,.058632,.067411,.074476,.079066,.080657,.079066,.074476,.067411,.058632,.049003,.039354,.03037,.022521,.016048,.010989,.00723,.004571],6:[.009379,.012899,.017256,.022453,.028417,.034983,.041888,.048784,.055264,.060893,.065262,.068032,.068981,.068032,.065262,.060893,.055264,.048784,.041888,.034983,.028417,.022453,.017256,.012899,.009379],7:[.014185,.01793,.022207,.02695,.032045,.037335,.042622,.047676,.052254,.056116,.059048,.06088,.061504,.06088,.059048,.056116,.052254,.047676,.042622,.037335,.032045,.02695,.022207,.01793,.014185]};var E=i(11274);class N{constructor(e){this.threeRenderer=e,this.cachedSize=new n.Vector2,this.renderToCubeMap=(()=>{let e,t,i,s,a,o=!1;const r=.5;return(d,l,c,h,u,m,p,v,y,f,w,b,k,T,S,I)=>{if(this.contextLost)return;o||(t=new n.OrthographicCamera(-.5,r,r,-.5,-200,200),t.position.z=150,e=new n.Scene,e.name="rttCube",e.add(t),i=new E.$({uniforms:{tDiffuse:{value:null},alpha:{value:1}},vertexShader:g.A.basicTextured.vertexShader,fragmentShader:g.A.basicTextured.fragmentShader,depthWrite:!1,depthTest:!1,side:n.DoubleSide}),s=new n.PlaneGeometry(1,1),a=new n.Mesh(s,i),a.position.z=0,e.add(a),o=!0);const N=s.getAttribute("uv");N.setUsage(n.DynamicDrawUsage),N.needsUpdate=!0;const D=N.array,C=u/c,M=m/h,O=p/c,_=v/h;D[0]=C,D[1]=M+_,D[2]=C+O,D[3]=M+_,D[4]=C,D[5]=M,D[6]=C+O,D[7]=M;const A=s.getAttribute("position");A.setUsage(n.DynamicDrawUsage),A.needsUpdate=!0;const P=A.array,L=y/l.width-r,x=f/l.height-r,R=w/l.width,V=b/l.height;P[0]=L,P[1]=x+V,P[3]=L+R,P[4]=x+V,P[6]=L,P[7]=x,P[9]=L+R,P[10]=x,i.uniforms.tDiffuse.value=d,i.blending=T||n.NoBlending,i.transparent=!!S,null==I&&(I=1),i.uniforms.alpha.value=I,l.viewport.set(0,0,l.width,l.height);const U=this.threeRenderer.getRenderTarget(),B=this.threeRenderer.autoClear,G=this.threeRenderer.xr.enabled;this.threeRenderer.xr.enabled=!1,this.threeRenderer.autoClear=!1,this.threeRenderer.setRenderTarget(l,k),this.threeRenderer.render(e,t),this.threeRenderer.setRenderTarget(U),this.threeRenderer.autoClear=B,this.threeRenderer.xr.enabled=G}})(),this.copyCubemap=(()=>{let e,t,i,s,a,o=!1;const r=new n.Euler,d=this;return(l,c,h,u,m)=>{if(this.contextLost)return;if(!o){const r=2,d=r/2;t=new n.OrthographicCamera(-d,d,d,-d,0,200),t.position.set(0,0,0),e=new n.Scene,e.name="copyCube",e.add(t),i=new E.$({uniforms:{tDiffuse:{value:null},alpha:{value:1}},vertexShader:T.copyCubeMap.vertexShader,fragmentShader:T.copyCubeMap.fragmentShader,depthWrite:!1,depthTest:!1,side:n.DoubleSide}),s=new n.BoxGeometry(r,r,r),a=new n.Mesh(s,i),e.add(a),o=!0}const p=d.threeRenderer.getRenderTarget(),g=d.threeRenderer.autoClear,y=d.threeRenderer.xr.enabled;d.threeRenderer.xr.enabled=!1,d.threeRenderer.autoClear=!1;for(let s=0;s<6;s++)v(s,r),a.rotation.copy(r),a.matrixWorldNeedsUpdate=!0,a.updateMatrixWorld(!0),i.uniforms.tDiffuse.value=l,i.blending=h||n.NoBlending,i.transparent=!!u,null==m&&(m=1),i.uniforms.alpha.value=m,c.viewport.set(0,0,c.width,c.height),d.threeRenderer.setRenderTarget(c,s),d.threeRenderer.render(e,t);d.threeRenderer.setRenderTarget(p),d.threeRenderer.autoClear=g,d.threeRenderer.xr.enabled=y}})(),this.blurCubemap=(()=>{const e=e=>{const t=new n.WebGLCubeRenderTarget(e);return t.texture.image={},t.texture.image.width=e,t.texture.image.height=e,{renderTarget:t,cubeCamera:new n.CubeCamera(.1,1e3,t)}};class t extends n.Mesh{}const i=512,s={[i]:e(512)},a=new n.Scene,o=new t(new n.BoxGeometry(1,1,1));a.add(o);const r={};return(t,i,d=3,l=.005)=>{const c=i.renderTarget;s[c.width]||(s[c.width]=e(c.width)),o.material=function(e){if(!r[e]){const t=new E.$({uniforms:n.UniformsUtils.clone(S.A.blurCube.uniforms),vertexShader:S.A.blurCube.vertexShader,fragmentShader:S.A.blurCube.fragmentShader,side:n.BackSide});t.defines={};const i=I[`${e}`];for(const[e,n]of i.entries())t.defines[`KERNEL_${e+1}`]=0===n||1===n?n.toFixed(1):n;r[e]=t}return r[e]}(d);const h=s[c.width];o.material.uniforms.map.value=t,o.material.uniforms.dir.value.set(l,0),h.cubeCamera.update(this.threeRenderer,a),o.material.uniforms.map.value=h.renderTarget.texture,o.material.uniforms.dir.value.set(0,l),i.update(this.threeRenderer,a)}})();try{const e=this.threeRenderer.getContext();0,this.contextLost=e.isContextLost(),this._maxCubemapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this._maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this._gpuInfo=function(e){try{const t=e.getExtension("WEBGL_debug_renderer_info");if(t)return{vendor:e.getParameter(t.UNMASKED_VENDOR_WEBGL),renderer:e.getParameter(t.UNMASKED_RENDERER_WEBGL)}}catch(e){}return{vendor:"Unknown",renderer:"Unknown"}}(e)}catch(e){throw new y.y("Unable to create a WebGL rendering context")}this.initTexture=this.initTexture.bind(this)}setupRendererProxy(){const e=this.threeRenderer.getContext(),t=e.canvas,i={},n=new Proxy(e,{get:(e,t,n)=>"canvas"===t?s:e[t]instanceof Function?i[t]||(i[t]=e[t].bind(e)):e[t]}),s={get clientHeight(){return t.clientHeight},get clientLeft(){return t.clientLeft},get clientTop(){return t.clientTop},get clientWidth(){return t.clientWidth},getBoundingClientRect:()=>t.getBoundingClientRect(),get height(){return t.height},get offsetHeight(){return t.offsetHeight},get offsetLeft(){return t.offsetLeft},get offsetTop(){return t.offsetTop},get offsetWidth(){return t.offsetWidth},get width(){return t.width}};this.threeRenderer.domElement=s,this.threeRenderer.getContext=function(){return n}}initTexture(e){return this.threeRenderer.initTexture(e)}get maxCubemapSize(){return this._maxCubemapSize}get maxTextureSize(){return this._maxTextureSize}get gpuInfo(){return this._gpuInfo}getSize(){return this.threeRenderer.getSize(this.cachedSize)}getPixelRatio(){return this.threeRenderer.getPixelRatio()}dispose(){this.threeRenderer.dispose()}initSizedTexture2D(e,t){var i;const s=new n.FramebufferTexture(e,e,null!==(i=null==t?void 0:t.format)&&void 0!==i?i:n.RGBAFormat);return t&&Object.assign(s,t),this.contextLost||this.threeRenderer.initTexture(s),s}initRenderTargetCube(e){const t=new n.WebGLCubeRenderTarget(e,{stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1});return t.texture.image={},t.texture.image.width=e,t.texture.image.height=e,t}uploadTexture2D(e,t,i,s){if(!this.contextLost){const a=new n.Texture;a.image=e,this.threeRenderer.copyTextureToTexture(new n.Vector2(i,s),a,t,0)}}fence(e){return new Promise(((t,i)=>{const n=this.contextLost?null:e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);if(null===n)return i();e.flush();const s=()=>{switch(e.getSyncParameter(n,e.SYNC_STATUS)){case e.TIMEOUT_EXPIRED:return void setTimeout(s,0);case e.WAIT_FAILED:return void i();case e.SIGNALED:return e.deleteSync(n),void t();default:return void setTimeout(s,0)}};setTimeout(s,0)}))}}var D=i(31617),C=i(28743),M=i(12183);class O extends n.Mesh{constructor(e){super(new n.PlaneGeometry(2,2,1,1),new E.$({uniforms:n.UniformsUtils.clone(g.A.screenSpaceColored.uniforms),vertexShader:g.A.screenSpaceColored.vertexShader,fragmentShader:g.A.screenSpaceColored.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1})),this._opacity=1,this.material.uniforms.color.value=new n.Color(e),this.renderOrder=M.X.colorOverlay,this.name="ScreenOverlayMesh"}set opacity(e){this.visible=e>0,this._opacity=e,this.material.uniforms.opacity.value=e}get opacity(){return this._opacity}dispose(){this.material.dispose(),this.geometry.dispose()}}class _{constructor(e,t){this.scene=e,this.cameraData=t}init(){this.blackoutOverlayMesh=new O(0)}dispose(){this.blackoutOverlayMesh.dispose()}render(e){this.blackoutOverlayMesh.opacity=this.cameraData.transition.blackoutProgress.value}activate(e){this.scene.addChild(this.scene.ids.CameraRig,this.blackoutOverlayMesh)}deactivate(e){this.scene.removeChild(this.scene.ids.CameraRig,this.blackoutOverlayMesh)}}var A=i(59666);const P=3686400;class L extends s.n{constructor(){super(...arguments),this.name="webgl-renderer",this.onContextLost=e=>{this.log.info(e),this._cwfRenderer.contextLost=!0,this.engine.broadcast(new C.ul(e)),e.preventDefault()},this.onContextRestored=e=>{var t;this.log.info(e),this._cwfRenderer.contextLost=!1,this.engine.broadcast(new C.aF(e)),null===(t=this.canvas.parentNode)||void 0===t||t.insertBefore(this.canvas,this.canvas)},this.getPixelRatioFor=(e,t)=>{const i=window.devicePixelRatio||1;return e*t*i<=P?i:1}}async init(e,t){if(!("WebGLRenderingContext"in window))throw new y.s("WebGL not supported");let i;this.canvas=e.canvas,this.engine=t;try{const t={canvas:this.canvas,antialias:e.antialias,alpha:!0,powerPreference:"high-performance"};i=e.useWebGL2?new n.WebGLRenderer(t):new n.WebGL1Renderer(t),i.autoClear=!1,i.xr.enabled=!0}catch(e){throw new y.y("Unable to create a WebGL rendering context")}i.setOpaqueSort(this.painterSortStable),this.patchGLContext(i.getContext()),this._cwfRenderer=new N(i),this._threeRenderer=i,[this.cameraData,this.settingsData]=await Promise.all([t.market.waitForData(o.M),t.market.waitForData(c.o)]);const s=new n.Scene;s.name="main",t.diContainer.bindConstant("ThreeScene",s),this.scene=new A.A(s,i,this.cameraData,e.useEffectComposer),t.addComponent(this,this.scene),t.addComponent(this,new _(this.scene,this.cameraData));const d=await t.market.waitForData(a.p);this.setSize(d.width,d.height),this.bindings.push(t.subscribe(r.h,(e=>this.setSize(e.width,e.height))),t.commandBinder.addBinding(D.R,(async e=>(0,l.bz)(this.cameraData,e.worldPosition).screenPosition)),new m.w(this.canvas,"webglcontextlost",this.onContextLost),new m.w(this.canvas,"webglcontextrestored",this.onContextRestored)),this.webGlMemoryTracker=i.getContext().getExtension("GMAN_webgl_memory"),this.webGlMemoryTracker||this.log.warn("Unable to find WebGL memory tracker!"),t.broadcast(new h.sb(u.D.WebGLRenderer))}dispose(e){super.dispose(e),this.threeRenderer.dispose()}isHighPerformanceMobileGPU(){return e=this._cwfRenderer.gpuInfo,/Apple A(9|1\d)/.test(e.renderer)||/Adreno \(TM\) (512|530|540|[6-9]\d\d)/.test(e.renderer)||/Mali-G(7[1-9]|[8-9]\d)/.test(e.renderer);var e}patchGLContext(e){if(function(e){let t=!1;if("undefined"!=typeof OffscreenCanvas){const i=new OffscreenCanvas(1,1);if(i.getContext("2d")){const n=e.createTexture();try{e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i)}catch(e){t=!0}finally{e.bindTexture(e.TEXTURE_2D,null),e.deleteTexture(n)}}}return t}(e)){this.log.warn("OffscreenCanvas unsupported as texImage2D source, applying workaround");let t=null;const i=e.texImage2D;e.texImage2D=function(...n){var s;const a=n[5];a&&a instanceof OffscreenCanvas?(t=t||document.createElement("canvas"),t.width=a.width,t.height=a.height,null===(s=t.getContext("2d"))||void 0===s||s.drawImage(a,0,0),n[5]=t,i.call(e,...n),t.width=t.height=1):i.call(e,...n)}}}get gpuInfo(){return this._cwfRenderer.gpuInfo}get maxCubemapSize(){return this._cwfRenderer.maxCubemapSize}get maxTextureSize(){return this._cwfRenderer.maxTextureSize}get maxVaryings(){return this._threeRenderer.capabilities.maxVaryings}getScene(){return this.scene}getCamera(){return this.scene.camera}get cwfRenderer(){return this._cwfRenderer}get threeRenderer(){return this._threeRenderer}async renderOnce(){return this.scene.startRender(!0),this.engine.after(d.R.Render).then((()=>this.scene.startRender(!1)))}startRender(e=!0){this.scene.startRender(e),this.engine.broadcast(new C.lo(this._cwfRenderer.getPixelRatio()))}setSize(e,t){const i=this.getPixelRatioFor(e,t);i!==this._cwfRenderer.getPixelRatio()&&(this.log.debug(`Setting pixel ratio to ${i}`),this.engine.broadcast(new C.lo(i))),this.threeRenderer.xr.isPresenting&&this.log.error("setting size while in xr is a no no, it resets the viewport",e,t),this.threeRenderer.setDrawingBufferSize(e,t,i),this.scene.setCameraDirty()}supportsInstancing(){const{threeRenderer:e,settingsData:t}=this;return 1!==t.getOverrideParam("noInstancing",0)&&(e.capabilities.isWebGL2||e.extensions.has("ANGLE_instanced_arrays"))}getCapabilities(){const{capabilities:e,extensions:t}=this.threeRenderer,i=e.isWebGL2;let n=!1;try{n=!!document.createElement("canvas").getContext("webgl2")}catch(e){}return{gl_v2:n,gl_max_textures:e.maxTextures,gl_max_texture_size:e.maxTextureSize,gl_max_cubemap_size:e.maxCubemapSize,gl_instancing:this.supportsInstancing(),gl_oes_texture_float:i||t.has("OES_texture_float"),gl_oes_texture_half_float:i||t.has("OES_texture_half_float"),gl_depth_texture:i||t.has("WEBGL_depth_texture"),gl_draw_buffers:i||t.has("WEBGL_draw_buffers"),gl_oes_fbo_render_mip_map:i||t.has("OES_fbo_render_mipmap"),gl_shader_texture_lod:i||t.has("EXT_shader_texture_lod"),gl_oes_vertex_array_obj:i||t.has("OES_vertex_array_object"),gl_ovr_multi_view:i&&t.has("OVR_multiview2"),gl_color_buffer_float:i&&t.has("EXT_color_buffer_float"),gl_astc_supported:t.has("WEBGL_compressed_texture_astc"),gl_etc1_supported:t.has("WEBGL_compressed_texture_etc1"),gl_etc2_supported:t.has("WEBGL_compressed_texture_etc"),gl_dxt_supported:t.has("WEBGL_compressed_texture_s3tc"),gl_bptc_supported:t.has("EXT_texture_compression_bptc"),gl_pvrtc_supported:t.has("WEBGL_compressed_texture_pvrtc")||t.has("WEBKIT_WEBGL_compressed_texture_pvrtc")}}estimatedGPUMemoryAllocated(){if(this.webGlMemoryTracker){return this.webGlMemoryTracker.getMemoryInfo().memory.total}return-1}painterSortStable(e,t){if(e.groupOrder!==t.groupOrder)return e.groupOrder-t.groupOrder;if(e.renderOrder!==t.renderOrder)return e.renderOrder-t.renderOrder;if(e.program!==t.program)return e.program.id-t.program.id;if(e.material.id!==t.material.id)return e.material.id-t.material.id;if(e.object.getSortKey&&t.object.getSortKey){const i=e.object.getSortKey()-t.object.getSortKey();if(0!==i)return i}return e.z!==t.z?e.z-t.z:e.id-t.id}}},68118:(e,t,i)=>{"use strict";i.d(t,{A:()=>s});var n=i(14754);class s extends n.QB{constructor(e){super(),this.zoomLevel=e}}},45459:(e,t,i)=>{"use strict";i.d(t,{c:()=>n});class n{constructor(){this.activePromise=Promise.resolve(new s)}async lock(){const e=new Promise((async e=>{(await this.activePromise).onUnlock((()=>e(new s)))})),t=this.activePromise;return this.activePromise=e,t}}class s{onUnlock(e){this.unlockCB=e}unlock(){this.unlockCB()}}},10060:(e,t,i)=>{"use strict";var n;i.d(t,{h:()=>n}),function(e){function t(e){return e.split(".").reduce(((e,t)=>{const i=parseInt(t,10);return isNaN(i)||e.push(i),e}),[])}function i(e,i){const n=t(e),s=t(i);for(let e=0;e<n.length;e++){if(e>=s.length)return 1;if(n[e]!==s[e])return n[e]>s[e]?1:-1}return s.length>n.length?-1:0}e.parse=t,e.gt=function(e,t){return 1===i(e,t)},e.gte=function(e,t){const n=i(e,t);return 0===n||1===n},e.lt=function(e,t){return-1===i(e,t)},e.eq=function(e,t){return 0===i(e,t)},e.compare=i}(n||(n={}))},48439:(e,t,i)=>{"use strict";var n;i.d(t,{o:()=>n}),function(e){e.MOUSE="mouse",e.TOUCH="touch",e.PEN="pen",e.GAMEPAD="gamepad"}(n||(n={}))},46534:(e,t,i)=>{"use strict";i.d(t,{k:()=>n,j:()=>s});class n{constructor(){this.values={}}add(e,t){this.getValuesAtKey(e).push(t)}remove(e,t){const i=this.values[e];if(i){const e=i.indexOf(t);e>-1&&i.splice(e,1)}}removeKey(e){delete this.values[e]}getValuesAtKey(e){const t=this.values[e]||[];return this.values[e]=t,t}valuesPerKey(e){return this.getValuesAtKey(e).length}find(e,t){return this.values[e]&&this.values[e].find(t)}get keys(){return Object.keys(this.values)}hasKey(e){return e in this.values}has(e,t){return this.hasKey(e)&&this.values[e].includes(t)}*[Symbol.iterator](){for(const e in this.values)for(const t of this.values[e])yield[e,t]}}class s{constructor(){this.values=new Map}add(e,t){this.getValuesAtKey(e).add(t)}remove(e,t){const i=this.values.get(e);null==i||i.delete(t)}removeKey(e){this.values.delete(e)}getValuesAtKey(e){const t=this.values.get(e)||new Set;return this.values.set(e,t),t}valuesPerKey(e){return this.getValuesAtKey(e).size}get keys(){return this.values.keys()}hasKey(e){return this.values.has(e)}has(e,t){var i;return!!(null===(i=this.values.get(e))||void 0===i?void 0:i.has(t))}*[Symbol.iterator](){for(const[e,t]of this.values)for(const i of t)yield[e,i]}}},4232:(e,t,i)=>{"use strict";function n(e){return!!e&&"object"==typeof e}i.d(t,{G:()=>n})},33898:(e,t,i)=>{"use strict";function n(e){return"string"==typeof e}i.d(t,{K:()=>n})},8454:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;vec3 closestPointToRay(vec3 point,vec3 origin,vec3 direction){vec3 d=point-origin;float D=dot(d,direction);return origin+D*direction;}vec3 rayIntersectsSphere(vec3 origin,float radius,vec3 rayOrigin,vec3 rayDirection){vec3 chordPoint=closestPointToRay(origin,rayOrigin,rayDirection);float D1=length(rayOrigin-chordPoint);float D=length(chordPoint-origin);float D2=sqrt(radius*radius-D*D);return rayOrigin+(D1+D2)*rayDirection;}varying vec3 vWorldPos;uniform float alpha;uniform samplerCube tDiffuse;void main(){vec4 texColor=textureCube(tDiffuse,vWorldPos);gl_FragColor=vec4(texColor.rgb,texColor.a*alpha);}"},27104:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;varying vec3 vWorldPos;void main(){vWorldPos=vec3(-position.x,-position.y,position.z);gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"}}]);